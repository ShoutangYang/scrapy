[{"praise_nums": "1", "create_date": "2018-05-19", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/popsuper1982/p/8505203.html\">刘超（popsuper1982）</a>   </div><p>我今天要讲这三个话题，一个是云计算，一个大数据，一个人工智能，我为什么要讲这三个东西呢？因为这三个东西现在非常非常的火，它们之间好像互相有关系，一般谈云计算的时候也会提到大数据，谈人工智能的时候也会提大数据，谈人工智能的时候也会提云计算。所以说感觉他们又相辅相成不可分割，如果是非技术的人员来讲可能比较难理解说这三个之间的相互关系，所以有必要解释一下。</p>\n<p>一、云计算最初是实现资源管理的灵活性</p>\n<p>我们首先来说云计算，云计算最初的目标是对资源的管理，管理的主要是计算资源，网络资源，存储资源三个方面。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/6a5fe11e3f98f0f2e1b80bb8e08373cf.png\" alt=\"\" width=\"720\" height=\"363\"></p>\n<p>1.1 管数据中心就像配电脑</p>\n<p>什么叫计算，网络，存储资源呢？就说你要买台笔记本电脑吧，你是不是要关心这台电脑什么样的CPU啊？多大的内存啊？这两个我们称为计算资源。</p>\n<p>这台电脑要能上网吧，需要有个网口可以插网线，或者有无线网卡可以连接我们家的路由器，您家也需要到运营商比如联通，移动，电信开通一个网络，比如100M的带宽，然后会有师傅弄一根网线到您家来，师傅可能会帮您将您的路由器和他们公司的网络连接配置好，这样您家的所有的电脑，手机，平板就都可以通过您的路由器上网了。这就是网络。</p>\n<p>您可能还会问硬盘多大啊？原来硬盘都很小，10G之类的，后来500G，1T，2T的硬盘也不新鲜了。(1T是1000G)，这就是存储。</p>\n<p>对于一台电脑是这个样子的，对于一个数据中心也是同样的。想象你有一个非常非常大的机房，里面堆了很多的服务器，这些服务器也是有CPU，内存，硬盘的，也是通过类似路由器的设备上网的。这个时候的一个问题就是，运营数据中心的人是怎么把这些设备统一的管理起来的呢？</p>\n<p>1.2 灵活就是想啥时要都有，想要多少都行</p>\n<p>管理的目标就是要达到两个方面的灵活性。哪两个方面呢？比如有个人需要一台很小很小的电脑，只有一个CPU，1G内存，10G的硬盘，一兆的带宽，你能给他吗？像这种这么小规格的电脑，现在随便一个笔记本电脑都比这个配置强了，家里随便拉一个宽带都要100M。然而如果去一个云计算的平台上，他要想要这个资源的时候，只要一点就有了。</p>\n<p>所以说它就能达到两个方面灵活性。</p>\n<ul>\n<li>第一个方面就是想什么时候要就什么时候要，比如需要的时候一点就出来了，这个叫做时间灵活性。</li>\n<li>第二个方面就是想要多少呢就有多少，比如需要一个很小很小的电脑，可以满足，比如需要一个特别大的空间，以云盘为例，似乎云盘给每个人分配的空间动不动就就很大很大，随时上传随时有空间，永远用不完，这个叫做空间灵活性。</li>\n</ul>\n<p>空间灵活性和时间灵活性，也即我们常说的云计算的弹性。</p>\n<p>为了解决这个弹性的问题，经历了漫长时间的发展。</p>\n<p>1.3 物理设备不灵活</p>\n<p>首先第一个阶段就是物理机，或者说物理设备时期。这个时期相当于客户需要一台电脑，我们就买一台放在数据中心里。物理设备当然是越来越牛，例如服务器，内存动不动就是百G内存，例如网络设备，一个端口的带宽就能有几十G甚至上百G，例如存储，在数据中心至少是PB级别的(一个P是1000个T，一个T是1000个G)。</p>\n<p>然而物理设备不能做到很好的灵活性。首先它不能够达到想什么时候要就什么时候要、比如买台服务器，哪怕买个电脑，都有采购的时间。突然用户告诉某个云厂商，说想要开台电脑，如果使用物理服务器，当时去采购啊就很难，如果说供应商啊关系一般，可能采购一个月，供应商关系好的话也需要一个星期。用户等了一个星期后，这时候电脑才到位，用户还要登录上去开始慢慢部署自己的应用，时间灵活性非常差。第二是空间灵活性也不行，例如上述的用户，要一个很小很小的电脑，现在哪还有这么小型号的电脑啊。不能为了满足用户只要一个G的内存是80G硬盘的，就去买一个这么小的机器。但是如果买一个大的呢，因为电脑大，就向用户多收钱，用户说他只用这么小的一点，如果让用户多付钱就很冤。</p>\n<p>1.4 虚拟化灵活多了</p>\n<p>有人就想办法了。第一个办法就是虚拟化。用户不是只要一个很小的电脑么？数据中心的物理设备都很强大，我可以从物理的CPU，内存，硬盘中虚拟出一小块来给客户，同时也可以虚拟出一小块来给其他客户，每个客户都只能看到自己虚的那一小块，其实每个客户用的是整个大的设备上其中的一小块。虚拟化的技术能使得不同的客户的电脑看起来是隔离的，我看着好像这块盘就是我的，你看这呢这块盘就是你的，实际情况可能我这个10G和您这个10G是落在同样一个很大很大的这个存储上的。</p>\n<p>而且如果事先物理设备都准备好，虚拟化软件虚拟出一个电脑是非常快的，基本上几分钟就能解决。所以在任何一个云上要创建一台电脑，一点几分钟就出来了，就是这个道理。</p>\n<p>这个空间灵活性和时间灵活性就基本解决了。</p>\n<p>1.5 虚拟世界的赚钱与情怀</p>\n<p>在虚拟化阶段，最牛的公司是Vmware，是实现虚拟化技术比较早的一家公司，可以实现计算，网络，存储的虚拟化，这家公司很牛，性能也做得非常好，然后虚拟化软件卖的也非常好，赚了好多的钱，后来让EMC(世界五百强，存储厂商第一品牌)给收购了。</p>\n<p>但是这个世界上还是有很多有情怀的人的，尤其是程序员里面，有情怀的人喜欢做一件什么事情呢？开源。这个世界上很多软件都是有闭源就有开源，源就是源代码。就是说某个软件做的好，所有人都爱用，这个软件的代码呢，我封闭起来只有我公司知道，其他人不知道，如果其他人想用这个软件，就要付我钱，这就叫闭源。但是世界上总有一些大牛看不惯钱都让一家赚了去。大牛们觉得，这个技术你会我也会，你能开发出来，我也能，我开发出来就是不收钱，把代码拿出来分享给大家，全世界谁用都可以，所有的人都可以享受到好处，这个叫做开源。</p>\n<p>比如最近蒂姆·伯纳斯·李就是个非常有情怀的人，2017年，他因“发明万维网、第一个浏览器和使万维网得以扩展的基本协议和算法”而获得2016年度的图灵奖。图灵奖就是计算机界的诺贝尔奖。然而他最令人敬佩的是，他将万维网，也就是我们常见的www的技术无偿贡献给全世界免费使用。我们现在在网上的所有行为都应该感谢他的功劳，如果他将这个技术拿来收钱，应该和比尔盖茨差不多有钱。</p>\n<p>例如在闭源的世界里有windows，大家用windows都得给微软付钱，开源的世界里面就出现了Linux。比尔盖茨靠windows，Office这些闭源的软件赚了很多钱，称为世界首富，就有大牛开发了另外一种操作系统Linux。很多人可能没有听说过Linux，很多后台的服务器上跑的程序都是Linux上的，比如大家享受双十一，支撑双十一抢购的系统，无论是淘宝，京东，考拉，都是跑在Linux上的。</p>\n<p>再如有apple就有安卓。apple市值很高，但是苹果系统的代码我们是看不到的。于是就有大牛写了安卓手机操作系统。所以大家可以看到几乎所有的其他手机厂商，里面都装安卓系统，因为苹果系统不开源，而安卓系统大家都可以用。</p>\n<p>在虚拟化软件也一样，有了Vmware，这个软件非常非常的贵。那就有大牛写了两个开源的虚拟化软件，一个叫做Xen，一个叫做KVM，如果不做技术的，可以不用管这两个名字，但是后面还是会提到。</p>\n<p>1.6 虚拟化的半自动和云计算的全自动</p>\n<p>虚拟化软件似乎解决了灵活性问题，其实不全对。因为虚拟化软件一般创建一台虚拟的电脑，是需要人工指定这台虚拟电脑放在哪台物理机上的，可能还需要比较复杂的人工配置，所以使用Vmware的虚拟化软件，需要考一个很牛的证书，能拿到这个证书的人，薪资是相当的高，也可见复杂程度。所以仅仅凭虚拟化软件所能管理的物理机的集群规模都不是特别的大，一般在十几台，几十台，最多百台这么一个规模。这一方面会影响时间灵活性，虽然虚拟出一台电脑的时间很短，但是随着集群规模的扩大，人工配置的过程越来越复杂，越来越耗时。另一方面也影响空间灵活性，当用户数量多的时候，这点集群规模，还远达不到想要多少要多少的程度，很可能这点资源很快就用完了，还得去采购。所以随着集群的规模越来越大，基本都是千台起步，动辄上万台，甚至几十上百万台，如果去查一下BAT，包括网易，包括谷歌，亚马逊，服务器数目都大的吓人。这么多机器要靠人去选一个位置放这台虚拟化的电脑并做相应的配置，几乎是不可能的事情，还是需要机器去做这个事情。</p>\n<p>人们发明了各种各样的算法来做这个事情，算法的名字叫做调度(Scheduler)。通俗一点的说，就是有一个调度中心，几千台机器都在一个池子里面，无论用户需要多少CPU，内存，硬盘的虚拟电脑，调度中心会自动在大池子里面找一个能够满足用户需求的地方，把虚拟电脑启动起来做好配置，用户就直接能用了。这个阶段，我们称为池化，或者云化，到了这个阶段，才可以称为云计算，在这之前都只能叫虚拟化。</p>\n<p>1.7 云计算的私有与公有</p>\n<p>云计算大致分两种，一个是私有云，一个是公有云，还有人把私有云和公有云连接起来称为混合云，我们暂且不说这个。私有云就是把虚拟化和云化的这套软件部署在别人的数据中心里面，使用私有云的用户往往很有钱，自己买地建机房，自己买服务器，然后让云厂商部署在自己这里，Vmware后来除了虚拟化，也推出了云计算的产品，并且在私有云市场赚的盆满钵满。所谓公有云就是虚拟化和云化软件部署在云厂商自己数据中心里面的，用户不需要很大的投入，只要注册一个账号，就能在一个网页上点一下创建一台虚拟电脑，例如AWS也即亚马逊的公有云，例如国内的阿里云，腾讯云，网易云等。</p>\n<p>亚马逊呢为什么要做公有云呢？我们知道亚马逊原来是国外比较大的一个电商，它做电商的时候也肯定会遇到类似双11的场景，在某一个时刻大家都冲上来买东西。当大家都冲上买东西的时候，就特别需要云的时间灵活性和空间灵活性。因为它不能时刻准备好所有的资源，那样太浪费了。但也不能什么都不准备，看着双十一这么多用户想买东西登不上去。所以需要双十一的时候，创建一大批虚拟电脑来支撑电商应用，过了双十一再把这些资源都释放掉去干别的。所以亚马逊是需要一个云平台的。</p>\n<p>然而商用的虚拟化软件实在是太贵了，亚马逊总不能把自己在电商赚的钱全部给了虚拟化厂商吧。于是亚马逊基于开源的虚拟化技术，如上所述的Xen或者KVM，开发了一套自己的云化软件。没想到亚马逊后来电商越做越牛，云平台也越做越牛。而且由于他的云平台需要支撑自己的电商应用，而传统的云计算厂商多为IT厂商出身，几乎没有自己的应用，因而亚马逊的云平台对应用更加的友好，迅速发展成为云计算的第一品牌，赚了很多钱。在亚马逊公布其云计算平台财报之前，人们都猜测，亚马逊电商赚钱，云也赚钱吗？后来一公布财报，发现不是一般的赚钱，仅仅去年，亚马逊AWS年营收达122亿美元，运营利润31亿美元。</p>\n<p>1.8 云计算的赚钱与情怀</p>\n<p>公有云的第一名亚马逊过得很爽，第二名Rackspace过的就一般了。没办法，这就是互联网行业的残酷性，多是赢者通吃的模式。所以第二名如果不是云计算行业的，很多人可能都没听过了。第二名就想，我干不过老大怎么办呢？开源吧。如上所述，亚马逊虽然使用了开源的虚拟化技术，但是云化的代码是闭源的，很多想做又做不了云化平台的公司，只能眼巴巴的看着亚马逊挣大钱。Rackspace把源代码一公开，整个行业就可以一起把这个平台越做越好，兄弟们大家一起上，和老大拼了。</p>\n<p>于是Rackspace和美国航空航天局合作创办了开源软件OpenStack，如图所示OpenStack的架构图，不是云计算行业的不用弄懂这个图，但是能够看到三个关键字，Compute计算，Networking网络，Storage存储。还是一个计算，网络，存储的云化管理平台。</p>\n<p>当然第二名的技术也是非常棒的，有了OpenStack之后，果真像Rackspace想象的一样，所有想做云的大企业都疯了，你能想象到的所有如雷贯耳的大型IT企业，IBM，惠普，戴尔，华为，联想等等，都疯了。原来云平台大家都想做，看着亚马逊和Vmware赚了这么多钱，眼巴巴看着没办法，想自己做一个好像难度还挺大。现在好了，有了这样一个开源的云平台OpenStack，所有的IT厂商都加入到这个社区中来，对这个云平台进行贡献，包装成自己的产品，连同自己的硬件设备一起卖。有的做了私有云，有的做了公有云，OpenStack已经成为开源云平台的事实标准。</p>\n<p>1.9 IaaS, 资源层面的灵活性</p>\n<p>随着OpenStack的技术越来越成熟，可以管理的规模也越来越大，并且可以有多个OpenStack集群部署多套，比如北京部署一套，杭州部署两套，广州部署一套，然后进行统一的管理。这样整个规模就更大了。在这个规模下，对于普通用户的感知来讲，基本能够做到想什么时候要就什么什么药，想要多少就要多少。还是拿云盘举例子，每个用户云盘都分配了5T甚至更大的空间，如果有1亿人，那加起来空间多大啊。其实背后的机制是这样的，分配你的空间，你可能只用了其中很少一点，比如说它分配给你了5个T，这么大的空间仅仅是你看到的，而不是真的就给你了，你其实只用了50个G，则真实给你的就是50个G，随着你文件的不断上传，分给你的空间会越来越多。当大家都上传，云平台发现快满了的时候(例如用了70%)，会采购更多的服务器，扩充背后的资源，这个对用户是透明的，看不到的，从感觉上来讲，就实现了云计算的弹性。其实有点像银行，给储户的感觉是什么时候取钱都有，只要不同时挤兑，银行就不会垮。</p>\n<p>这里做一个简单的总结，到了这个阶段，云计算基本上实现了时间灵活性和空间灵活性，实现了计算，网络，存储资源的弹性。计算，网络，存储我们常称为基础设施Infranstracture, 因而这个阶段的弹性称为资源层面的弹性，管理资源的云平台，我们称为基础设施服务，就是我们常听到的IaaS，Infranstracture As A Service。</p>\n<p>二、云计算不光管资源，也要管应用</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/a0c61d4ba517a89c12c4cede15076bc3.png\" alt=\"\" width=\"747\" height=\"417\"></p>\n<p>有了IaaS，实现了资源层面的弹性就够了吗？显然不是。还有应用层面的弹性。这里举个例子，比如说实现一个电商的应用，平时十台机器就够了，双十一需要一百台。你可能觉得很好办啊，有了IaaS，新创建九十台机器就可以了啊。但是90台机器创建出来是空的啊，电商应用并没有放上去啊，只能你公司的运维人员一台一台的弄，还是需要很长时间才能安装好的。虽然资源层面实现了弹性，但是没有应用层的弹性，依然灵活性是不够的。</p>\n<p>有没有方法解决这个问题呢？于是人们在IaaS平台之上又加了一层，用于管理资源以上的应用弹性的问题，这一层通常称为PaaS（Platform As A Service）。这一层往往比较难理解，其实大致分两部分，一部分我称为你自己的应用自动安装，一部分我称为通用的应用不用安装。</p>\n<p>我们先来说第一部分，自己的应用自动安装。比如电商应用是你自己开发的，除了你自己，其他人是不知道怎么安装的，比如电商应用，安装的时候需要配置支付宝或者微信的账号，才能别人在你的电商上买东西的时候，付的钱是打到你的账户里面的，除了你，谁也不知道，所以安装的过程平台帮不了忙，但是能够帮你做的自动化，你需要做一些工作，将自己的配置信息融入到自动化的安装过程中方可。比如上面的例子，双十一新创建出来的90台机器是空的，如果能够提供一个工具，能够自动在这新的90台机器上将电商应用安装好，就能够实现应用层面的真正弹性。例如Puppet, Chef, Ansible, Cloud Foundary都可以干这件事情，最新的容器技术Docker能更好的干这件事情，不做技术的可以不用管这些词。</p>\n<p>第二部分，通用的应用不用安装。所谓通用的应用，一般指一些复杂性比较高，但是大家都在用的，例如数据库。几乎所有的应用都会用数据库，但是数据库软件是标准的，虽然安装和维护比较复杂，但是无论谁安装都是一样。这样的应用可以变成标准的PaaS层的应用放在云平台的界面上。当用户需要一个数据库的时候，一点就出来了，用户就可以直接用了。有人问，既然谁安装都一个样，那我自己来好了，不需要花钱在云平台上买。当然不是，数据库是一个非常难的东西，光Oracle这家公司，靠数据库就能赚这么多钱。买Oracle也是要花很多很多钱的。然而大多数云平台会提供Mysql这样的开源数据库，又是开源，钱不需要花这么多了，但是维护这个数据库，却需要专门招一个很大的团队，如果这个数据库能够优化到能够支撑双十一，也不是一年两年能够搞定的。比如您是一个做单车的，当然没必要招一个非常大的数据库团队来干这件事情，成本太高了，应该交给云平台来做这件事情，专业的事情专业的人来自，云平台专门养了几百人维护这套系统，您只要专注于您的单车应用就可以了。</p>\n<p>要么是自动部署，要么是不用部署，总的来说就是应用层你也要少操心，这就是PaaS层的重要作用。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/dfc6140cce1cf684db2224d39e98066e.png\" alt=\"\" width=\"707\" height=\"386\"></p>\n<p>虽说脚本的方式能够解决自己的应用的部署问题，然而不同的环境千差万别，一个脚本往往在一个环境上运行正确，到另一个环境就不正确了。</p>\n<p>而容器是能更好的解决这个问题的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/cd9897092b71aabf92adc5c09b1118f4.png\" alt=\"\" width=\"745\" height=\"369\"></p>\n<p>容器是 Container，Container另一个意思是集装箱，其实容器的思想就是要变成软件交付的集装箱。集装箱的特点，一是封装，二是标准。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1f84674a8a323dddf41c52625d675151.png\" alt=\"\"></p>\n<p>在没有集装箱的时代，假设将货物从 A运到 B，中间要经过三个码头、换三次船。每次都要将货物卸下船来，摆的七零八落，然后搬上船重新整齐摆好。因此在没有集装箱的时候，每次换船，船员们都要在岸上待几天才能走。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/86b744aaf03b4b8cc0d2c0e39c8a37a8.png\" alt=\"\"></p>\n<p>有了集装箱以后，所有的货物都打包在一起了，并且集装箱的尺寸全部一致，所以每次换船的时候，一个箱子整体搬过去就行了，小时级别就能完成，船员再也不用上岸长时间耽搁了。</p>\n<p>这是集装箱“封装”、“标准”两大特点在生活中的应用。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1adfe7183881af37a6942846dbf7eb96.png\" alt=\"\"></p>\n<p>那么容器如何对应用打包呢？还是要学习集装箱，首先要有个封闭的环境，将货物封装起来，让货物之间互不干扰，互相隔离，这样装货卸货才方便。好在 Ubuntu中的LXC技术早就能做到这一点。</p>\n<p>封闭的环境主要使用了两种技术，一种是看起来是隔离的技术，称为 Namespace，也即每个 Namespace中的应用看到的是不同的 IP地址、用户空间、程号等。另一种是用起来是隔离的技术，称为 Cgroups，也即明明整台机器有很多的 CPU、内存，而一个应用只能用其中的一部分。</p>\n<p>所谓的镜像，就是将你焊好集装箱的那一刻，将集装箱的状态保存下来，就像孙悟空说：“定”，集装箱里面就定在了那一刻，然后将这一刻的状态保存成一系列文件。这些文件的格式是标准的，谁看到这些文件都能还原当时定住的那个时刻。将镜像还原成运行时的过程（就是读取镜像文件，还原那个时刻的过程）就是容器运行的过程。</p>\n<p>有了容器，使得 PaaS层对于用户自身应用的自动部署变得快速而优雅。</p>\n<p>三、大数据拥抱云计算</p>\n<p>在PaaS层中一个复杂的通用应用就是大数据平台。大数据是如何一步一步融入云计算的呢？</p>\n<p>3.1 数据不大也包含智慧</p>\n<p>一开始这个大数据并不大，你想象原来才有多少数据？现在大家都去看电子书，上网看新闻了，在我们80后小时候，信息量没有那么大，也就看看书，看看报，一个星期的报纸加起来才有多少字啊，如果你不在一个大城市，一个普通的学校的图书馆加起来也没几个书架，是后来随着信息化的到来，信息才会越来越多。</p>\n<p>首先我们来看一下大数据里面的数据，就分三种类型，一种叫结构化的数据，一种叫非结构化的数据，还有一种叫半结构化的数据。什么叫结构化的数据呢？叫有固定格式和有限长度的数据。例如填的表格就是结构化的数据，国籍：中华人民共和国，民族：汉，性别：男，这都叫结构化数据。现在越来越多的就是非结构化的数据，就是不定长，无固定格式的数据，例如网页，有时候非常长，有时候几句话就没了，例如语音，视频都是非结构化的数据。半结构化数据是一些xml或者html的格式的，不从事技术的可能不了解，但也没有关系。</p>\n<p>数据怎么样才能对人有用呢？其实数据本身不是有用的，必须要经过一定的处理。例如你每天跑步带个手环收集的也是数据，网上这么多网页也是数据，我们称为Data，数据本身没有什么用处，但是数据里面包含一个很重要的东西，叫做信息Information，数据十分杂乱，经过梳理和清洗，才能够称为信息。信息会包含很多规律，我们需要从信息中将规律总结出来，称为知识knowledge，知识改变命运。信息是很多的，但是有人看到了信息相当于白看，但是有人就从信息中看到了电商的未来，有人看到了直播的未来，所以人家就牛了，你如果没有从信息中提取出知识，天天看朋友圈，也只能在互联网滚滚大潮中做个看客。有了知识，然后利用这些知识去应用于实战，有的人会做得非常好，这个东西叫做智慧intelligence。有知识并不一定有智慧，例如好多学者很有知识，已经发生的事情可以从各个角度分析的头头是道，但一到实干就歇菜，并不能转化成为智慧。而很多的创业家之所以伟大，就是通过获得的知识应用于实践，最后做了很大的生意。</p>\n<p>所以数据的应用分这四个步骤：数据，信息，知识，智慧。这是很多商家都想要的，你看我收集了这么多的数据，能不能基于这些数据来帮我做下一步的决策，改善我的产品，例如让用户看视频的时候旁边弹出广告，正好是他想买的东西，再如让用户听音乐的时候，另外推荐一些他非常想听的其他音乐。用户在我的应用或者网站上随便点点鼠标，输入文字对我来说都是数据，我就是要将其中某些东西提取出来，指导实践，形成智慧，让用户陷入到我的应用里面不可自拔，上了我的网就不想离开，手不停的点，不停的买，很多人说双十一我都想断网了，我老婆在上面不断的买买买，买了A又推荐B，老婆大人说，“哎呀，B也是我喜欢的啊，老公我要买”。你说这个程序怎么这么牛，这么有智慧，比我还了解我老婆，这件事情是怎么做到的呢？</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/71493f8655280648dbcd66c274a10b90.png\" alt=\"\" width=\"500\" height=\"339\"></p>\n<p>3.2 数据如何升华为智慧</p>\n<p>数据的处理分几个步骤，完成了才最后会有智慧。</p>\n<p>第一个步骤叫数据的收集。首先得有数据，数据的收集有两个方式，第一个方式是拿，专业点的说法叫抓取或者爬取，例如搜索引擎就是这么做的，它把网上的所有的信息都下载到它的数据中心，然后你一搜才能搜出来。比如你去搜索的时候，结果会是一个列表，这个列表为什么会在搜索引擎的公司里面呢，就是因为他把这个数据啊都拿下来了，但是你一点链接，点出来这个网站就不在搜索引擎它们公司了。比如说新浪有个新闻，你拿百度搜出来，你不点的时候，那一页在百度数据中心，一点出来的网页就是在新浪的数据中心了。另外一个方式就是推送，有很多终端可以帮我收集数据，比如说小米手环，可以将你每天跑步的数据，心跳的数据，睡眠的数据都上传到数据中心里面。</p>\n<p>第二个步骤是数据的传输。一般会通过队列方式进行，因为数据量实在是太大了，数据必须经过处理才会有用，可是系统处理不过来，只好排好队，慢慢的处理。</p>\n<p>第三个步骤是数据的存储。现在数据就是金钱，掌握了数据就相当于掌握了钱。要不然网站怎么知道你想买什么呢？就是因为它有你历史的交易的数据，这个信息可不能给别人，十分宝贵，所以需要存储下来。</p>\n<p>第四个步骤是数据的处理和分析。上面存储的数据是原始数据，原始数据多是杂乱无章的，有很多垃圾数据在里面，因而需要清洗和过滤，得到一些高质量的数据。对于高质量的数据，就可以进行分析，从而对数据进行分类，或者发现数据之间的相互关系，得到知识。比如盛传的沃尔玛超市的啤酒和尿布的故事，就是通过对人们的购买数据进行分析，发现了男人一般买尿布的时候，会同时购买啤酒，这样就发现了啤酒和尿布之间的相互关系，获得知识，然后应用到实践中，将啤酒和尿布的柜台弄的很近，就获得了智慧。</p>\n<p>第五个步骤就是对于数据的检索和挖掘。检索就是搜索，所谓外事不决问google，内事不决问百度。内外两大搜索引擎都是讲分析后的数据放入搜索引擎，从而人们想寻找信息的时候，一搜就有了。另外就是挖掘，仅仅搜索出来已经不能满足人们的要求了，还需要从信息中挖掘出相互的关系。比如财经搜索，当搜索某个公司股票的时候，该公司的高管是不是也应该被挖掘出来呢？如果仅仅搜索出这个公司的股票发现涨的特别好，于是你就去买了，其实其高管发了一个声明，对股票十分不利，第二天就跌了，这不坑害广大股民么？所以通过各种算法挖掘数据中的关系，形成知识库，十分重要。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/82383e7eedba1c4c6a857d3b0ee6ccf5.png\" alt=\"\" width=\"639\" height=\"369\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/0aa7c460826314a853c1f94019d8bfeb.png\" alt=\"\" width=\"654\" height=\"373\"></p>\n<p>3.3 大数据时代，众人拾柴火焰高</p>\n<p>当数据量很小的时候，很少的几台机器就能解决。慢慢的当数据量越来越大，最牛的服务器都解决不了问题的时候，就想怎么办呢？要聚合多台机器的力量，大家齐心协力一起把这个事搞定，众人拾柴火焰高。</p>\n<p>对于数据的收集，对于IoT来讲，外面部署这成千上万的检测设备，将大量的温度，适度，监控，电力等等数据统统收集上来，对于互联网网页的搜索引擎来讲，需要将整个互联网所有的网页都下载下来，这显然一台机器做不到，需要多台机器组成网络爬虫系统，每台机器下载一部分，同时工作，才能在有限的时间内，将海量的网页下载完毕。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/11dc1ed8afe83ff6204ef1926f5e9dea.png\" alt=\"\"></p>\n<p>对于数据的传输，一个内存里面的队列肯定会被大量的数据挤爆掉，于是就产生了基于硬盘的分布式队列，这样队列可以多台机器同时传输，随你数据量多大，只要我的队列足够多，管道足够粗，就能够撑得住。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/af9f2ff2b23388983719d66a71476d1f.png\" alt=\"\"></p>\n<p>对于数据的存储，一台机器的文件系统肯定是放不下了，所以需要一个很大的分布式文件系统来做这件事情，把多台机器的硬盘打成一块大的文件系统。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/aa51b888c9a8b154ff48efbf857ec7f9.png\" alt=\"\"></p>\n<p>再如数据的分析，可能需要对大量的数据做分解，统计，汇总，一台机器肯定搞不定，处理到猴年马月也分析不完，于是就有分布式计算的方法，将大量的数据分成小份，每台机器处理一小份，多台机器并行处理，很快就能算完。例如著名的Terasort对1个TB的数据排序，相当于1000G，如果单机处理，怎么也要几个小时，但是并行处理209秒就完成了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/3e9abc231b2fca27961065ff8a67de7c.png\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/fa9dffc7d12ef1dbe49c6bb255e60154.png\" alt=\"\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/65008a24d116cf0c3c5f0f7a0741ada2.png\" alt=\"\"></p>\n<p>所以说大数据平台，什么叫做大数据，说白了就是一台机器干不完，大家一起干。随着数据量越来越大，很多不大的公司都需要处理相当多的数据，这些小公司没有这么多机器可怎么办呢？</p>\n<p>3.4 大数据需要云计算，云计算需要大数据</p>\n<p>说到这里，大家想起云计算了吧。当想要干这些活的时候，需要好多好多的机器一块做，真的是想什么时候要，想要多少就要多少。例如大数据分析公司的财务情况，可能一周分析一次，如果要把这一百台机器或者一千台机器都在那放着，一周用一次对吧，非常浪费。那能不能需要计算的时候，把这一千台机器拿出来，然后不算的时候，这一千台机器可以去干别的事情。谁能做这个事儿呢？只有云计算，可以为大数据的运算提供资源层的灵活性。而云计算也会部署大数据放到它的PaaS平台上，作为一个非常非常重要的通用应用。因为大数据平台能够使得多台机器一起干一个事儿，这个东西不是一般人能开发出来的，也不是一般人玩得转的，怎么也得雇个几十上百号人才能把这个玩起来，所以说就像数据库一样，其实还是需要有一帮专业的人来玩这个东西。现在公有云上基本上都会有大数据的解决方案了，一个小公司我需要大数据平台的时候，不需要采购一千台机器，只要到公有云上一点，这一千台机器都出来了，并且上面已经部署好了的大数据平台，只要把数据放进去算就可以了。</p>\n<p>云计算需要大数据，大数据需要云计算，两个人就这样结合了。</p>\n<p>四、人工智能拥抱大数据</p>\n<p>4.1 机器什么时候才能懂人心</p>\n<p>虽说有了大数据，人的欲望总是这个不能够满足。虽说在大数据平台里面有搜索引擎这个东西，想要什么东西我一搜就出来了。但是也存在这样的情况，我想要的东西不会搜，表达不出来，搜索出来的又不是我想要的。例如音乐软件里面推荐一首歌，这首歌我没听过，当然不知道名字，也没法搜，但是软件推荐给我，我的确喜欢，这就是搜索做不到的事情。当人们使用这种应用的时候，会发现机器知道我想要什么，而不是说当我想要的时候，去机器里面搜索。这个机器真像我的朋友一样懂我，这就有点人工智能的意思了。</p>\n<p>人们很早就在想这个事情了。最早的时候，人们想象，如果要是有一堵墙，墙后面是个机器，我给它说话，它就给我回应，我如果感觉不出它那边是人还是机器，那它就真的是一个人工智能的东西了。</p>\n<p>4.2 让机器学会推理</p>\n<p>怎么才能做到这一点呢？人们就想：我首先要告诉计算机人类的推理的能力。你看人重要的是什么呀，人和动物的区别在什么呀，就是能推理。我要是把我这个推理的能力啊告诉机器，机器就能根据你的提问，推理出相应的回答，真能这样多好。推理其实人们慢慢的让机器能够做到一些了，例如证明数学公式。这是一个非常让人惊喜的一个过程，机器竟然能够证明数学公式。但是慢慢发现其实这个结果，也没有那么令人惊喜，因为大家发现了一个问题，数学公式非常严谨，推理过程也非常严谨，而且数学公式很容易拿机器来进行表达，程序也相对容易表达。然而人类的语言就没这么简单了，比如今天晚上，你和你女朋友约会，你女朋友说：如果你早来，我没来，你等着，如果我早来，你没来，你等着。这个机器就比比较难理解了，但是人都懂，所以你和女朋友约会，你是不敢迟到的。</p>\n<p>4.3 教给机器知识</p>\n<p>所以仅仅告诉机器严格的推理是不够的，还要告诉机器一些知识。但是知识这个事儿，一般人可能就做不来了，可能专家可以，比如语言领域的专家，或者财经领域的专家。语言领域和财经领域知识能不能表示成像数学公式一样稍微严格点呢？例如语言专家可能会总结出主谓宾定状补这些语法规则，主语后面一定是谓语，谓语后面一定是宾语，将这些总结出来，并严格表达出来不久行了吗？后来发现这个不行，太难总结了，语言表达千变万化。就拿主谓宾的例子，很多时候在口语里面就省略了谓语，别人问：你谁啊？我回答：我刘超。但是你不能规定在语音语义识别的时候，要求对着机器说标准的书面语，这样还是不够智能，就像罗永浩在一次演讲中说的那样，每次对着手机，用书面语说：请帮我呼叫某某某，这是一件很尴尬的事情。</p>\n<p>人工智能这个阶段叫做专家系统。专家系统不易成功，一方面是知识比较难总结，另一方面总结出来的知识难以教给计算机。因为你自己还迷迷糊糊，似乎觉得有规律，就是说不出来，就怎么能够通过编程教给计算机呢？</p>\n<p>4.4 算了，教不会你自己学吧</p>\n<p>于是人们想到，看来机器是和人完全不一样的物种，干脆让机器自己学习好了。机器怎么学习呢？既然机器的统计能力这么强，基于统计学习，一定能从大量的数字中发现一定的规律。</p>\n<p>其实在娱乐圈有很好的一个例子，可见一斑</p>\n<p>有一位网友统计了知名歌手在大陆发行的 9 张专辑中 117 首歌曲的歌词，同一词语在一首歌出现只算一次，形容词、名词和动词的前十名如下表所示（词语后面的数字是出现的次数）：</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<colgroup>\n<col>\n<col>\n<col>\n<col>\n<col>\n<col></colgroup>\n<tbody>\n<tr>\n<td height=\"15\">a</td>\n<td height=\"15\">形容词</td>\n<td height=\"15\">b</td>\n<td height=\"15\">名词</td>\n<td height=\"15\">c</td>\n<td height=\"15\">动词</td>\n</tr>\n<tr>\n<td height=\"15\">0</td>\n<td height=\"15\">孤独:34</td>\n<td height=\"15\">0</td>\n<td height=\"15\">生命:50</td>\n<td height=\"15\">0</td>\n<td height=\"15\">爱:54</td>\n</tr>\n<tr>\n<td height=\"15\">1</td>\n<td height=\"15\">自由:17</td>\n<td height=\"15\">1</td>\n<td height=\"15\">路:37</td>\n<td height=\"15\">1</td>\n<td height=\"15\">碎:37</td>\n</tr>\n<tr>\n<td height=\"15\">2</td>\n<td height=\"15\">迷惘:16</td>\n<td height=\"15\">2</td>\n<td height=\"15\">夜:29</td>\n<td height=\"15\">2</td>\n<td height=\"15\">哭:35</td>\n</tr>\n<tr>\n<td height=\"15\">3</td>\n<td height=\"15\">坚强:13</td>\n<td height=\"15\">3</td>\n<td height=\"15\">天空:24</td>\n<td height=\"15\">3</td>\n<td height=\"15\">死:27</td>\n</tr>\n<tr>\n<td height=\"15\">4</td>\n<td height=\"15\">绝望:8</td>\n<td height=\"15\">4</td>\n<td height=\"15\">孩子:23</td>\n<td height=\"15\">4</td>\n<td height=\"15\">飞:26</td>\n</tr>\n<tr>\n<td height=\"15\">5</td>\n<td height=\"15\">青春:7</td>\n<td height=\"15\">5</td>\n<td height=\"15\">雨:21</td>\n<td height=\"15\">5</td>\n<td height=\"15\">梦想:14</td>\n</tr>\n<tr>\n<td height=\"15\">6</td>\n<td height=\"15\">迷茫:6</td>\n<td height=\"15\">6</td>\n<td height=\"15\">石头:9</td>\n<td height=\"15\">6</td>\n<td height=\"15\">祈祷:10</td>\n</tr>\n<tr>\n<td height=\"15\">7</td>\n<td height=\"15\">光明:6</td>\n<td height=\"15\">7</td>\n<td height=\"15\">鸟:9</td>\n<td height=\"15\">7</td>\n<td height=\"15\">离去:10</td>\n</tr>\n</tbody>\n</table>\n<p>如果我们随便写一串数字，然后按照数位依次在形容词、名词和动词中取出一个词，连在一起会怎么样呢？</p>\n<p>例如取圆周率 3.1415926，对应的词语是：坚强，路，飞，自由，雨，埋，迷惘。稍微连接和润色一下：</p>\n<p>坚强的孩子，</p>\n<p>依然前行在路上，</p>\n<p>张开翅膀飞向自由，</p>\n<p>让雨水埋葬他的迷惘。</p>\n<p>是不是有点感觉了？当然真正基于统计的学习算法比这个简单的统计复杂的多。</p>\n<p>然而统计学习比较容易理解简单的相关性，例如一个词和另一个词总是一起出现，两个词应该有关系，而无法表达复杂的相关性，并且统计方法的公式往往非常复杂，为了简化计算，常常做出各种独立性的假设，来降低公式的计算难度，然而现实生活中，具有独立性的事件是相对较少的。</p>\n<p>4.5 模拟大脑的工作方式</p>\n<p>于是人类开始从机器的世界，反思人类的世界是怎么工作的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/b78ecfdaeed9af0539b6bd289f6495e5.png\" alt=\"\"></p>\n<p>人类的脑子里面不是存储着大量的规则，也不是记录着大量的统计数据，而是通过神经元的触发实现的，每个神经元有从其他神经元的输入，当接收到输入的时候，会产生一个输出来刺激其他的神经元，于是大量的神经元相互反应，最终形成各种输出的结果。例如当人们看到美女瞳孔放大，绝不是大脑根据身材比例进行规则判断，也不是将人生中看过的所有的美女都统计一遍，而是神经元从视网膜触发到大脑再回到瞳孔。在这个过程中，其实很难总结出每个神经元对最终的结果起到了哪些作用，反正就是起作用了。</p>\n<p>于是人们开始用一个数学单元模拟神经元</p>\n<p>这个神经元有输入，有输出，输入和输出之间通过一个公式来表示，输入根据重要程度不同(权重)，影响着输出。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/a15474e07d6f756d392fca6f0bc15676.png\" alt=\"\"></p>\n<p>于是将n个神经元通过像一张神经网络一样连接在一起，n这个数字可以很大很大，所有的神经元可以分成很多列，每一列很多个排列起来，每个神经元的对于输入的权重可以都不相同，从而每个神经元的公式也不相同。当人们从这张网络中输入一个东西的时候，希望输出一个对人类来讲正确的结果。例如上面的例子，输入一个写着2的图片，输出的列表里面第二个数字最大，其实从机器来讲，它既不知道输入的这个图片写的是2，也不知道输出的这一系列数字的意义，没关系，人知道意义就可以了。正如对于神经元来说，他们既不知道视网膜看到的是美女，也不知道瞳孔放大是为了看的清楚，反正看到美女，瞳孔放大了，就可以了。</p>\n<p>对于任何一张神经网络，谁也不敢保证输入是2，输出一定是第二个数字最大，要保证这个结果，需要训练和学习。毕竟看到美女而瞳孔放大也是人类很多年进化的结果。学习的过程就是，输入大量的图片，如果结果不是想要的结果，则进行调整。如何调整呢，就是每个神经元的每个权重都向目标进行微调，由于神经元和权重实在是太多了，所以整张网络产生的结果很难表现出非此即彼的结果，而是向着结果微微的进步，最终能够达到目标结果。当然这些调整的策略还是非常有技巧的，需要算法的高手来仔细的调整。正如人类见到美女，瞳孔一开始没有放大到能看清楚，于是美女跟别人跑了，下次学习的结果是瞳孔放大一点点，而不是放大鼻孔。</p>\n<p>4.6 没道理但做得到</p>\n<p>听起来也没有那么有道理，但是的确能做到，就是这么任性。</p>\n<p>神经网络的普遍性定理是这样说的，假设某个人给你某种复杂奇特的函数，f(x)：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/a9a06967ca3a6dcf3145db745e2e2b88.png\" alt=\"\"></p>\n<p>不管这个函数是什么样的，总会确保有个神经网络能够对任何可能的输入x，其值f(x)（或者某个能够准确的近似）是神经网络的输出。</p>\n<p>如果在函数代表着规律，也意味着这个规律无论多么奇妙，多么不能理解，都是能通过大量的神经元，通过大量权重的调整，表示出来的。</p>\n<p>4.7 人工智能的经济学解释</p>\n<p>这让我想到了经济学，于是比较容易理解了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/c1fea36ee3b6ed1826e508d6e448557c.png\" alt=\"\"></p>\n<p>我们把每个神经元当成社会中从事经济活动的个体。于是神经网络相当于整个经济社会，每个神经元对于社会的输入，都有权重的调整，做出相应的输出，比如工资涨了，菜价也涨了，股票跌了，我应该怎么办，怎么花自己的钱。这里面没有规律么？肯定有，但是具体什么规律呢？却很难说清楚。</p>\n<p>基于专家系统的经济属于计划经济，整个经济规律的表示不希望通过每个经济个体的独立决策表现出来，而是希望通过专家的高屋建瓴和远见卓识总结出来。专家永远不可能知道哪个城市的哪个街道缺少一个卖甜豆腐脑的。于是专家说应该产多少钢铁，产多少馒头，往往距离人民生活的真正需求有较大的差距，就算整个计划书写个几百页，也无法表达隐藏在人民生活中的小规律。</p>\n<p>基于统计的宏观调控就靠谱的多了，每年统计局都会统计整个社会的就业率，通胀率，GDP等等指标，这些指标往往代表着很多的内在规律，虽然不能够精确表达，但是相对靠谱。然而基于统计的规律总结表达相对比较粗糙，比如经济学家看到这些统计数据可以总结出长期来看房价是涨还是跌，股票长期来看是涨还是跌，如果经济总体上扬，房价和股票应该都是涨的。但是基于统计数据，无法总结出股票，物价的微小波动规律。</p>\n<p>基于神经网络的微观经济学才是对整个经济规律最最准确的表达，每个人对于从社会中的输入，进行各自的调整，并且调整同样会作为输入反馈到社会中。想象一下股市行情细微的波动曲线，正是每个独立的个体各自不断交易的结果，没有统一的规律可循。而每个人根据整个社会的输入进行独立决策，当某些因素经过多次训练，也会形成宏观上的统计性的规律，这也就是宏观经济学所能看到的。例如每次货币大量发行，最后房价都会上涨，多次训练后，人们也就都学会了。</p>\n<p>4.8 人工智能需要大数据</p>\n<p>然而神经网络包含这么多的节点，每个节点包含非常多的参数，整个参数量实在是太大了，需要的计算量实在太大，但是没有关系啊，我们有大数据平台，可以汇聚多台机器的力量一起来计算，才能在有限的时间内得到想要的结果。</p>\n<p>人工智能可以做的事情非常多，例如可以鉴别垃圾邮件，鉴别黄色暴力文字和图片等。这也是经历了三个阶段的。第一个阶段依赖于关键词黑白名单和过滤技术，包含哪些词就是黄色或者暴力的文字。随着这个网络语言越来越多，词也不断的变化，不断的更新这个词库就有点顾不过来。第二个阶段时，基于一些新的算法，比如说贝叶斯过滤等，你不用管贝叶斯算法是什么，但是这个名字你应该听过，这个一个基于概率的算法。第三个阶段就是基于大数据和人工智能，进行更加精准的用户画像和文本理解和图像理解。</p>\n<p>由于人工智能算法多是依赖于大量的数据的，这些数据往往需要面向某个特定的领域(例如电商，邮箱)进行长期的积累，如果没有数据，就算有人工智能算法也白搭，所以人工智能程序很少像前面的IaaS和PaaS一样，将人工智能程序给某个客户安装一套让客户去用，因为给某个客户单独安装一套，客户没有相关的数据做训练，结果往往是很差的。但是云计算厂商往往是积累了大量数据的，于是就在云计算厂商里面安装一套，暴露一个服务接口，比如您想鉴别一个文本是不是涉及黄色和暴力，直接用这个在线服务就可以了。这种形势的服务，在云计算里面称为软件即服务，SaaS (Software AS A Service)</p>\n<p>于是工智能程序作为SaaS平台进入了云计算。</p>\n<p>五、云计算，大数据，人工智能过上了美好的生活</p>\n<p>终于云计算的三兄弟凑齐了，分别是IaaS，PaaS和SaaS，所以一般在一个云计算平台上，云，大数据，人工智能都能找得到。对一个大数据公司，积累了大量的数据，也会使用一些人工智能的算法提供一些服务。对于一个人工智能公司，也不可能没有大数据平台支撑。所以云计算，大数据，人工智能就这样整合起来，完成了相遇，相识，相知。</p>\n<blockquote><p>本文作者刘超，《Lucene应用开发揭秘》。个人公众号：刘超的通俗云计算(popsuper1982)。</p></blockquote>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114005\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114005votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114005\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 1, "tags": "IT技术,云计算,人工智能,大数据", "url_object_id": "4e10d4da22dcb529fe4ac299ec0ce8f8", "title": "终于有人把云计算、大数据和人工智能讲明白了", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/05/6a5fe11e3f98f0f2e1b80bb8e08373cf.png"], "comment_nums": 1, "url": "http://blog.jobbole.com/114005/"},{"praise_nums": "1", "create_date": "2018-05-21", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.jianshu.com/p/cb7021db2d0c\">技匠（微信公众号：techmask）</a>   </div><p>编程的意义是什么，我又为什么要编程呢？这是一个不时会浮现在我脑海中的问题，它来得并不频繁，但每次却都伴随着对自己职业生涯或人生目标的质疑而产生，令我感到些许困惑和不安。而在这十几年的职业生涯中，我也似乎总能在每个阶段为自己找到一个继续热爱编程的理由，直到它已无法解答再一次疑惑的产生。就这样一次又一次的循环往复，我似乎渐渐理解了编程的意义……</p>\n<p><img class=\"alignnone\" src=\"http://jbcdn2.b0.upaiyun.com/2016/07/b82c41ce36630a47a22e10059671eb52.jpg\" width=\"450\" height=\"307\"></p>\n<h3>编程是一项技能</h3>\n<p>回想大学毕业刚成为一名程序员时，自己对技术是如此狂热，我不断地购买各类技术书籍，几乎所有的业余时间也都被用来钻研技术，提高自己的编程能力。我也因此很快成了同一批入职新人中，编码效率和质量最突出的一个。而在那段时间里所做的技术积累，也成了我日后工作的坚实基础，编程作为一项技能已经深深地嵌入到了我的身体里。</p>\n<p>即使到了今天，我仍非常怀念那段心无旁骛，一心钻研技术的日子。我为能在工作中写出的每一行优秀代码而兴奋，更为每一天能在技术上取得的点滴进步而喜悦，一切都是那么单纯，<strong>编程的意义对于那时的我来说就在于技术本身</strong>。</p>\n<h3>编程是去解决问题</h3>\n<p>“能力越大，责任也也大”，这句电影“蜘蛛侠”中的经典台词同样适用于程序员的职业生涯。随着技术能力的提升以及工作中获得的认可，我的职位也由原来的初级程序员变为了资深开发工程师，以及后来的架构师。相应的，除了编程之外，我工作中的很大一部分时间需要用来与用户进行沟通，并分析他们提出的需求。对于我来说这个角色转换的过程，是艰难甚至有些痛苦的。 我不得不用自己最薄弱的沟通技能去和用户打交道，更要命的是我所习惯使用的那些技术语言有时很难让他们理解。</p>\n<p>我很快意识到自己已不再是那个只需被动接受任务安排，并将自己的编程工作完成好就万事大吉的初级程序员。除了技术之外，我更需要能够突破程序员思维，去发现用户需求背后所隐含的真正问题。我比以前变得更加务实，不再刻意追求技术的高深，而是尽可能从问题本身出发，选择最有效的技术手段去解决它。</p>\n<p>此时，编程的意义也发生了改变，<strong>它已不再局限于技术本身，而成了解决问题的理想工具</strong>。</p>\n<h3>编程是在表达，也是在创作</h3>\n<p>就这样又过了几年，当“为什么要编程？”这个问题再次摆在我的面前时，自己也已过了而立之年。对于大多数中国程序员来说，这个年纪已经算是高龄，甚至还有很多人会认为 30 岁还在编程，一定是混得不够好吧。当然，对于这些质疑我也总是一笑了之。其实，在此之前我也有过很多转型的机会，比如去业务部门，或是转作管理等等，但最终我还是选择留在了技术岗位上，因为我觉得编程仍是我最喜欢的，或许也是我唯一擅长的吧。</p>\n<p>而这个时期也成了我整个程序员生涯的黄金期，我写了公司的核心框架以及一些重要业务系统的核心算法。我很享受这段时光，因为我已几乎感受不到那些技术上的牵绊，我更像雕刻师使用手中的刻刀一般，自如地运用编程来实现那些我认为优秀的东西。</p>\n<p>编程对于我来说已不再是一项技能或是工具，我是在<strong>通过编程进行着自我表达与创作</strong>，这种感受带给了我极大的自由度，而我也从中感受到了前所未有的喜悦与乐趣。</p>\n<h3>编程是为了留下痕迹</h3>\n<p>最终我还是走上了管理岗位，这里面有很多个人无法左右的因素（包括大环境、家庭、经济等等）。但我仍然更乐意被大家称为程序员或者“老”程序员。就像在简书的自我介绍中，我总是把全栈工程师放在那些“头衔”的第一位，我也还在利用业余时间做自己喜欢的开源或个人项目。当我再一次问自己“为什么要编程”时，获得了与以往不一样的感悟：<strong>或许我们编程是为了能够留下一些痕迹吧</strong>。</p>\n<p>公司里最近都在为一个老系统的升级问题发愁，这个系统已经运行了将近 20 年时间了，为了升级系统，大家不得不深入到这个系统的框架中，去读底层代码。我们读到了一位已经退休的美国同事Bill所实现的数据库连接池代码。在那个时候JAVA刚开始流行，还没有像 Spring 这样的框架，或是如 Hibernate 或 MyBatis 这样标准的持久层实现，这个系统中所有的数据库连接池及核心持久层代码都是由我的这位美国同事写的，这些代码让整个系统稳定运行了将近20年，大家都不禁为他高超的技术水平发出由衷的赞叹。</p>\n<p>我还认识一位从事证券交易软件研发的公司 CTO，看年纪应该已经接近 50 了，但他仍然在亲自写着那些证券交易的核心代码。当我问他到了这个年龄和职位，为什么还要坚持写代码时，他告诉我，当他看到自己所写的代码每天在支撑着千亿级的证券交易时，他感到非常兴奋和自豪，并不断地希望能够通过自己的努力将它做得更好。</p>\n<p>我的这个美国同事不会听到大家为他十几年前所代码发出的zan叹，股民们也不会知道这位 CTO 所写的代码正在支撑着他们的日常交易。<strong>那些优秀的代码是他们留下的痕迹</strong>，我们不能确定这些痕迹能够保留多久，或许几年，或许更短，但它们都曾经在我们的日常生活中产生了重要的价值，而新的未来也将构建在这些痕迹的基础之上，我想这可能才是编程的意义所在吧。</p>\n<p>我似乎理解了编程的意义，但我明白未来的某一天，我一定还会问自己同样的问题——为什么要编程，希望到那个时候自己还能是那个热爱编程，有着一颗匠心的“技匠”吧……</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112098\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112098votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112098\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 0, "tags": "职场,程序员,职场", "url_object_id": "559edfe4360defce6adda9e865d11934", "title": "我似乎理解了编程的意义", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/07/b82c41ce36630a47a22e10059671eb52.jpg"], "comment_nums": 0, "url": "http://blog.jobbole.com/112098/"},{"praise_nums": "1", "create_date": "2018-05-21", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/rjzheng/p/8994962.html\">孤独烟</a>   </div><h2 id=\"引言\">引言</h2>\n<h3 id=\"为什么写这篇文章\">为什么写这篇文章?</h3>\n<p>博主有两位朋友分别是小A和小B:</p>\n<ol>\n<li>小A，工作于传统软件行业(某社保局的软件外包公司)，每天工作内容就是和产品聊聊需求，改改业务逻辑。再不然就是和运营聊聊天，写几个SQL，生成下报表。又或者接到客服的通知，某某功能故障了，改改数据，然后下班部署上线。每天过的都是这种生活，技术零成长。</li>\n<li>小B，工作于某国企，虽然能接触到一些中间件技术。然而，他只会订阅/发布消息。通俗点说，就是调调API。对为什么使用这些中间件啊？如何保证高可用啊？没有充分的认识。</li>\n</ol>\n<p>庆幸的是两位朋友都很有上进心，于是博主写这篇文章，帮助他们复习一下关于消息队列中间件这块的要点</p>\n<h3 id=\"复习要点\">复习要点</h3>\n<p>本文大概围绕如下几点进行阐述:</p>\n<ol>\n<li>为什么使用消息队列？</li>\n<li>使用消息队列有什么缺点?</li>\n<li>消息队列如何选型?</li>\n<li>如何保证消息队列是高可用的？</li>\n<li>如何保证消息不被重复消费?</li>\n<li>如何保证消费的可靠性传输?</li>\n<li>如何保证消息的顺序性？</li>\n</ol>\n<p>我们围绕以上七点进行阐述。需要说明一下，本文不是《消息队列从入门到精通》这种课程，因此只是提供一个复习思路，而不是去教你们怎么调用消息队列的API。建议对消息队列不了解的人，去找点消息队列的博客看看，再看本文，收获更大</p>\n<h2 id=\"正文\">正文</h2>\n<h3 id=\"为什么要使用消息队列\">1、为什么要使用消息队列?</h3>\n<p><strong>分析</strong>:一个用消息队列的人，不知道为啥用，这就有点尴尬。没有复习这点，很容易被问蒙，然后就开始胡扯了。<br>\n<strong>回答</strong>:这个问题,咱只答三个最主要的应用场景(不可否认还有其他的，但是只答三个主要的),即以下六个字:<strong>解耦、异步、削峰</strong></p>\n<h4 id=\"解耦\">(1)解耦</h4>\n<p><strong>传统模式:</strong><br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/56e7aff9d63f0f4383fa069aa8c8bfb2.png\"><br>\n传统模式的缺点：</p>\n<ul>\n<li>系统间耦合性太强，如上图所示，系统A在代码中直接调用系统B和系统C的代码，如果将来D系统接入，系统A还需要修改代码，过于麻烦！</li>\n</ul>\n<p><strong>中间件模式:</strong><br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/58111d7a4fd8b531bfc034f708a16660.png\"><br>\n中间件模式的的优点：</p>\n<ul>\n<li>将消息写入消息队列，需要消息的系统自己从消息队列中订阅，从而系统A不需要做任何修改。</li>\n</ul>\n<h4 id=\"异步\">(2)异步</h4>\n<p><strong>传统模式:</strong><br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/f143f69236fa3ea412679f166b018249.png\"><br>\n传统模式的缺点：</p>\n<ul>\n<li>一些非必要的业务逻辑以同步的方式运行，太耗费时间。</li>\n</ul>\n<p><strong>中间件模式:</strong><br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/16ac587309c929e6b286d00eed9723f5.png\"><br>\n中间件模式的的优点：</p>\n<ul>\n<li>将消息写入消息队列，非必要的业务逻辑以异步的方式运行，加快响应速度</li>\n</ul>\n<h4 id=\"削峰\">(3)削峰</h4>\n<p><strong>传统模式</strong><br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/a25d591aad6af8be2af03281b0648dbe.png\"><br>\n传统模式的缺点：</p>\n<ul>\n<li>并发量大的时候，所有的请求直接怼到数据库，造成数据库连接异常</li>\n</ul>\n<p><strong>中间件模式:</strong><br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1e39849ee5829567e914ccf126e058ae.png\"><br>\n中间件模式的的优点：</p>\n<ul>\n<li>系统A慢慢的按照数据库能处理的并发量，从消息队列中慢慢拉取消息。在生产中，这个短暂的高峰期积压是允许的。</li>\n</ul>\n<h3 id=\"使用了消息队列会有什么缺点\">2、使用了消息队列会有什么缺点?</h3>\n<p><strong>分析</strong>:一个使用了MQ的项目，如果连这个问题都没有考虑过，就把MQ引进去了，那就给自己的项目带来了风险。我们引入一个技术，要对这个技术的弊端有充分的认识，才能做好预防。<strong>要记住，不要给公司挖坑！</strong><br>\n<strong>回答</strong>:回答也很容易，从以下两个个角度来答</p>\n<ul>\n<li><strong>系统可用性降低</strong>:你想啊，本来其他系统只要运行好好的，那你的系统就是正常的。现在你非要加个消息队列进去，那消息队列挂了，你的系统不是呵呵了。因此，系统可用性降低</li>\n<li><strong>系统复杂性增加</strong>:要多考虑很多方面的问题，比如一致性问题、如何保证消息不被重复消费，如何保证保证消息可靠传输。因此，需要考虑的东西更多，系统复杂性增大。</li>\n</ul>\n<p>但是，我们该用还是要用的。</p>\n<h3 id=\"消息队列如何选型\">3、消息队列如何选型?</h3>\n<p>先说一下，博主只会ActiveMQ,RabbitMQ,RocketMQ,Kafka，对什么ZeroMQ等其他MQ没啥理解，因此只能基于这四种MQ给出回答。<br>\n<strong>分析</strong>:既然在项目中用了MQ，肯定事先要对业界流行的MQ进行调研，如果连每种MQ的优缺点都没了解清楚，就拍脑袋依据喜好，用了某种MQ，还是给项目挖坑。如果面试官问:”你为什么用这种MQ？。”你直接回答”领导决定的。”这种回答就很LOW了。<strong>还是那句话，不要给公司挖坑。</strong><br>\n<strong>回答</strong>:首先，咱先上<a href=\"http://activemq.apache.org/\">ActiveMQ的社区</a>，看看该MQ的更新频率:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a40f23e93754940888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nApache ActiveMQ 5.15.3 Release\r\nChristopher L. Shannon posted on Feb 12, 2018\r\nApache ActiveMQ 5.15.2 Released\r\nChristopher L. Shannon posted on Oct 23, 2017\r\nApache ActiveMQ 5.15.0 Released\r\nChristopher L. Shannon posted on Jul 06, 2017\r\n省略以下记录\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e93754940888-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e93754940888-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e93754940888-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e93754940888-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e93754940888-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e93754940888-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e93754940888-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e93754940888-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a40f23e93754940888-1\"><span class=\"crayon-e\">Apache </span><span class=\"crayon-i\">ActiveMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.15.3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Release</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e93754940888-2\"><span class=\"crayon-i\">Christopher</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Shannon </span><span class=\"crayon-e\">posted </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23e93754940888-3\"><span class=\"crayon-e\">Apache </span><span class=\"crayon-i\">ActiveMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.15.2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Released</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e93754940888-4\"><span class=\"crayon-i\">Christopher</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Shannon </span><span class=\"crayon-e\">posted </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">Oct</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23e93754940888-5\"><span class=\"crayon-e\">Apache </span><span class=\"crayon-i\">ActiveMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.15.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Released</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e93754940888-6\"><span class=\"crayon-i\">Christopher</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">L</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Shannon </span><span class=\"crayon-e\">posted </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23e93754940888-7\">省略以下记录</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e93754940888-8\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>我们可以看出，ActiveMq几个月才发一次版本，据说研究重心在他们的下一代产品Apollo。<br>\n接下来，我们再去<a href=\"http://www.rabbitmq.com/\">RabbitMQ的社区</a>去看一下,RabbitMQ的更新频率</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a40f23e9d419132289\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRabbitMQ 3.7.3 release  30 January 2018\r\nRabbitMQ 3.6.15 release  17 January 2018\r\nRabbitMQ 3.7.2 release23 December 2017\r\nRabbitMQ 3.7.1 release21 December 2017\r\n省略以下记录\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e9d419132289-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e9d419132289-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e9d419132289-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e9d419132289-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23e9d419132289-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23e9d419132289-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a40f23e9d419132289-1\"><span class=\"crayon-i\">RabbitMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.7.3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">release</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">January</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e9d419132289-2\"><span class=\"crayon-i\">RabbitMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.6.15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">release</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">January</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23e9d419132289-3\"><span class=\"crayon-i\">RabbitMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.7.2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">release23 </span><span class=\"crayon-i\">December</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e9d419132289-4\"><span class=\"crayon-i\">RabbitMQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.7.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">release21 </span><span class=\"crayon-i\">December</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23e9d419132289-5\">省略以下记录</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23e9d419132289-6\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>我们可以看出，RabbitMQ版本发布比ActiveMq频繁很多。至于RocketMQ和kafka就不带大家看了，总之也比ActiveMQ活跃的多。详情，可自行查阅。<br>\n再来一个性能对比表</p>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>ActiveMQ</th>\n<th>RabbitMQ</th>\n<th>RocketMQ</th>\n<th>kafka</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>开发语言</td>\n<td>java</td>\n<td>erlang</td>\n<td>java</td>\n<td>scala</td>\n</tr>\n<tr>\n<td>单机吞吐量</td>\n<td>万级</td>\n<td>万级</td>\n<td>10万级</td>\n<td>10万级</td>\n</tr>\n<tr>\n<td>时效性</td>\n<td>ms级</td>\n<td>us级</td>\n<td>ms级</td>\n<td>ms级以内</td>\n</tr>\n<tr>\n<td>可用性</td>\n<td>高(主从架构)</td>\n<td>高(主从架构)</td>\n<td>非常高(分布式架构)</td>\n<td>非常高(分布式架构)</td>\n</tr>\n<tr>\n<td>功能特性</td>\n<td>成熟的产品，在很多公司得到应用；有较多的文档；各种协议支持较好</td>\n<td>基于erlang开发，所以并发能力很强，性能极其好，延时很低;管理界面较丰富</td>\n<td>MQ功能比较完备，扩展性佳</td>\n<td>只支持主要的MQ功能，像一些消息查询，消息回溯等功能没有提供，毕竟是为大数据准备的，在大数据领域应用广。</td>\n</tr>\n</tbody>\n</table>\n<p>综合上面的材料得出以下两点:<br>\n(1)中小型软件公司，建议选RabbitMQ.一方面，erlang语言天生具备高并发的特性，而且他的管理界面用起来十分方便。正所谓，成也萧何，败也萧何！他的弊端也在这里，虽然RabbitMQ是开源的，然而国内有几个能定制化开发erlang的程序员呢？所幸，RabbitMQ的社区十分活跃，可以解决开发过程中遇到的bug，这点对于中小型公司来说十分重要。不考虑rocketmq和kafka的原因是，一方面中小型软件公司不如互联网公司，数据量没那么大，选消息中间件，应首选功能比较完备的，所以kafka排除。不考虑rocketmq的原因是，rocketmq是阿里出品，如果阿里放弃维护rocketmq，中小型公司一般抽不出人来进行rocketmq的定制化开发，因此不推荐。<br>\n(2)大型软件公司，根据具体使用在rocketMq和kafka之间二选一。一方面，大型软件公司，具备足够的资金搭建分布式环境，也具备足够大的数据量。针对rocketMQ,大型软件公司也可以抽出人手对rocketMQ进行定制化开发，毕竟国内有能力改JAVA源码的人，还是相当多的。至于kafka，根据业务场景选择，如果有日志采集功能，肯定是首选kafka了。具体该选哪个，看使用场景。</p>\n<h3 id=\"如何保证消息队列是高可用的\">4、如何保证消息队列是高可用的？</h3>\n<p><strong>分析</strong>:在第二点说过了，引入消息队列后，系统的可用性下降。在生产中，没人使用单机模式的消息队列。因此，作为一个合格的程序员，应该对消息队列的高可用有很深刻的了解。如果面试的时候，面试官问，你们的消息中间件如何保证高可用的？你的回答只是表明自己只会订阅和发布消息，面试官就会怀疑你是不是只是自己搭着玩，压根没在生产用过。<strong>请做一个爱思考，会思考，懂思考的程序员。</strong><br>\n<strong>回答</strong>:这问题，其实要对消息队列的集群模式要有深刻了解，才好回答。<br>\n以rcoketMQ为例，他的集群就有多master 模式、多master多slave异步复制模式、多 master多slave同步双写模式。多master多slave模式部署架构图(网上找的,偷个懒，懒得画):<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/b80ee0d20718dbdd97cf522295312787.png\" alt=\"image\"><br>\n其实博主第一眼看到这个图，就觉得和kafka好像，只是NameServer集群，在kafka中是用zookeeper代替，都是用来保存和发现master和slave用的。通信过程如下:<br>\nProducer 与 NameServer集群中的其中一个节点（随机选择）建立长连接，定期从 NameServer 获取 Topic 路由信息，并向提供 Topic 服务的 Broker Master 建立长连接，且定时向 Broker 发送心跳。Producer 只能将消息发送到 Broker master，但是 Consumer 则不一样，它同时和提供 Topic 服务的 Master 和 Slave建立长连接，既可以从 Broker Master 订阅消息，也可以从 Broker Slave 订阅消息。<br>\n那么kafka呢,为了对比说明直接上kafka的拓补架构图(也是找的，懒得画)<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/7a938865203b9c2ff91a37429991b9a6.png\" alt=\"image\"><br>\n如上图所示，一个典型的Kafka集群中包含若干Producer（可以是web前端产生的Page View，或者是服务器日志，系统CPU、Memory等），若干broker（Kafka支持水平扩展，一般broker数量越多，集群吞吐率越高），若干Consumer Group，以及一个Zookeeper集群。Kafka通过Zookeeper管理集群配置，选举leader，以及在Consumer Group发生变化时进行rebalance。Producer使用push模式将消息发布到broker，Consumer使用pull模式从broker订阅并消费消息。<br>\n至于rabbitMQ,也有普通集群和镜像集群模式，自行去了解，比较简单，两小时即懂。<br>\n要求，在回答高可用的问题时，应该能逻辑清晰的画出自己的MQ集群架构或清晰的叙述出来。</p>\n<h3 id=\"如何保证消息不被重复消费\">5、如何保证消息不被重复消费？</h3>\n<p><strong>分析</strong>:这个问题其实换一种问法就是，如何保证消息队列的幂等性?这个问题可以认为是消息队列领域的基本问题。换句话来说，是在考察你的设计能力，这个问题的回答可以根据具体的业务场景来答，没有固定的答案。<br>\n<strong>回答</strong>:先来说一下为什么会造成重复消费?<br>\n其实无论是那种消息队列，造成重复消费原因其实都是类似的。正常情况下，消费者在消费消息时候，消费完毕后，会发送一个确认信息给消息队列，消息队列就知道该消息被消费了，就会将该消息从消息队列中删除。只是不同的消息队列发送的确认信息形式不同,例如RabbitMQ是发送一个ACK确认消息，RocketMQ是返回一个CONSUME_SUCCESS成功标志，kafka实际上有个offset的概念，简单说一下(如果还不懂，出门找一个kafka入门到精通教程),就是每一个消息都有一个offset，kafka消费过消息后，需要提交offset，让消息队列知道自己已经消费过了。那造成重复消费的原因?，就是因为网络传输等等故障，确认信息没有传送到消息队列，导致消息队列不知道自己已经消费过该消息了，再次将该消息分发给其他的消费者。<br>\n如何解决?这个问题针对业务场景来答分以下几点<br>\n(1)比如，你拿到这个消息做数据库的insert操作。那就容易了，给这个消息做一个唯一主键，那么就算出现重复消费的情况，就会导致主键冲突，避免数据库出现脏数据。<br>\n(2)再比如，你拿到这个消息做redis的set的操作，那就容易了，不用解决，因为你无论set几次结果都是一样的，set操作本来就算幂等操作。<br>\n(3)如果上面两种情况还不行，上大招。准备一个第三方介质,来做消费记录。以redis为例，给消息分配一个全局id，只要消费过该消息，将&lt;id,message&gt;以K-V形式写入redis。那消费者开始消费前，先去redis中查询有没消费记录即可。</p>\n<h3 id=\"如何保证消费的可靠性传输\">6、如何保证消费的可靠性传输?</h3>\n<p><strong>分析</strong>:我们在使用消息队列的过程中，应该做到消息不能多消费，也不能少消费。如果无法做到可靠性传输，可能给公司带来千万级别的财产损失。同样的，如果可靠性传输在使用过程中，没有考虑到，这不是给公司挖坑么，你可以拍拍屁股走了，公司损失的钱，谁承担。还是那句话，<strong>认真对待每一个项目，不要给公司挖坑。</strong><br>\n<strong>回答</strong>:其实这个可靠性传输，每种MQ都要从三个角度来分析:生产者弄丢数据、消息队列弄丢数据、消费者弄丢数据</p>\n<h4 id=\"rabbitmq\">RabbitMQ</h4>\n<p><strong>(1)生产者丢数据</strong><br>\n从生产者弄丢数据这个角度来看，RabbitMQ提供transaction和confirm模式来确保生产者不丢消息。<br>\ntransaction机制就是说，发送消息前，开启事物(channel.txSelect())，然后发送消息，如果发送过程中出现什么异常，事物就会回滚(channel.txRollback())，如果发送成功则提交事物(channel.txCommit())。<br>\n然而缺点就是吞吐量下降了。因此，按照博主的经验，生产上用confirm模式的居多。一旦channel进入confirm模式，所有在该信道上面发布的消息都将会被指派一个唯一的ID(从1开始)，一旦消息被投递到所有匹配的队列之后，rabbitMQ就会发送一个Ack给生产者(包含消息的唯一ID)，这就使得生产者知道消息已经正确到达目的队列了.如果rabiitMQ没能处理该消息，则会发送一个Nack消息给你，你可以进行重试操作。处理Ack和Nack的代码如下所示（说好不上代码的，偷偷上了）:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a40f23ea6993817054\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchannel.addConfirmListener(new ConfirmListener() {  \r\n                &lt;a href=\"http://www.jobbole.com/members/wx610506454\"&gt;@Override&lt;/a&gt;  \r\n                public void handleNack(long deliveryTag, boolean multiple) throws IOException {  \r\n                    System.out.println(\"nack: deliveryTag = \"+deliveryTag+\" multiple: \"+multiple);  \r\n                }  \r\n                &lt;a href=\"http://www.jobbole.com/members/wx610506454\"&gt;@Override&lt;/a&gt;  \r\n                public void handleAck(long deliveryTag, boolean multiple) throws IOException {  \r\n                    System.out.println(\"ack: deliveryTag = \"+deliveryTag+\" multiple: \"+multiple);  \r\n                }  \r\n            });  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23ea6993817054-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23ea6993817054-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23ea6993817054-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23ea6993817054-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23ea6993817054-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23ea6993817054-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23ea6993817054-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23ea6993817054-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a40f23ea6993817054-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a40f23ea6993817054-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a40f23ea6993817054-1\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addConfirmListener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ConfirmListener</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23ea6993817054-2\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx610506454\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23ea6993817054-3\"><span class=\"crayon-h\">                </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handleNack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deliveryTag</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">multiple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23ea6993817054-4\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"nack: deliveryTag = \"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">deliveryTag</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\" multiple: \"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">multiple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23ea6993817054-5\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23ea6993817054-6\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx610506454\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23ea6993817054-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handleAck</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deliveryTag</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">multiple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23ea6993817054-8\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ack: deliveryTag = \"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">deliveryTag</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\" multiple: \"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">multiple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a40f23ea6993817054-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a40f23ea6993817054-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p><strong>(2)消息队列丢数据</strong><br>\n处理消息队列丢数据的情况，一般是开启持久化磁盘的配置。这个持久化配置可以和confirm机制配合使用，你可以在消息持久化磁盘后，再给生产者发送一个Ack信号。这样，如果消息持久化磁盘之前，rabbitMQ阵亡了，那么生产者收不到Ack信号，生产者会自动重发。<br>\n那么如何持久化呢，这里顺便说一下吧，其实也很容易，就下面两步<br>\n1、将queue的持久化标识durable设置为true,则代表是一个持久的队列<br>\n2、发送消息的时候将deliveryMode=2<br>\n这样设置以后，rabbitMQ就算挂了，重启后也能恢复数据<br>\n<strong>(3)消费者丢数据</strong><br>\n消费者丢数据一般是因为采用了自动确认消息模式。这种模式下，消费者会自动确认收到信息。这时rahbitMQ会立即将消息删除，这种情况下如果消费者出现异常而没能处理该消息，就会丢失该消息。<br>\n至于解决方案，采用手动确认消息即可。</p>\n<h4 id=\"kafka\">kafka</h4>\n<p>这里先引一张kafka Replication的<a href=\"http://www.infoq.com/cn/articles/kafka-analysis-part-2/\">数据流向图</a><br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/aa0ea1ebe9e63e04c033e8544bf8e944.png\" alt=\"image\"><br>\nProducer在发布消息到某个Partition时，先通过ZooKeeper找到该Partition的Leader，然后无论该Topic的Replication Factor为多少（也即该Partition有多少个Replica），Producer只将该消息发送到该Partition的Leader。Leader会将该消息写入其本地Log。每个Follower都从Leader中pull数据。<br>\n针对上述情况，得出如下分析<br>\n<strong>(1)生产者丢数据</strong><br>\n在kafka生产中，基本都有一个leader和多个follwer。follwer会去同步leader的信息。因此，为了避免生产者丢数据，做如下两点配置</p>\n<ol>\n<li>第一个配置要在producer端设置acks=all。这个配置保证了，follwer同步完成后，才认为消息发送成功。</li>\n<li>在producer端设置retries=MAX，一旦写入失败，这无限重试</li>\n</ol>\n<p><strong>(2)消息队列丢数据</strong><br>\n针对消息队列丢数据的情况，无外乎就是，数据还没同步，leader就挂了，这时zookpeer会将其他的follwer切换为leader,那数据就丢失了。针对这种情况，应该做两个配置。</p>\n<ol>\n<li>replication.factor参数，这个值必须大于1，即要求每个partition必须有至少2个副本</li>\n<li>min.insync.replicas参数，这个值必须大于1，这个是要求一个leader至少感知到有至少一个follower还跟自己保持联系</li>\n</ol>\n<p>这两个配置加上上面生产者的配置联合起来用，基本可确保kafka不丢数据</p>\n<p><strong>(3)消费者丢数据</strong><br>\n这种情况一般是自动提交了offset，然后你处理程序过程中挂了。kafka以为你处理好了。再强调一次offset是干嘛的<br>\n<strong>offset</strong>：指的是kafka的topic中的每个消费组消费的下标。简单的来说就是一条消息对应一个offset下标，每次消费数据的时候如果提交offset，那么下次消费就会从提交的offset加一那里开始消费。<br>\n比如一个topic中有100条数据，我消费了50条并且提交了，那么此时的kafka服务端记录提交的offset就是49(offset从0开始)，那么下次消费的时候offset就从50开始消费。<br>\n解决方案也很简单，改成手动提交即可。</p>\n<h4 id=\"activemq和rocketmq\">ActiveMQ和RocketMQ</h4>\n<p>大家自行查阅吧</p>\n<h3 id=\"如何保证消息的顺序性\">7、如何保证消息的顺序性？</h3>\n<p><strong>分析</strong>:其实并非所有的公司都有这种业务需求，但是还是对这个问题要有所复习。<br>\n<strong>回答</strong>:针对这个问题，通过某种算法，将需要保持先后顺序的消息放到同一个消息队列中(kafka中就是partition,rabbitMq中就是queue)。然后只用一个消费者去消费该队列。<br>\n有的人会问:那如果为了吞吐量，有多个消费者去消费怎么办？<br>\n这个问题，没有固定回答的套路。比如我们有一个微博的操作，发微博、写评论、删除微博，这三个异步操作。如果是这样一个业务场景，那只要重试就行。比如你一个消费者先执行了写评论的操作，但是这时候，微博都还没发，写评论一定是失败的，等一段时间。等另一个消费者，先执行写评论的操作后，再执行，就可以成功。<br>\n总之，针对这个问题，我的观点是保证入队有序就行，出队以后的顺序交给消费者自己去保证，没有固定套路。</p>\n<h2 id=\"总结\">总结</h2>\n<p>写到这里，希望读者把本文提出的这几个问题，经过深刻的准备后，一般来说，能囊括大部分的消息队列的知识点。如果面试官不问这几个问题怎么办，简单，自己把几个问题讲清楚，突出以下自己考虑的全面性。<br>\n最后，其实我不太提倡这样突击复习，希望大家打好基本功，<strong>做一个爱思考，懂思考，会思考的程序员</strong>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114016\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114016votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114016\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 1, "tags": "IT技术,分布式,数据库", "url_object_id": "1b36123333a36dfc38deb859d6cb3ce6", "title": "分布式之消息队列复习精讲", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "comment_nums": 1, "url": "http://blog.jobbole.com/114016/"},{"praise_nums": "2", "create_date": "2018-05-13", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/a1ickgu0\">Alick</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://towardsdatascience.com/10-common-software-architectural-patterns-in-a-nutshell-a0b47a1e9013\">towardsdatascience.com</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>你是否曾经思考过如何设计大型的企业级系统？在决定启动软件开发之前，首要的是选择恰当的架构来指引系统的功能及质量属性设计。因此在将软件架构应用于设计之前，必需要了解常用的架构模式。</p>\n<p><img src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233646527354.jpg\" alt=\"\"></p>\n<h2>什么是架构模式?</h2>\n<p>Wikipedia 的解释：</p>\n<blockquote><p>在软件架构中，架构模式是对特定环境下常见问题的通用且可重用的解决方案。架构模式与软件设计模式很相似，但架构模式的层次更高，且外延更大。</p></blockquote>\n<p>这篇文章将简述常见的 10 种架构模式的概念、用法以及其优缺点。</p>\n<ol>\n<li>分层模式(Layered pattern)</li>\n<li>客户端／服务器模式(Client-server pattern)</li>\n<li>主／从模式(Master-slave pattern)</li>\n<li>管道／过滤器模式(Pipe-filter pattern)</li>\n<li>代理模式(Broker pattern)</li>\n<li>对等模式(Peer-to-peer pattern)</li>\n<li>事件总线模式(Event-bus pattern)</li>\n<li>模型／视图／控制器(MVC)模式(Model-view-controller pattern)</li>\n<li>黑板模式(Blackboard pattern)</li>\n<li>解析器模式(Interpreter pattern)</li>\n</ol>\n<h2>1. 分层模式(Layered pattern)</h2>\n<p>分层模式用于对结构化设计的软件进行层次拆解，每个层次为独立的抽象，为其上层抽象提供服务。</p>\n<p>系统通常被拆分为以下四个层次：</p>\n<ul>\n<li>表示层（也称为 UI 层）</li>\n<li>应用层（也称为服务层）</li>\n<li>业务逻辑层（也称为领域层）</li>\n<li>数据访问层（也称为持久化层）</li>\n</ul>\n<h3>使用场景</h3>\n<ul>\n<li>通用桌面应用程序</li>\n<li>电子商务 Web 应用</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233648925198.jpg\" alt=\"\"></p>\n<h2>2. 客户端／服务器模式(Client-server pattern)</h2>\n<p>客户端／服务器模式由两个部分构成：一个服务器与多个客户端。服务器组件同时为多个客户端组件提供服务。客户端向服务器发启服务请求，服务器将相应服务信息回应给客户端。此外，服务器持续监听来自客户端的请求。</p>\n<h3>使用场景</h3>\n<ul>\n<li>电子邮件、文件共享及银行业务等在线应用</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233717833733.jpg\" alt=\"\"></p>\n<h2>3. 主／从模式(Master-slave pattern)</h2>\n<p>主／从模式由两个部分构成：主设备与从设备。主服务组件将作业分发给多个从设备组件，并根据这些从设备反馈的结果，计算生成最终结果。</p>\n<h3>使用场景</h3>\n<ul>\n<li>数据库复制，主数据库被认定为权威数据源，各从数据库与主数据保持同步</li>\n<li>在计算机系统中通过总线互连的各设备（包括主设备与从设备）</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233718238936.jpg\" alt=\"\"></p>\n<h2>4. 管道／过滤器模式(Pipe-filter pattern)</h2>\n<p>管道／过滤器模式用于构造用于生成及处理数据流的系统。每个处理过程都封装在<code>过滤器（filter）</code>组件之中，要处理的数据通过 <code>管道(pips)</code> 进行投递。管道同时用于作为 <code>过滤器（filter）</code> 间的缓冲及同步。</p>\n<h3>使用场景</h3>\n<ul>\n<li>编译器，一系列的过滤器用于词法分析、语法分析、语义分析及代码生成</li>\n<li>生物信息学的工作流</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233718865512.jpg\" alt=\"\"></p>\n<h2>5. 代理模式（Broker pattern）</h2>\n<p>代理模式用于在结构化系统中对组件解耦。系统内各组件间采用远过程调用（remote service invocations）的方式交互。<strong>代理（Broker）</strong>组件充当组件间通讯的协调角色。</p>\n<p>提供服务的组件将其能力（服务以及特性）发布给代理，客户端均向代理请求服务，由代理将请求重定向到先前已发布过对应服务的组件进行处理。</p>\n<h2>使用场景</h2>\n<ul>\n<li>消息中间件软件：Apache ActiveMQ，Apache Kafka，RabbitMQ 与 JBoss 等等</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233719444041.jpg\" alt=\"\"></p>\n<h2>6. 对等模式(Peer-to-peer pattern)</h2>\n<p>对等模式中的组件称之为对等体（peer），对等体既作为向其他对等体请求服务的客户端，同时也做为响应其他对等体请求的服务端。对等体可以在运行过程中动态地改变其角色，即，既可以单独做为客户端或服务端运行，又可同时作为客户端与服务端运行。</p>\n<h3>使用场景</h3>\n<ul>\n<li>网络文件共享：<a href=\"https://en.wikipedia.org/wiki/Gnutella\">Gnutella</a> 与 <a href=\"https://en.wikipedia.org/wiki/Gnutella2\">G2</a>)</li>\n<li>流媒体协议：<a href=\"https://en.wikipedia.org/wiki/P2PTV\">P2PTV</a> 与 <a href=\"https://en.wikipedia.org/wiki/Peer_Distributed_Transfer_Protocol\">PDTP</a>.</li>\n<li>流媒体应用： <a href=\"https://en.wikipedia.org/wiki/Spotify\">Spotify</a>.</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233720492236.jpg\" alt=\"\"></p>\n<h2>7. 事件总线模式（Event-bus pattern）</h2>\n<p>事件总线模式应用于事件处理，主要由四个组件构成：<strong>事件源（event source），事件侦听者（event listener），通道（Channel）以及总线（event bus）</strong>。 事件源将消息发布到总线的特定通道，侦听者订阅相应的通道，事件源所发布的消息经通道通告给订阅通道的侦听者。</p>\n<h3>使用场景</h3>\n<ul>\n<li>Android 开发</li>\n<li>通告（Notification）服务</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233720911021.jpg\" alt=\"\"></p>\n<h2>8. 模型／视图／控制器(MVC)模式（Model-view-controller pattern）</h2>\n<p>模型／视图／控制器模式（简称 MVC 模式）将交互式应用程序拆分为三个部分：</p>\n<ol>\n<li><strong>模型（model）</strong> – 包含核心功能及数据</li>\n<li><strong>视图（view）</strong> – 呈现信息给用户（通过有多个视图）</li>\n<li><strong>控制器（controller）</strong> – 处理用户的输入操作</li>\n</ol>\n<p>MVC 模式通过将内部信息表示、用户信息呈现以及用户操作接收分开的方式解耦组件，实现高效代码重用。</p>\n<h3>使用场景</h3>\n<ul>\n<li>主流开发语言所构建的互联网网页应用架构</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Django_%28web_framework%29\">Django</a> 与 <a href=\"https://en.wikipedia.org/wiki/Ruby_on_Rails\">Rails</a> 等网页应用开发框架</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233721635183.jpg\" alt=\"\"></p>\n<h2>9. 黑板模式（Blackboard pattern）</h2>\n<p>黑板模式适用于 <code>无预知确定解决策略</code> 的问题，主要由三个组件构成：</p>\n<ul>\n<li><strong>黑板（blackboard）</strong> – 用于存储解空间对象的结构化全局内存</li>\n<li><strong>知识（knowledge）</strong>源 – 能自表意的专用模块</li>\n<li><strong>控制（control）</strong>组件 – 选择、配置与执行的模块</li>\n</ul>\n<p>所有的组件均能访问黑板，组件可将新生成的数据对象写入黑板，也可以通过模式匹配从黑板中获取知识源所生成的特定数据。</p>\n<h3>使用场景</h3>\n<ul>\n<li>语音识别</li>\n<li>车辆识别和追踪</li>\n<li>蛋白质的结构鉴定</li>\n<li>声纳信号解析</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233722237447.jpg\" alt=\"\"></p>\n<h2>10. 解析器模式（Interpreter pattern）</h2>\n<p>解析器模式用于设计语言的解析程序，主要用于指定评估程序代码行，即解析出特定语言的语句与表达式，其核心思想是为语言的每个符号定义相应的类。</p>\n<h3>使用场景</h3>\n<ul>\n<li>SQL 等数据库查询语言</li>\n<li>通讯协议描述语言</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233722490294.jpg\" alt=\"\"></p>\n<h2>上述架构模式的对比</h2>\n<p>下表格总结了各架构模式的优缺点</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/525d773e6ca3b2bebc40eb22baac20cf.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/525d773e6ca3b2bebc40eb22baac20cf.png\" alt=\"10-arch2\"></a></p>\n<p>希望这篇文章对你所帮助，同时我也想听听你的想法。😇</p>\n<p>感谢阅读</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113953\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113953votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113953\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/a1ickgu0\">Alick</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/a1ickgu0\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/06/b6542d1884eed47149da8f68b90a8fc1-300x300.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            这个码农很懒，啥也没有留下.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/a1ickgu0\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/a1ickgu0/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/a1ickgu0/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 30</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/1798547731/\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 8, "tags": "IT技术", "url_object_id": "957e4ea5a4a89c6e0be1752b3db3a295", "title": "10 个常用的软件架构模式", "front_image_url": ["http://7xjudy.com1.z0.glb.clouddn.com/2018-04-25-15233646527354.jpg"], "comment_nums": 8, "url": "http://blog.jobbole.com/113953/"},{"praise_nums": "2", "create_date": "2018-05-19", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/rjzheng/p/8908073.html\">孤独烟</a>   </div><h2 id=\"什么是缓存击穿\">什么是缓存击穿</h2>\n<p>在谈论缓存击穿之前，我们先来回忆下从缓存中加载数据的逻辑，如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/927e850b8c5ae23d93f46b212108ca38.png\" alt=\"image\"></p>\n<p>因此，如果黑客每次故意查询一个在缓存内必然不存在的数据，导致每次请求都要去存储层去查询，这样缓存就失去了意义。如果在大流量下数据库可能挂掉。这就是缓存击穿。<br>\n场景如下图所示:<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/416c99b6f355c9d20931df6027f4a21c.png\" alt=\"image\"></p>\n<p>我们正常人在登录首页的时候，都是根据userID来命中数据，然而黑客的目的是破坏你的系统，黑客可以随机生成一堆userID,然后将这些请求怼到你的服务器上，这些请求在缓存中不存在，就会穿过缓存，直接怼到数据库上,从而造成数据库连接异常。</p>\n<h2 id=\"解决方案\">解决方案</h2>\n<p>在这里我们给出三套解决方案，大家根据项目中的实际情况，选择使用.</p>\n<p>讲下述三种方案前，我们先回忆下redis的setnx方法</p>\n<p><strong>SETNX</strong> <strong>key</strong> <strong>value</strong></p>\n<p>将 key 的值设为 value ，当且仅当 key 不存在。</p>\n<p>若给定的 key 已经存在，则 SETNX 不做任何动作。</p>\n<p>SETNX 是『SET if Not eXists』(如果不存在，则 SET)的简写。</p>\n<p><strong>可用版本</strong>：&gt;= 1.0.0</p>\n<p><strong>时间复杂度：</strong> O(1)</p>\n<p><strong>返回值：</strong> 设置成功，返回 1。设置失败，返回 0 。</p>\n<p>效果如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39b6898460381\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis&gt; EXISTS job                # job 不存在\r\n(integer) 0\r\n\r\nredis&gt; SETNX job \"programmer\"    # job 设置成功\r\n(integer) 1\r\n\r\nredis&gt; SETNX job \"code-farmer\"   # 尝试覆盖 job ，失败\r\n(integer) 0\r\n\r\nredis&gt; GET job                   # 没有被覆盖\r\n\"programmer\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39b6898460381-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39b6898460381-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39b6898460381-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39b6898460381-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39b6898460381-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39b6898460381-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39b6898460381-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39b6898460381-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39b6898460381-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39b6898460381-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39b6898460381-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39b6898460381-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS </span><span class=\"crayon-v\">job</span><span class=\"crayon-h\">                </span><span class=\"crayon-p\"># job 不存在</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39b6898460381-2\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39b6898460381-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39b6898460381-4\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SETNX </span><span class=\"crayon-i\">job</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"programmer\"</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># job 设置成功</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39b6898460381-5\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39b6898460381-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39b6898460381-7\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SETNX </span><span class=\"crayon-i\">job</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"code-farmer\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-p\"># 尝试覆盖 job ，失败</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39b6898460381-8\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39b6898460381-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39b6898460381-10\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">job</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># 没有被覆盖</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39b6898460381-11\"><span class=\"crayon-s\">\"programmer\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p>\n<h3 id=\"使用互斥锁\">1、使用互斥锁</h3>\n<p>该方法是比较普遍的做法，即，在根据key获得的value值为空时，先锁上，再从数据库加载，加载完毕，释放锁。若其他线程发现获取锁失败，则睡眠50ms后重试。</p>\n<p>至于锁的类型，单机环境用并发包的Lock类型就行，集群环境则使用分布式锁( redis的setnx)</p>\n<p>集群环境的redis的代码如下所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39c2029776276\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nString get(String key) {  \r\n   String value = redis.get(key);  \r\n   if (value  == null) {  \r\n    if (redis.setnx(key_mutex, \"1\")) {  \r\n        // 3 min timeout to avoid mutex holder crash  \r\n        redis.expire(key_mutex, 3 * 60)  \r\n        value = db.get(key);  \r\n        redis.set(key, value);  \r\n        redis.delete(key_mutex);  \r\n    } else {  \r\n        //其他线程休息50毫秒后重试  \r\n        Thread.sleep(50);  \r\n        get(key);  \r\n    }  \r\n  }  \r\n}  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c2029776276-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c2029776276-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-1\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setnx</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key_mutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 3 min timeout to avoid mutex holder crash  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">expire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key_mutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key_mutex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//其他线程休息50毫秒后重试  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c2029776276-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c2029776276-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p><strong>优点:</strong></p>\n<ol>\n<li>思路简单</li>\n<li>保证一致性</li>\n</ol>\n<p><strong>缺点</strong></p>\n<ol>\n<li>代码复杂度增大</li>\n<li>存在死锁的风险</li>\n</ol>\n<h3 id=\"异步构建缓存\">2、异步构建缓存</h3>\n<p>在这种方案下，构建缓存采取异步策略，会从线程池中取线程来异步构建缓存，从而不会让所有的请求直接怼到数据库上。该方案redis自己维护一个timeout，当timeout小于System.currentTimeMillis()时，则进行缓存更新，否则直接返回value值。<br>\n集群环境的redis代码如下所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39c7204016907\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nString get(final String key) {  \r\n        V v = redis.get(key);  \r\n        String value = v.getValue();  \r\n        long timeout = v.getTimeout();  \r\n        if (v.timeout &lt;= System.currentTimeMillis()) {  \r\n            // 异步更新后台异常执行  \r\n            threadPool.execute(new Runnable() {  \r\n                public void run() {  \r\n                    String keyMutex = \"mutex:\" + key;  \r\n                    if (redis.setnx(keyMutex, \"1\")) {  \r\n                        // 3 min timeout to avoid mutex holder crash  \r\n                        redis.expire(keyMutex, 3 * 60);  \r\n                        String dbValue = db.get(key);  \r\n                        redis.set(key, dbValue);  \r\n                        redis.delete(keyMutex);  \r\n                    }  \r\n                }  \r\n            });  \r\n        }  \r\n        return value;  \r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39c7204016907-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39c7204016907-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-1\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">V</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 异步更新后台异常执行  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">threadPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Runnable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-9\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mutex:\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-10\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setnx</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-11\"><span class=\"crayon-h\">                        </span><span class=\"crayon-c\">// 3 min timeout to avoid mutex holder crash  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">expire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-13\"><span class=\"crayon-h\">                        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbValue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-14\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbValue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-15\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-16\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39c7204016907-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39c7204016907-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0104 seconds] -->\r\n<p><strong>优点:</strong></p>\n<ol>\n<li>性价最佳，用户无需等待</li>\n</ol>\n<p><strong>缺点</strong></p>\n<ol>\n<li>无法保证缓存一致性</li>\n</ol>\n<h3 id=\"布隆过滤器\">3、布隆过滤器</h3>\n<h4 id=\"原理\">1、原理</h4>\n<p>布隆过滤器的巨大用处就是，能够迅速判断一个元素是否在一个集合中。因此他有如下三个使用场景:</p>\n<ol>\n<li>网页爬虫对URL的去重，避免爬取相同的URL地址</li>\n<li>反垃圾邮件，从数十亿个垃圾邮件列表中判断某邮箱是否垃圾邮箱（同理，垃圾短信）</li>\n<li>缓存击穿，将已存在的缓存放到布隆过滤器中，当黑客访问不存在的缓存时迅速返回避免缓存及DB挂掉。</li>\n</ol>\n<p>OK，接下来我们来谈谈布隆过滤器的原理<br>\n其内部维护一个全为0的bit数组，需要说明的是，布隆过滤器有一个误判率的概念，误判率越低，则数组越长，所占空间越大。误判率越高则数组越小，所占的空间越小。</p>\n<p>假设，根据误判率，我们生成一个10位的bit数组，以及2个hash函数（(f_1,f_2)），如下图所示(生成的数组的位数和hash函数的数量，我们不用去关心是如何生成的，有数学论文进行过专业的证明)。<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/6aa626ab277b7657acfdd791d67b2af4.png\" alt=\"image\"></p>\n<p>假设输入集合为((N_1,N_2)),经过计算(f_1(N_1))得到的数值得为2，(f_2(N_1))得到的数值为5，则将数组下标为2和下表为5的位置置为1，如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/9dacf0001bc1cd6cb26465d1b752b95f.png\" alt=\"image\"></p>\n<p>同理，经过计算(f_1(N_2))得到的数值得为3，(f_2(N_2))得到的数值为6，则将数组下标为3和下表为6的位置置为1，如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/75b9db0a2fee851bec9d7f6ac505bc63.png\" alt=\"image\"></p>\n<p>这个时候，我们有第三个数(N_3)，我们判断(N_3)在不在集合((N_1,N_2))中，就进行(f_1(N_3)，f_2(N_3))的计算</p>\n<ol>\n<li>若值恰巧都位于上图的红色位置中，我们则认为，(N_3)在集合((N_1,N_2))中</li>\n<li>若值有一个不位于上图的红色位置中，我们则认为，(N_3)不在集合((N_1,N_2))中</li>\n</ol>\n<p>以上就是布隆过滤器的计算原理，下面我们进行性能测试，</p>\n<h4 id=\"性能测试\">2、性能测试</h4>\n<p>代码如下:</p>\n<h5 id=\"新建一个maven工程引入guava包\">(1)新建一个maven工程，引入guava包</h5>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39cd018247676\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;dependencies&gt;  \r\n        &lt;dependency&gt;  \r\n            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;  \r\n            &lt;artifactId&gt;guava&lt;/artifactId&gt;  \r\n            &lt;version&gt;22.0&lt;/version&gt;  \r\n        &lt;/dependency&gt;  \r\n    &lt;/dependencies&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39cd018247676-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39cd018247676-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39cd018247676-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39cd018247676-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39cd018247676-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39cd018247676-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39cd018247676-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39cd018247676-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39cd018247676-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39cd018247676-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">guava</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39cd018247676-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">guava</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39cd018247676-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">22.0</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39cd018247676-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39cd018247676-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h5 id=\"测试一个元素是否属于一个百万元素集合所需耗时\">(2)测试一个元素是否属于一个百万元素集合所需耗时</h5>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39d1478788085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage bloomfilter;\r\n\r\nimport com.google.common.hash.BloomFilter;\r\nimport com.google.common.hash.Funnels;\r\nimport java.nio.charset.Charset;\r\n\r\npublic class Test {\r\n    private static int size = 1000000;\r\n\r\n    private static BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), size);\r\n\r\n    public static void main(String[] args) {\r\n        for (int i = 0; i &lt; size; i++) {\r\n            bloomFilter.put(i);\r\n        }\r\n        long startTime = System.nanoTime(); // 获取开始时间\r\n        \r\n        //判断这一百万个数中是否包含29999这个数\r\n        if (bloomFilter.mightContain(29999)) {\r\n            System.out.println(\"命中了\");\r\n        }\r\n        long endTime = System.nanoTime();   // 获取结束时间\r\n\r\n        System.out.println(\"程序运行时间： \" + (endTime - startTime) + \"纳秒\");\r\n\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d1478788085-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d1478788085-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">charset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Charset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-7\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integerFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">startTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nanoTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 获取开始时间</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-17\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//判断这一百万个数中是否包含29999这个数</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">29999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"命中了\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nanoTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 获取结束时间</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"程序运行时间： \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">endTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">startTime</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"纳秒\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d1478788085-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d1478788085-27\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p>输出如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39d4797654562\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n命中了\r\n程序运行时间： 219386纳秒</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d4797654562-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d4797654562-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d4797654562-1\">命中了</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d4797654562-2\">程序运行时间：<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">219386</span>纳秒</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>也就是说，判断一个数是否属于一个百万级别的集合，只要0.219ms就可以完成，性能极佳。</p>\n<h5 id=\"误判率的一些概念\">(3)误判率的一些概念</h5>\n<p>首先，我们先不对误判率做显示的设置，进行一个测试，代码如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39d8390592986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage bloomfilter;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport com.google.common.hash.BloomFilter;\r\nimport com.google.common.hash.Funnels;\r\n\r\npublic class Test {\r\n    private static int size = 1000000;\r\n\r\n    private static BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), size);\r\n\r\n    public static void main(String[] args) {\r\n        for (int i = 0; i &lt; size; i++) {\r\n            bloomFilter.put(i);\r\n        }\r\n        List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;(1000);  \r\n        \r\n        //故意取10000个不在过滤器里的值，看看有多少个会被认为在过滤器里\r\n        for (int i = size + 10000; i &lt; size + 20000; i++) {  \r\n            if (bloomFilter.mightContain(i)) {  \r\n                list.add(i);  \r\n            }  \r\n        }  \r\n        System.out.println(\"误判的数量：\" + list.size()); \r\n\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39d8390592986-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39d8390592986-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-7\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-9\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integerFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-19\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//故意取10000个不在过滤器里的值，看看有多少个会被认为在过滤器里</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"误判的数量：\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39d8390592986-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39d8390592986-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>输出结果如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39db769357281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n误判对数量：330</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39db769357281-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39db769357281-1\">误判对数量：<span class=\"crayon-cn\">330</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果上述代码所示，我们故意取10000个不在过滤器里的值，却还有330个被认为在过滤器里，这说明了误判率为0.03.即，在不做任何设置的情况下，默认的误判率为0.03。<br>\n下面上源码来证明：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/7e2c12c502f40a42548913672b197171.png\" alt=\"image\"></p>\n<p>接下来我们来看一下，误判率为0.03时，底层维护的bit数组的长度如下图所示<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/b3087588fd2780c158760d1e703c351c.png\" alt=\"image\"></p>\n<p>将bloomfilter的构造方法改为</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39df381123726\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate static BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), size,0.01);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39df381123726-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39df381123726-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integerFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.01</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>即，此时误判率为0.01。在这种情况下，底层维护的bit数组的长度如下图所示<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/d55492c1278a634aeea2d32c2440e379.png\" alt=\"image\"><br>\n由此可见，误判率越低，则底层维护的数组越长，占用空间越大。因此，误判率实际取值，根据服务器所能够承受的负载来决定，不是拍脑袋瞎想的。</p>\n<h4 id=\"实际使用\">3、实际使用</h4>\n<p>redis伪代码如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e39e2969331669\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nString get(String key) {  \r\n   String value = redis.get(key);  \r\n   if (value  == null) {  \r\n        if(!bloomfilter.mightContain(key)){\r\n            return null;\r\n        }else{\r\n           value = db.get(key);  \r\n           redis.set(key, value);  \r\n        }\r\n    } \r\n    return value；\r\n} </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39e2969331669-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39e2969331669-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39e2969331669-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39e2969331669-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39e2969331669-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39e2969331669-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39e2969331669-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39e2969331669-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39e2969331669-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39e2969331669-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e39e2969331669-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e39e2969331669-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39e2969331669-1\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39e2969331669-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39e2969331669-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39e2969331669-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39e2969331669-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39e2969331669-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39e2969331669-7\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39e2969331669-8\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39e2969331669-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39e2969331669-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e39e2969331669-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">value</span>；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e39e2969331669-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p><strong>优点:</strong></p>\n<ol>\n<li>思路简单</li>\n<li>保证一致性</li>\n<li>性能强</li>\n</ol>\n<p><strong>缺点</strong></p>\n<ol>\n<li>代码复杂度增大</li>\n<li>需要另外维护一个集合来存放缓存的Key</li>\n<li>布隆过滤器不支持删值操作</li>\n</ol>\n<h2 id=\"总结\">总结</h2>\n<p>在总结部分，来个漫画把。希望对大家找工作有帮助<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/ef43eacdd2710eff0fbe24e391486c82.png\" alt=\"image\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114012\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114012votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114012\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 1, "tags": "IT技术,分布式,数据库", "url_object_id": "06b67f2d6e9b1c6772e9dc3273786a32", "title": "分布式之缓存击穿", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "comment_nums": 1, "url": "http://blog.jobbole.com/114012/"},{"praise_nums": "1", "create_date": "2018-05-14", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx1615593136\">搬砖大师傅</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dzone.com/articles/10-essential-testing-tools-for-java-developers\">Javin Paul  </a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<blockquote><p>想要提高你的自动化测试技术？以下是 10 个优秀的测试框架和库，以及它们常见用法的概述。</p></blockquote>\n<p>最近我写了一些文章，关于 Java 程序员今年应该学习什么，例如编程语言，库和框架等，如果只能学习或提高其中一项，那必然是自动化测试技能。</p>\n<p>测试是专业程序员区别于业余程序员的一项指标，作为专业程序员，并非必须采用 TDD，BDD 或其它测试方法论，但最低标准是通过编写代码的方式，来自动化测试自己的代码。</p>\n<p>许多 Java 程序员编写单元测试和集成测试，使用 Jenkins、TeamCity 等持续集成工具，在构建阶段自动运行。</p>\n<p>如果还有人对程序员是否应该关注自动化测试存有疑问，那么让我来回答，随着 DevOps 理念的增强和角色的涌现，自动化测试的重要性正在呈指数型增长。</p>\n<p>企业通常青睐那种擅长编写单元测试的程序员，这些程序员对各种单元测试框架、库和工具有着丰富的知识，比如 JUnit，Selenium，REST-Assured，Spock 框架等。</p>\n<p>作为 Java 程序员，我们在截然不同的领域工作，从编写 Java 核心代码到 JSP 页面，REST API，甚至有时为了构建自动化而去编写 Groovy 脚本，这就要求我们必需了解不同的自动化测试工具。</p>\n<p>举一个例子，很长一段时间内，我只了解 JUnit，但当不得不测试 JSP 页面时，我却束手无策，直到我找到了 Selenium。REST Assured 是另一个类似的例子，我通常使用 curl 命令测试 REST API，但 REST Assured 将 REST API 的单元测试水平提升到了另一个层次。</p>\n<h2>Java 程序员需要用到十大单元测试和自动化集成测试工具</h2>\n<p>我认为一个优秀的程序员，必然能够很好地利用手头上的工具，因此我总在业余时间学习和探索新的工具和库，以下列表是我部分研究成果。</p>\n<p>在这篇文章中，我将分享 10 个最为优秀且必不可少的工具，框架和库，这些可以帮助 java 程序员在各类 java 项目中编写单元测试和集成测试。</p>\n<h3>JUnit</h3>\n<p>JUnit 无须赘述，即便是初级Java程序员，可能也已经听说过它，你可以使用它编写 Java 代码的单元测试。</p>\n<p>几乎所有主流 IDE，例如 Eclipse，NetBeans 和 IntelliJ，都集成了 JUnit，可以直接在这些IDE中编写和运行单元测试。</p>\n<p>大多数人仍在使用 JUnit 4，即使 JUnit 5 已经发布，它很可能是今年下一个热点。通过 JUnit 5，可以将 JUnit 同时应用于单元测试和集成测试，并且它还支持 Java 8 的特性。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/8e5c05d6729665c7b55a0be0128a4e3b.png\"><img class=\"aligncenter wp-image-67496 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/8e5c05d6729665c7b55a0be0128a4e3b.png\" alt=\"junit5 architecture testing\" width=\"320\" height=\"255\"></a></p>\n<h3>REST Assured</h3>\n<p>用 Java 语言测试和验证 REST 服务，要难于 Groovy 这类动态语言。</p>\n<p>REST Assured 将这类语言的易用性带入了 Java 领域，是一个优秀的 REST API 的集成测试工具。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/83fb827ae23afa4c0fcae32470debac2.jpg\" rel=\"https://www.udemy.com/api-testing-rest-api-automation-testing-from-scratch/?siteID=JVFxdTr9V80-BmKRpLLolCUb.AGrEBG9sg&amp;LSNPUBID=JVFxdTr9V80\"><img class=\"aligncenter wp-image-67500 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/83fb827ae23afa4c0fcae32470debac2.jpg\" alt=\"REST assured testing Restful web application\" width=\"400\" height=\"226\"></a></p>\n<h3>Selenium</h3>\n<p>Selenium 很可能是最流行的 Java UI 测试工具了，它可以让你在不必启动浏览器的情况下测试 JSP 页面。</p>\n<p>你可以使用 JUnit 和 Selenium 来测试 Web 程序的界面，它甚至允许你编写 Web 应用程序的验收测试。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/01641d464ff195a39f2e613020446df9.jpg\"><img class=\"aligncenter wp-image-67487 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/01641d464ff195a39f2e613020446df9.jpg\" alt=\"selenium-webdriver-with-java-basics-advance-archit\" width=\"1280\" height=\"720\"></a></p>\n<h3>TestNG</h3>\n<p>TestNG 是一个测试框架，其灵感来自 JUnit 和 NUnit，但同时引入了一些新的功能，使其功能更强大，使用更方便。例如可以使用注解，在任意大的线程池中，配置各种可用策略进行测试（例如所有方法都在自己的线程中，每一个测试类使用一个线程等）。</p>\n<p>因为 TestNG 使用 JUnit 4 的注解，同时又集成了 HAMCSTREST 匹配器，它与 JUnit 的差异已经减小了，但两者如何选择，这取决于你。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/58bb4c4068e8326c80735dfd0d1f430a.png\"><img class=\"alignnone size-full wp-image-67501 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/58bb4c4068e8326c80735dfd0d1f430a.png\" alt=\"TestNG framework\" width=\"400\" height=\"270\"></a></p>\n<h3>Mockito</h3>\n<p>Java 类有许多 Mock 框架，例如 PowerMock 和 JMock，但我个人偏向于 <a href=\"http://site.mockito.org/\">Mockito</a>，因为它有简单的 API，优秀的文档以及大量的示例。</p>\n<p>Mocking 是现代单元测试的一项关键技术，因为它允许你在没有任何依赖的情况下独立测试代码，这就是为什么我鼓励每个 Java 程序员在学习 JUnit 的同时，一起学习 Mocking 框架的原因。</p>\n<p>我最喜欢的 mocking 框架是 Mockito，但如果你愿意，也可以研究下 PowerMock 或 JMock。</p>\n<h3>Spock框架</h3>\n<p>Spock 是另一个测试和规范框架，用于 Java 和 Groovy 应用程序。由于使用 Groovy 编写，Spock 成为一种兼具丰富表现力且简明扼要的规范语言。</p>\n<p>当你使用 Spock 时，你的测试将变得更容易阅读和维护，这得益于它采用的 JUnit 运行器，Spock 兼容大部分 IDE，构建工具和持续集成服务器。</p>\n<p>可惜我没有找到有助于学习 Spock 框架的课程，但阅读《<a href=\"https://www.amazon.com/Java-Testing-Spock-Konstantinos-Kapelonis/dp/1617292532\">Java Testing with Spock</a>》这本书是很好的开始。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/7d9d4a5f78beba6c942d1ee0a60065ec.jpg\"><img class=\"aligncenter size-full wp-image-67499\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/7d9d4a5f78beba6c942d1ee0a60065ec.jpg\" alt=\"Java Testing with Spock\" width=\"254\" height=\"320\"></a></p>\n<h3>Cucumber</h3>\n<p>Cucumber 是另一个重要的自动化集成测试工具，但与其它同类别的工具不同的是它能够针对规格文档进行自动化测试。</p>\n<p>Cucumber 将规格文档和测试文档合成整个动态文档，同时 Cucumber 自动测试这个文档，使测试规范始终保持在最新版本。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/2253469cb78a9de143e0ff56c5bee12f.png\"><img class=\"aligncenter size-full wp-image-67498\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/2253469cb78a9de143e0ff56c5bee12f.png\" alt=\"Cucumber testing framework 2\" width=\"400\" height=\"195\"></a></p>\n<h3>Spring Test</h3>\n<p>Spring MVC 自带一个很有用的测试框架，它可以在不引入 Web 容器的情况下进行深入测试。</p>\n<p>Spring Test 是为 Spring 程序编写自动化测试的最有用的库之一。为了给 Spring 驱动的应用程序（包括 MVC 控制器在内），编写单元测试和集成测试，Spring Test 提供了一流的支持。</p>\n<p>另外，Spring Test DbUnit 集成了 Spring Test 框架与 DbUnit；Spring Test MVC HtmlUnit 集成了Spring Test MVC 框架和 HtmlUnit。</p>\n<p>通过使用这些工具，你可以轻松地自动测试 Spring MVC 应用程序。</p>\n<h3>DBUnit</h3>\n<p>数据库是许多 Java 应用程序，包括核心 Java 和 Web 应用程序中不可或缺的部分，也有可能是单元测试的最大障碍。</p>\n<p>在进行集成测试时，连接开发环境或用户验收测试的数据库并不可靠，因为任何人都可以更改数据模式和数据本身，例如表和存储过程等，这会导致自动化集成测试失败。</p>\n<p>DbUnit 是一个 JUnit 扩展，每次集成测试前，将数据库初始化成已知状态，确保数据库存储正确的数据。</p>\n<p>DbUnit 自身还存在着一些问题，但它是一个非常有用的工具，因为它可以帮助我们分离测试数据与测试代码。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/e86c20da61db52957e6e4f87c7a25b65.png\"><img class=\"aligncenter size-full wp-image-67502\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/e86c20da61db52957e6e4f87c7a25b65.png\" alt=\"Unit testing of database using DBUnit\" width=\"366\" height=\"400\"></a></p>\n<h3>Robot 框架</h3>\n<p>Robot 框架是一个基于 Python 的通用测试自动化框架，用于验收测试和验收测试驱动开发。</p>\n<p>它是一个由关键字驱动的，使用表格测试数据语法的测试框架，可以用来测试那些涉及多种技术和接口的分布式异构应用。</p>\n<p>如果你打算学习这个优秀的集成测试框架，那么你可以从 Udemy 上的《<a href=\"https://www.udemy.com/robot-framework-level-1/?siteID=JVFxdTr9V80-fviC4FKz0NBU7fs4fjXA6A&amp;LSNPUBID=JVFxdTr9V80\">Robot 框架测试自动化</a>》的课程开始，这是一个很好的学习资源。</p>\n<p>该课程涵盖了两部分内容，Robot 框架基础和高级特性。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/04/6b6e14053b953291f679a7bd7e456d51.png\"><img class=\"aligncenter size-full wp-image-67497\" src=\"http://jbcdn2.b0.upaiyun.com/2018/04/6b6e14053b953291f679a7bd7e456d51.png\" alt=\"accept test report using robot framework\" width=\"400\" height=\"238\"></a></p>\n<h3>结论</h3>\n<p>以上列举了Java 程序员需要用到的单元测试和集成测试工具，框架和库。</p>\n<p>还有很多库没有包括在这个列表中，例如 AssertJ 和 Hamcrest，它们可以帮助你写出漂亮且流畅的测试，但学习需要一步步来。</p>\n<p>首先，学习一个可以应用于日常工作的工具或库。 例如，如果你正在使用 Java UI，那么首先应该学习 Selenium，这样你可以有更多时间专注在这个工具上。</p>\n<p>同样的，如果你的工作内容是 REST API，请学习 REST Assured（参阅 <a href=\"http://www.baeldung.com/rest-with-spring-course?utm_source=javarevisited&amp;utm_medium=web&amp;utm_campaign=rws&amp;affcode=22136_bkwjs9xa\">REST with Spring</a>）；如果你正在做很多核心 Java 的工作，那么 JUnit 5 可能是你首先需要关注的库。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113952\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113952votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113952\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx1615593136\">搬砖大师傅</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx1615593136\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/5711ded56e938ec03969c82191310ba3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            对大数据，金融IT开发有兴趣，对量化交易有兴趣        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx1615593136\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx1615593136/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx1615593136/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 10</a> · <a title=\"QQ：248194560\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：Rocky719\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 0, "tags": "工具与资源,Groovy,java,JUnit", "url_object_id": "41201d7935af5be0d5b31cfa94a23f85", "title": "JAVA 程序员需要用到 10 个测试框架和库", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/58175e1df62779046a3a4e2483575937.jpg"], "comment_nums": 0, "url": "http://blog.jobbole.com/113952/"},{"praise_nums": "1", "create_date": "2018-05-09", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/@keavy/who-i-want-to-work-for-b04ce972c202\">Keavy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我是 Github 的一名高级工程师。我不是要找工作，只是一直在思考领导能力的问题，思考在我多年共事过的诸多领导之中，我最欣赏的特质是什么。受到 Chad Fowler 的文章《<a href=\"http://chadfowler.com/2013/04/09/who-i-want-to-hire.html\">我想雇什么样的员工</a>》的启发，我也开始留意我想为什么样的领导工作，即——理想的领导是什么样。</p>\n<p><img class=\"alignnone size-full wp-image-23922\" src=\"http://jbcdn2.b0.upaiyun.com/2012/07/20120717_161512_1.jpg\" alt=\"GitHub：代码是程序员沟通最直接的手段\"></p>\n<p>在分享我的看法之前，先让我简单介绍一下我自己的情况：</p>\n<p>我是一名经验丰富的工程师，做过很多基础架构的工作，同时在我的专业领域（API 及其生态环境）扮演着技术顾问的角色。我是个不太需要监督指导的人，我老板只要指出问题的大方向，就可以放手让我去完成了。我很乐意解决困难的工程问题，带领团队朝一个方向努力，或是帮助公司与公众就一个项目进行沟通。正如一个同事所言：我就是“擅长搞定麻烦事”。</p>\n<p><strong>以下是我认为作为一个理想的领导者应有的特质：</strong></p>\n<ul>\n<li>在工作中明显地表现出冷静和自在，了解你的态度和行为会对周围的人产生哪些影响，非常关注如何营造出一种相互支持的工作环境。</li>\n</ul>\n<ul>\n<li>工作是生活的一部分，拥有健康的工作时间，会休假。即使你自己选择在常规工作时间以外工作，也不期待别人和你一样，不干扰其他人的工作习惯。</li>\n</ul>\n<ul>\n<li>无论与谁谈话都在场。</li>\n</ul>\n<ul>\n<li>善于倾听。</li>\n</ul>\n<ul>\n<li>基于自己和团队的价值，会经过深思熟虑精心设计工作流程，因为你重视他人的参与和时间，因此不会为了走流程而增加流程。</li>\n</ul>\n<ul>\n<li>当你要提出批评性的建议的时候，会及时并且私下沟通。会提供具体的细节，并给出改进的建议和所需的支持。当你有积极的反馈意见时，也会提供具体的细节，并以别人喜欢被认可的方式分享出来。</li>\n</ul>\n<ul>\n<li>足够自信，乐于接受其他人对你工作和方法的反馈。足够谦虚，在你有不懂的时候、犯错的时候或是学到新东西的时候随时承认。享受从周围人身上学习新知识的过程。</li>\n</ul>\n<ul>\n<li>对公司的情况有深刻透彻的理解，利用已知的信息指导员工如何工作可以创造出最大的价值，为用户和公司带来最好的影响。</li>\n</ul>\n<ul>\n<li>不害怕质疑和否认自己的领导，或是挑战公司的现状。</li>\n</ul>\n<ul>\n<li>允许并支持你的员工在划定的范围内自己做决定，即使你可能不会做同样的决定。</li>\n</ul>\n<ul>\n<li>无论是大型还是小型的任务、新特性还是常规维护，重视他人的工作。经常强调这一点，让每个人都知道你重视他和他的工作成果。无论在何时何地都能培养一种信任的文化。</li>\n</ul>\n<ul>\n<li>能够意识到使没受重视的人群被边缘化的行为，即使这些行为是微不足道的，也可能是出于潜意识的。意识到这些事所造成的情感上的伤害。当这种情况出现时，能迅速采取行动解决问题。</li>\n</ul>\n<ul>\n<li>知道科技领域实际上并不是精英政治（根据个人才能和功绩分配权力），多留意在工作中谁创造了最多的价值，谁最积极主动，确保他们受到关注，拥有更多特权。同样，留意谁在工作中遇到了困难，努力纠正其中的不平等。</li>\n</ul>\n<ul>\n<li>观察大家在日常沟通和正式场合谈论事情有何不同。知道存在对女性和有色人种的系统性偏见，努力保证你的员工在相处和评估时不受到此类歧视。</li>\n</ul>\n<ul>\n<li>利用自己的特权帮助员工成长，积极赞助员工：使他们融入团队，看到他们的努力，让他们得到提拔。</li>\n</ul>\n<ul>\n<li>不只是期待员工做出最完美的工作，还要信任并赋予他们做好工作的权力。给予员工接受并完成新挑战所需的支持。</li>\n</ul>\n<ul>\n<li>不接受平庸。如果你尽了最大的努力，但是员工还是滥竽充数，那他们必须离开。</li>\n</ul>\n<ul>\n<li>尽管承担着很多责任和利益相关，仍然着眼于如何让员工更轻松地产出最佳工作成果。</li>\n</ul>\n<ul>\n<li>能注意到有人在工作中感到沮丧、无聊或是很吃力。无论他们主动告诉你的还是你感觉到的，抽出点时间关心他们，倾听其中的原因。</li>\n</ul>\n<p>从我的观点来看，以上这些都很重要。</p>\n<p>如果我描述的这些你都符合，我想你会成为一个好榜样，培养出一个互相支持，态度积极而又忠诚的团队。你能让员工的生活变得更好，理由很简单，你真正地关心着你的员工。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113956\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113956votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113956\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 37</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 2, "tags": "职场,职场", "url_object_id": "6a9a2f2ed164a2490d1813a3bb30a2b5", "title": "GitHub 工程师：我眼中的理想上司是这样子的", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/07/20120717_161512_1.jpg"], "comment_nums": 2, "url": "http://blog.jobbole.com/113956/"},{"praise_nums": "2", "create_date": "2018-05-20", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/rjzheng/p/8972725.html\">孤独烟</a>   </div><h2 id=\"引言\">引言</h2>\n<p>在开发中，往往会遇到一些关于延时任务的需求。例如</p>\n<ul>\n<li>生成订单30分钟未支付，则自动取消</li>\n<li>生成订单60秒后,给用户发短信</li>\n</ul>\n<p>对上述的任务，我们给一个专业的名字来形容，那就是<strong>延时任务</strong>。那么这里就会产生一个问题，这个<strong>延时任务</strong>和<strong>定时任务</strong>的区别究竟在哪里呢？一共有如下几点区别</p>\n<ol>\n<li>定时任务有明确的触发时间，延时任务没有</li>\n<li>定时任务有执行周期，而延时任务在某事件触发后一段时间内执行，没有执行周期</li>\n<li>定时任务一般执行的是批处理操作是多个任务，而延时任务一般是单个任务</li>\n</ol>\n<p>下面，我们以判断订单是否超时为例，进行方案分析</p>\n<h2 id=\"方案分析\">方案分析</h2>\n<h3 id=\"数据库轮询\">(1)数据库轮询</h3>\n<h4 id=\"思路\">思路</h4>\n<p>该方案通常是在小型项目中使用，即通过一个线程定时的去扫描数据库，通过订单时间来判断是否有超时的订单，然后进行update或delete等操作</p>\n<h4 id=\"实现\">实现</h4>\n<p>博主当年早期是用quartz来实现的(实习那会的事)，简单介绍一下<br>\nmaven项目引入一个依赖如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e7873ec882686660\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    &lt;dependency&gt;\r\n        &lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt;\r\n        &lt;artifactId&gt;quartz&lt;/artifactId&gt;\r\n        &lt;version&gt;2.2.2&lt;/version&gt;\r\n    &lt;/dependency&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ec882686660-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ec882686660-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ec882686660-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ec882686660-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ec882686660-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ec882686660-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ec882686660-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">scheduler</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ec882686660-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ec882686660-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2.2.2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ec882686660-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>调用Demo类MyJob如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e7873f5291358124\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay1;\r\n\r\nimport org.quartz.JobBuilder;\r\nimport org.quartz.JobDetail;\r\nimport org.quartz.Scheduler;\r\nimport org.quartz.SchedulerException;\r\nimport org.quartz.SchedulerFactory;\r\nimport org.quartz.SimpleScheduleBuilder;\r\nimport org.quartz.Trigger;\r\nimport org.quartz.TriggerBuilder;\r\nimport org.quartz.impl.StdSchedulerFactory;\r\nimport org.quartz.Job;\r\nimport org.quartz.JobExecutionContext;\r\nimport org.quartz.JobExecutionException;\r\n\r\npublic class MyJob implements Job {\r\n    public void execute(JobExecutionContext context)\r\n            throws JobExecutionException {\r\n        System.out.println(\"要去数据库扫描啦。。。\");\r\n    }\r\n\r\n    public static void main(String[] args) throws Exception {\r\n        // 创建任务\r\n        JobDetail jobDetail = JobBuilder.newJob(MyJob.class)\r\n                .withIdentity(\"job1\", \"group1\").build();\r\n        // 创建触发器 每3秒钟执行一次\r\n        Trigger trigger = TriggerBuilder\r\n                .newTrigger()\r\n                .withIdentity(\"trigger1\", \"group3\")\r\n                .withSchedule(\r\n                        SimpleScheduleBuilder.simpleSchedule()\r\n                                .withIntervalInSeconds(3).repeatForever())\r\n                .build();\r\n        Scheduler scheduler = new StdSchedulerFactory().getScheduler();\r\n        // 将任务及其触发器放入调度器\r\n        scheduler.scheduleJob(jobDetail, trigger);\r\n        // 调度器开始调度任务\r\n        scheduler.start();\r\n    }\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873f5291358124-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873f5291358124-41\">41</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JobBuilder</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JobDetail</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SchedulerException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-7\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SchedulerFactory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-8\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SimpleScheduleBuilder</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-9\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Trigger</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-10\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TriggerBuilder</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-11\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">impl</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">StdSchedulerFactory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-12\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Job</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-13\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JobExecutionContext</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-14\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">org</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">quartz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JobExecutionException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-16\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyJob</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Job</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">JobExecutionContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobExecutionException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"要去数据库扫描啦。。。\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 创建任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">JobDetail </span><span class=\"crayon-v\">jobDetail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JobBuilder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyJob</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-25\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">withIdentity</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"job1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"group1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 创建触发器 每3秒钟执行一次</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Trigger </span><span class=\"crayon-v\">trigger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">TriggerBuilder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-28\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newTrigger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">withIdentity</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"trigger1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"group3\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">withSchedule</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-31\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">SimpleScheduleBuilder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">simpleSchedule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-32\"><span class=\"crayon-h\">                                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">withIntervalInSeconds</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">repeatForever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Scheduler </span><span class=\"crayon-v\">scheduler</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StdSchedulerFactory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getScheduler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 将任务及其触发器放入调度器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">scheduler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scheduleJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jobDetail</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trigger</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 调度器开始调度任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">scheduler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873f5291358124-40\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873f5291358124-41\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0058 seconds] -->\r\n<p>运行代码，可发现每隔3秒，输出如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e7873fb936760313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n要去数据库扫描啦。。。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873fb936760313-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e7873fb936760313-1\">要去数据库扫描啦。。。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h4 id=\"优缺点\">优缺点</h4>\n<p>优点:简单易行，支持集群操作<br>\n缺点:(1)对服务器内存消耗大<br>\n(2)存在延迟，比如你每隔3分钟扫描一次，那最坏的延迟时间就是3分钟<br>\n(3)假设你的订单有几千万条，每隔几分钟这样扫描一次，数据库损耗极大</p>\n<h3 id=\"jdk的延迟队列\">(2)JDK的延迟队列</h3>\n<h4 id=\"思路-1\">思路</h4>\n<p>该方案是利用JDK自带的DelayQueue来实现，这是一个无界阻塞队列，该队列只有在延迟期满的时候才能从中获取元素，放入DelayQueue中的对象，是必须实现Delayed接口的。<br>\nDelayedQueue实现工作流程如下图所示</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/8fcc3d0354db5a5bba681a57795249a1.png\" alt=\"image\"></div>\n<p>其中Poll():获取并移除队列的超时元素，没有则返回空<br>\ntake():获取并移除队列的超时元素，如果没有则wait当前线程，直到有元素满足超时条件，返回结果。</p>\n<h4 id=\"实现-1\">实现</h4>\n<p>定义一个类OrderDelay实现Delayed，代码如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e7873ff017466938\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay2;\r\n\r\nimport java.util.concurrent.Delayed;\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class OrderDelay implements Delayed {\r\n    \r\n    private String orderId;\r\n    private long timeout;\r\n\r\n    OrderDelay(String orderId, long timeout) {\r\n        this.orderId = orderId;\r\n        this.timeout = timeout + System.nanoTime();\r\n    }\r\n\r\n    public int compareTo(Delayed other) {\r\n        if (other == this)\r\n            return 0;\r\n        OrderDelay t = (OrderDelay) other;\r\n        long d = (getDelay(TimeUnit.NANOSECONDS) - t\r\n                .getDelay(TimeUnit.NANOSECONDS));\r\n        return (d == 0) ? 0 : ((d &lt; 0) ? -1 : 1);\r\n    }\r\n\r\n    // 返回距离你自定义的超时时间还有多少\r\n    public long getDelay(TimeUnit unit) {\r\n        return unit.convert(timeout - System.nanoTime(), TimeUnit.NANOSECONDS);\r\n    }\r\n\r\n    void print() {\r\n        System.out.println(orderId+\"编号的订单要删除啦。。。。\");\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e7873ff017466938-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e7873ff017466938-33\">33</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Delayed</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-6\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OrderDelay</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Delayed</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-7\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">OrderDelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nanoTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compareTo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Delayed </span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">other</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">OrderDelay</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">OrderDelay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getDelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NANOSECONDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-21\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getDelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NANOSECONDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-24\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 返回距离你自定义的超时时间还有多少</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getDelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">TimeUnit </span><span class=\"crayon-v\">unit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nanoTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NANOSECONDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"编号的订单要删除啦。。。。\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e7873ff017466938-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e7873ff017466938-33\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>运行的测试Demo为，我们设定延迟时间为3秒</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787403200568515\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay2;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.concurrent.DelayQueue;\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class DelayQueueDemo {\r\n     public static void main(String[] args) {  \r\n            // TODO Auto-generated method stub  \r\n            List&lt;String&gt; list = new ArrayList&lt;String&gt;();  \r\n            list.add(\"00000001\");  \r\n            list.add(\"00000002\");  \r\n            list.add(\"00000003\");  \r\n            list.add(\"00000004\");  \r\n            list.add(\"00000005\");  \r\n            DelayQueue&lt;OrderDelay&gt; queue = new DelayQueue&lt;OrderDelay&gt;();  \r\n            long start = System.currentTimeMillis();  \r\n            for(int i = 0;i&lt;5;i++){  \r\n                //延迟三秒取出\r\n                queue.put(new OrderDelay(list.get(i),  \r\n                        TimeUnit.NANOSECONDS.convert(3, TimeUnit.SECONDS)));  \r\n                    try {  \r\n                         queue.take().print();  \r\n                         System.out.println(\"After \" +   \r\n                                 (System.currentTimeMillis()-start) + \" MilliSeconds\");  \r\n                } catch (InterruptedException e) {  \r\n                    // TODO Auto-generated catch block  \r\n                    e.printStackTrace();  \r\n                }  \r\n            }  \r\n        }  \r\n    \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787403200568515-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787403200568515-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DelayQueue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-8\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DelayQueueDemo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-9\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// TODO Auto-generated method stub  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"00000001\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"00000002\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"00000003\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"00000004\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"00000005\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">DelayQueue</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">OrderDelay</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">queue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DelayQueue</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">OrderDelay</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-20\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">//延迟三秒取出</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-21\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OrderDelay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-22\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">NANOSECONDS</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SECONDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-24\"><span class=\"crayon-h\">                         </span><span class=\"crayon-v\">queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">take</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-25\"><span class=\"crayon-h\">                         </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"After \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-26\"><span class=\"crayon-h\">                                 </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" MilliSeconds\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">InterruptedException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-28\"><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// TODO Auto-generated catch block  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-29\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787403200568515-33\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787403200568515-34\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p>输出如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787407939406527\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n00000001编号的订单要删除啦。。。。\r\nAfter 3003 MilliSeconds\r\n00000002编号的订单要删除啦。。。。\r\nAfter 6006 MilliSeconds\r\n00000003编号的订单要删除啦。。。。\r\nAfter 9006 MilliSeconds\r\n00000004编号的订单要删除啦。。。。\r\nAfter 12008 MilliSeconds\r\n00000005编号的订单要删除啦。。。。\r\nAfter 15009 MilliSeconds</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787407939406527-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787407939406527-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787407939406527-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787407939406527-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787407939406527-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787407939406527-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787407939406527-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787407939406527-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787407939406527-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787407939406527-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787407939406527-1\"><span class=\"crayon-cn\">00000001</span>编号的订单要删除啦。。。。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787407939406527-2\"><span class=\"crayon-i\">After</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3003</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">MilliSeconds</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787407939406527-3\"><span class=\"crayon-cn\">00000002</span>编号的订单要删除啦。。。。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787407939406527-4\"><span class=\"crayon-i\">After</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6006</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">MilliSeconds</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787407939406527-5\"><span class=\"crayon-cn\">00000003</span>编号的订单要删除啦。。。。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787407939406527-6\"><span class=\"crayon-i\">After</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9006</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">MilliSeconds</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787407939406527-7\"><span class=\"crayon-cn\">00000004</span>编号的订单要删除啦。。。。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787407939406527-8\"><span class=\"crayon-i\">After</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12008</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">MilliSeconds</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787407939406527-9\"><span class=\"crayon-cn\">00000005</span>编号的订单要删除啦。。。。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787407939406527-10\"><span class=\"crayon-i\">After</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15009</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MilliSeconds</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>可以看到都是延迟3秒，订单被删除</p>\n<h4 id=\"优缺点-1\">优缺点</h4>\n<p>优点:效率高,任务触发时间延迟低。<br>\n缺点:(1)服务器重启后，数据全部消失，怕宕机<br>\n(2)集群扩展相当麻烦<br>\n(3)因为内存条件限制的原因，比如下单未付款的订单数太多，那么很容易就出现OOM异常<br>\n(4)代码复杂度较高</p>\n<h3 id=\"时间轮算法\">(3)时间轮算法</h3>\n<h4 id=\"思路-2\">思路</h4>\n<p>先上一张时间轮的图(这图到处都是啦)</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/30e7eb6723639e8dc9f412c523c70402.png\"></div>\n<p>时间轮算法可以类比于时钟，如上图箭头（指针）按某一个方向按固定频率轮动，每一次跳动称为一个 tick。这样可以看出定时轮由个3个重要的属性参数，ticksPerWheel（一轮的tick数），tickDuration（一个tick的持续时间）以及 timeUnit（时间单位），例如当ticksPerWheel=60，tickDuration=1，timeUnit=秒，这就和现实中的始终的秒针走动完全类似了。</p>\n<p>如果当前指针指在1上面，我有一个任务需要4秒以后执行，那么这个执行的线程回调或者消息将会被放在5上。那如果需要在20秒之后执行怎么办，由于这个环形结构槽数只到8，如果要20秒，指针需要多转2圈。位置是在2圈之后的5上面（20 % 8 + 1）</p>\n<h4 id=\"实现-2\">实现</h4>\n<p>我们用Netty的HashedWheelTimer来实现<br>\n给Pom加上下面的依赖</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e78740b309042498\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        &lt;dependency&gt;\r\n            &lt;groupId&gt;io.netty&lt;/groupId&gt;\r\n            &lt;artifactId&gt;netty-all&lt;/artifactId&gt;\r\n            &lt;version&gt;4.1.24.Final&lt;/version&gt;\r\n        &lt;/dependency&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740b309042498-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740b309042498-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740b309042498-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740b309042498-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740b309042498-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e78740b309042498-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740b309042498-2\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netty</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740b309042498-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">netty</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740b309042498-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">4.1.24.Final</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740b309042498-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>测试代码HashedWheelTimerTest如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e78740e492799480\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay3;\r\n\r\nimport io.netty.util.HashedWheelTimer;\r\nimport io.netty.util.Timeout;\r\nimport io.netty.util.Timer;\r\nimport io.netty.util.TimerTask;\r\n\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class HashedWheelTimerTest {\r\n    static class MyTimerTask implements TimerTask{\r\n        boolean flag;\r\n        public MyTimerTask(boolean flag){\r\n            this.flag = flag;\r\n        }\r\n        public void run(Timeout timeout) throws Exception {\r\n            // TODO Auto-generated method stub\r\n             System.out.println(\"要去数据库删除订单了。。。。\");\r\n             this.flag =false;\r\n        }\r\n    }\r\n    public static void main(String[] argv) {\r\n        MyTimerTask timerTask = new MyTimerTask(true);\r\n        Timer timer = new HashedWheelTimer();\r\n        timer.newTimeout(timerTask, 5, TimeUnit.SECONDS);\r\n        int i = 1;\r\n        while(timerTask.flag){\r\n            try {\r\n                Thread.sleep(1000);\r\n            } catch (InterruptedException e) {\r\n                // TODO Auto-generated catch block\r\n                e.printStackTrace();\r\n            }\r\n            System.out.println(i+\"秒过去了\");\r\n            i++;\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78740e492799480-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78740e492799480-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">HashedWheelTimer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Timeout</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Timer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TimerTask</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-8\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-10\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HashedWheelTimerTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyTimerTask</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TimerTask</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyTimerTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Timeout </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// TODO Auto-generated method stub</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-18\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"要去数据库删除订单了。。。。\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-19\"><span class=\"crayon-h\">             </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">MyTimerTask </span><span class=\"crayon-v\">timerTask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyTimerTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Timer </span><span class=\"crayon-v\">timer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HashedWheelTimer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">timer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timerTask</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TimeUnit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SECONDS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timerTask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">InterruptedException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// TODO Auto-generated catch block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"秒过去了\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78740e492799480-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78740e492799480-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p>输出如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787412126320891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1秒过去了\r\n2秒过去了\r\n3秒过去了\r\n4秒过去了\r\n5秒过去了\r\n要去数据库删除订单了。。。。\r\n6秒过去了</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787412126320891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787412126320891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787412126320891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787412126320891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787412126320891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787412126320891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787412126320891-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787412126320891-1\"><span class=\"crayon-cn\">1</span>秒过去了</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787412126320891-2\"><span class=\"crayon-cn\">2</span>秒过去了</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787412126320891-3\"><span class=\"crayon-cn\">3</span>秒过去了</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787412126320891-4\"><span class=\"crayon-cn\">4</span>秒过去了</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787412126320891-5\"><span class=\"crayon-cn\">5</span>秒过去了</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787412126320891-6\">要去数据库删除订单了。。。。</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787412126320891-7\"><span class=\"crayon-cn\">6</span>秒过去了</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h4 id=\"优缺点-2\">优缺点</h4>\n<p>优点:效率高,任务触发时间延迟时间比delayQueue低，代码复杂度比delayQueue低。<br>\n缺点:(1)服务器重启后，数据全部消失，怕宕机<br>\n(2)集群扩展相当麻烦<br>\n(3)因为内存条件限制的原因，比如下单未付款的订单数太多，那么很容易就出现OOM异常</p>\n<h3 id=\"redis缓存\">(4)redis缓存</h3>\n<h4 id=\"思路一\">思路一</h4>\n<p>利用redis的zset,zset是一个有序集合，每一个元素(member)都关联了一个score,通过score排序来取集合中的值<br>\n<a href=\"http://redisdoc.com/sorted_set/\">zset常用命令</a><br>\n添加元素:<strong>ZADD key score member [[score member] [score member] …]</strong><br>\n按顺序查询元素:<strong>ZRANGE key start stop [WITHSCORES]</strong><br>\n查询元素score:<strong>ZSCORE key member</strong><br>\n移除元素:<strong>ZREM key member [member …]</strong><br>\n测试如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787416259132896\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 添加单个元素\r\n\r\nredis&gt; ZADD page_rank 10 google.com\r\n(integer) 1\r\n\r\n\r\n# 添加多个元素\r\n\r\nredis&gt; ZADD page_rank 9 baidu.com 8 bing.com\r\n(integer) 2\r\n\r\nredis&gt; ZRANGE page_rank 0 -1 WITHSCORES\r\n1) \"bing.com\"\r\n2) \"8\"\r\n3) \"baidu.com\"\r\n4) \"9\"\r\n5) \"google.com\"\r\n6) \"10\"\r\n\r\n# 查询元素的score值\r\nredis&gt; ZSCORE page_rank bing.com\r\n\"8\"\r\n\r\n# 移除单个元素\r\n\r\nredis&gt; ZREM page_rank google.com\r\n(integer) 1\r\n\r\nredis&gt; ZRANGE page_rank 0 -1 WITHSCORES\r\n1) \"bing.com\"\r\n2) \"8\"\r\n3) \"baidu.com\"\r\n4) \"9\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787416259132896-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787416259132896-33\">33</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-1\"><span class=\"crayon-p\"># 添加单个元素</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-3\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZADD </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">_</span>rank<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-7\"><span class=\"crayon-p\"># 添加多个元素</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-9\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZADD </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">_</span>rank<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-12\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZRANGE </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">_</span>rank<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WITHSCORES</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-13\"><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bing.com\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-14\"><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"8\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-15\"><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"baidu.com\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-16\"><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"9\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-17\"><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"google.com\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-18\"><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"10\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-20\"><span class=\"crayon-p\"># 查询元素的score值</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-21\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZSCORE </span><span class=\"crayon-e\">page_rank </span><span class=\"crayon-v\">bing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-22\"><span class=\"crayon-s\">\"8\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-24\"><span class=\"crayon-p\"># 移除单个元素</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-26\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZREM </span><span class=\"crayon-e\">page_rank </span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-27\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-28\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-29\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZRANGE </span><span class=\"crayon-v\">page</span><span class=\"crayon-sy\">_</span>rank<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WITHSCORES</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-30\"><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bing.com\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-31\"><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"8\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787416259132896-32\"><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"baidu.com\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787416259132896-33\"><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"9\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>那么如何实现呢？我们将订单超时时间戳与订单号分别设置为score和member,系统扫描第一个元素判断是否超时，具体如下图所示</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/f6e849e2a5f5f6a2346d8b3b10dfaccf.png\" alt=\"image\"></div>\n<h4 id=\"实现一\">实现一</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e78741a139832718\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay4;\r\n\r\nimport java.util.Calendar;\r\nimport java.util.Set;\r\n\r\nimport redis.clients.jedis.Jedis;\r\nimport redis.clients.jedis.JedisPool;\r\nimport redis.clients.jedis.Tuple;\r\n\r\npublic class AppTest {\r\n    private static final String ADDR = \"127.0.0.1\";\r\n    private static final int PORT = 6379;\r\n    private static JedisPool jedisPool = new JedisPool(ADDR, PORT);\r\n    \r\n    public static Jedis getJedis() {\r\n       return jedisPool.getResource();\r\n    }\r\n    \r\n    //生产者,生成5个订单放进去\r\n    public void productionDelayMessage(){\r\n        for(int i=0;i&lt;5;i++){\r\n            //延迟3秒\r\n            Calendar cal1 = Calendar.getInstance();\r\n            cal1.add(Calendar.SECOND, 3);\r\n            int second3later = (int) (cal1.getTimeInMillis() / 1000);\r\n            AppTest.getJedis().zadd(\"OrderId\", second3later,\"OID0000001\"+i);\r\n            System.out.println(System.currentTimeMillis()+\"ms:redis生成了一个订单任务：订单ID为\"+\"OID0000001\"+i);\r\n        }\r\n    }\r\n    \r\n    //消费者，取订单\r\n    public void consumerDelayMessage(){\r\n        Jedis jedis = AppTest.getJedis();\r\n        while(true){\r\n            Set&lt;Tuple&gt; items = jedis.zrangeWithScores(\"OrderId\", 0, 1);\r\n            if(items == null || items.isEmpty()){\r\n                System.out.println(\"当前没有等待的任务\");\r\n                try {\r\n                    Thread.sleep(500);\r\n                } catch (InterruptedException e) {\r\n                    // TODO Auto-generated catch block\r\n                    e.printStackTrace();\r\n                }\r\n                continue;\r\n            }\r\n            int  score = (int) ((Tuple)items.toArray()[0]).getScore();\r\n            Calendar cal = Calendar.getInstance();\r\n            int nowSecond = (int) (cal.getTimeInMillis() / 1000);\r\n            if(nowSecond &gt;= score){\r\n                String orderId = ((Tuple)items.toArray()[0]).getElement();\r\n                jedis.zrem(\"OrderId\", orderId);\r\n                System.out.println(System.currentTimeMillis() +\"ms:redis消费了一个任务：消费的订单OrderId为\"+orderId);\r\n            }\r\n        }\r\n    }\r\n    \r\n    public static void main(String[] args) {\r\n        AppTest appTest =new AppTest();\r\n        appTest.productionDelayMessage();\r\n        appTest.consumerDelayMessage();\r\n    }\r\n    \r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741a139832718-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741a139832718-63\">63</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Calendar</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Set</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Jedis</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-7\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-8\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Tuple</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-10\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AppTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ADDR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"127.0.0.1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ADDR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-14\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-e\">getJedis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-16\"><span class=\"crayon-h\">       </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-18\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//生产者,生成5个订单放进去</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">productionDelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//延迟3秒</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Calendar </span><span class=\"crayon-v\">cal1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Calendar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cal1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Calendar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SECOND</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">second3later</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cal1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTimeInMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">AppTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getJedis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OrderId\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">second3later</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"OID0000001\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"ms:redis生成了一个订单任务：订单ID为\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"OID0000001\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-30\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//消费者，取订单</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">consumerDelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AppTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getJedis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">Tuple</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrangeWithScores</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OrderId\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isEmpty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"当前没有等待的任务\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-39\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">InterruptedException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-41\"><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// TODO Auto-generated catch block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-42\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-43\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Tuple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getScore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Calendar </span><span class=\"crayon-v\">cal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Calendar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowSecond</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cal</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTimeInMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowSecond</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-50\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Tuple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-51\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OrderId\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"ms:redis消费了一个任务：消费的订单OrderId为\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-56\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">AppTest </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AppTest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">productionDelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">consumerDelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741a139832718-62\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741a139832718-63\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0111 seconds] -->\r\n<p>此时对应输出如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e78741f810152586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1525086085261ms:redis生成了一个订单任务：订单ID为OID00000010\r\n1525086085263ms:redis生成了一个订单任务：订单ID为OID00000011\r\n1525086085266ms:redis生成了一个订单任务：订单ID为OID00000012\r\n1525086085268ms:redis生成了一个订单任务：订单ID为OID00000013\r\n1525086085270ms:redis生成了一个订单任务：订单ID为OID00000014\r\n1525086088000ms:redis消费了一个任务：消费的订单OrderId为OID00000010\r\n1525086088001ms:redis消费了一个任务：消费的订单OrderId为OID00000011\r\n1525086088002ms:redis消费了一个任务：消费的订单OrderId为OID00000012\r\n1525086088003ms:redis消费了一个任务：消费的订单OrderId为OID00000013\r\n1525086088004ms:redis消费了一个任务：消费的订单OrderId为OID00000014\r\n当前没有等待的任务\r\n当前没有等待的任务\r\n当前没有等待的任务</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741f810152586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741f810152586-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741f810152586-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741f810152586-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741f810152586-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78741f810152586-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78741f810152586-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-1\"><span class=\"crayon-cn\">1525086085261ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000010</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741f810152586-2\"><span class=\"crayon-cn\">1525086085263ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000011</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-3\"><span class=\"crayon-cn\">1525086085266ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000012</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741f810152586-4\"><span class=\"crayon-cn\">1525086085268ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000013</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-5\"><span class=\"crayon-cn\">1525086085270ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000014</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741f810152586-6\"><span class=\"crayon-cn\">1525086088000ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000010</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-7\"><span class=\"crayon-cn\">1525086088001ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000011</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741f810152586-8\"><span class=\"crayon-cn\">1525086088002ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000012</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-9\"><span class=\"crayon-cn\">1525086088003ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000013</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741f810152586-10\"><span class=\"crayon-cn\">1525086088004ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000014</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-11\">当前没有等待的任务</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78741f810152586-12\">当前没有等待的任务</div><div class=\"crayon-line\" id=\"crayon-5b03c8e78741f810152586-13\">当前没有等待的任务</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>可以看到，几乎都是3秒之后，消费订单。</p>\n<p>然而，这一版存在一个致命的硬伤，在高并发条件下，多消费者会取到同一个订单号，我们上测试代码ThreadTest</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787423985065507\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay4;\r\n\r\nimport java.util.concurrent.CountDownLatch;\r\n\r\npublic class ThreadTest {\r\n    private static final int threadNum = 10;\r\n    private static CountDownLatch cdl = new CountDownLatch(threadNum);\r\n    static class DelayMessage implements Runnable{\r\n        public void run() {\r\n            try {\r\n                cdl.await();\r\n            } catch (InterruptedException e) {\r\n                // TODO Auto-generated catch block\r\n                e.printStackTrace();\r\n            }\r\n            AppTest appTest =new AppTest();\r\n            appTest.consumerDelayMessage();\r\n        }\r\n    }\r\n    public static void main(String[] args) {\r\n        AppTest appTest =new AppTest();\r\n        appTest.productionDelayMessage();\r\n        for(int i=0;i&lt;threadNum;i++){\r\n            new Thread(new DelayMessage()).start();\r\n            cdl.countDown();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787423985065507-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787423985065507-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">concurrent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CountDownLatch</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-5\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ThreadTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threadNum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CountDownLatch </span><span class=\"crayon-v\">cdl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CountDownLatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">threadNum</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DelayMessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Runnable</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">cdl</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">await</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">InterruptedException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// TODO Auto-generated catch block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">AppTest </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AppTest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">consumerDelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">AppTest </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AppTest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">appTest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">productionDelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">threadNum</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DelayMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cdl</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">countDown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787423985065507-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787423985065507-28\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>输出如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787426044848953\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1525087157727ms:redis生成了一个订单任务：订单ID为OID00000010\r\n1525087157734ms:redis生成了一个订单任务：订单ID为OID00000011\r\n1525087157738ms:redis生成了一个订单任务：订单ID为OID00000012\r\n1525087157747ms:redis生成了一个订单任务：订单ID为OID00000013\r\n1525087157753ms:redis生成了一个订单任务：订单ID为OID00000014\r\n1525087160009ms:redis消费了一个任务：消费的订单OrderId为OID00000010\r\n1525087160011ms:redis消费了一个任务：消费的订单OrderId为OID00000010\r\n1525087160012ms:redis消费了一个任务：消费的订单OrderId为OID00000010\r\n1525087160022ms:redis消费了一个任务：消费的订单OrderId为OID00000011\r\n1525087160023ms:redis消费了一个任务：消费的订单OrderId为OID00000011\r\n1525087160029ms:redis消费了一个任务：消费的订单OrderId为OID00000011\r\n1525087160038ms:redis消费了一个任务：消费的订单OrderId为OID00000012\r\n1525087160045ms:redis消费了一个任务：消费的订单OrderId为OID00000012\r\n1525087160048ms:redis消费了一个任务：消费的订单OrderId为OID00000012\r\n1525087160053ms:redis消费了一个任务：消费的订单OrderId为OID00000013\r\n1525087160064ms:redis消费了一个任务：消费的订单OrderId为OID00000013\r\n1525087160065ms:redis消费了一个任务：消费的订单OrderId为OID00000014\r\n1525087160069ms:redis消费了一个任务：消费的订单OrderId为OID00000014\r\n当前没有等待的任务\r\n当前没有等待的任务\r\n当前没有等待的任务\r\n当前没有等待的任务</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787426044848953-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787426044848953-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-1\"><span class=\"crayon-cn\">1525087157727ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000010</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-2\"><span class=\"crayon-cn\">1525087157734ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000011</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-3\"><span class=\"crayon-cn\">1525087157738ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000012</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-4\"><span class=\"crayon-cn\">1525087157747ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000013</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-5\"><span class=\"crayon-cn\">1525087157753ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>生成了一个订单任务：订单<span class=\"crayon-i\">ID</span>为<span class=\"crayon-i\">OID00000014</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-6\"><span class=\"crayon-cn\">1525087160009ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000010</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-7\"><span class=\"crayon-cn\">1525087160011ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000010</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-8\"><span class=\"crayon-cn\">1525087160012ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000010</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-9\"><span class=\"crayon-cn\">1525087160022ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000011</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-10\"><span class=\"crayon-cn\">1525087160023ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000011</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-11\"><span class=\"crayon-cn\">1525087160029ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000011</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-12\"><span class=\"crayon-cn\">1525087160038ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000012</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-13\"><span class=\"crayon-cn\">1525087160045ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000012</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-14\"><span class=\"crayon-cn\">1525087160048ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000012</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-15\"><span class=\"crayon-cn\">1525087160053ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000013</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-16\"><span class=\"crayon-cn\">1525087160064ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000013</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-17\"><span class=\"crayon-cn\">1525087160065ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000014</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-18\"><span class=\"crayon-cn\">1525087160069ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">redis</span>消费了一个任务：消费的订单<span class=\"crayon-i\">OrderId</span>为<span class=\"crayon-i\">OID00000014</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-19\">当前没有等待的任务</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-20\">当前没有等待的任务</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787426044848953-21\">当前没有等待的任务</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787426044848953-22\">当前没有等待的任务</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p>显然，出现了多个线程消费同一个资源的情况。</p>\n<h4 id=\"解决方案\">解决方案</h4>\n<p>(1)用分布式锁，但是用分布式锁，性能下降了，该方案不细说。<br>\n(2)对ZREM的返回值进行判断，只有大于0的时候，才消费数据，于是将consumerDelayMessage()方法里的</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e78742b187672355\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif(nowSecond &gt;= score){\r\n    String orderId = ((Tuple)items.toArray()[0]).getElement();\r\n    jedis.zrem(\"OrderId\", orderId);\r\n    System.out.println(System.currentTimeMillis()+\"ms:redis消费了一个任务：消费的订单OrderId为\"+orderId);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742b187672355-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78742b187672355-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742b187672355-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78742b187672355-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742b187672355-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e78742b187672355-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowSecond</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78742b187672355-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Tuple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78742b187672355-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OrderId\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78742b187672355-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"ms:redis消费了一个任务：消费的订单OrderId为\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78742b187672355-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>修改为</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e78742e447198804\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif(nowSecond &gt;= score){\r\n    String orderId = ((Tuple)items.toArray()[0]).getElement();\r\n    Long num = jedis.zrem(\"OrderId\", orderId);\r\n    if( num != null &amp;&amp; num&gt;0){\r\n        System.out.println(System.currentTimeMillis()+\"ms:redis消费了一个任务：消费的订单OrderId为\"+orderId);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742e447198804-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78742e447198804-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742e447198804-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78742e447198804-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742e447198804-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e78742e447198804-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e78742e447198804-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e78742e447198804-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowSecond</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78742e447198804-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Tuple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElement</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78742e447198804-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OrderId\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78742e447198804-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78742e447198804-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"ms:redis消费了一个任务：消费的订单OrderId为\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e78742e447198804-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e78742e447198804-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>在这种修改后，重新运行ThreadTest类，发现输出正常了</p>\n<h4 id=\"思路二\">思路二</h4>\n<p>该方案使用redis的Keyspace Notifications，中文翻译就是<a href=\"https://redis.io/topics/notifications\">键空间机制</a>，就是利用该机制可以在key失效之后，提供一个回调，实际上是redis会给客户端发送一个消息。是需要redis版本2.8以上。</p>\n<h4 id=\"实现二\">实现二</h4>\n<p>在redis.conf中，加入一条配置</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787432990592713\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnotify-keyspace-events Ex</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787432990592713-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787432990592713-1\"><span class=\"crayon-v\">notify</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">keyspace</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">events </span><span class=\"crayon-v\">Ex</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>运行代码如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787435824323015\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage com.rjzheng.delay5;\r\n\r\nimport redis.clients.jedis.Jedis;\r\nimport redis.clients.jedis.JedisPool;\r\nimport redis.clients.jedis.JedisPubSub;\r\n\r\npublic class RedisTest {\r\n    private static final String ADDR = \"127.0.0.1\";\r\n    private static final int PORT = 6379;\r\n    private static JedisPool jedis = new JedisPool(ADDR, PORT);\r\n    private static RedisSub sub = new RedisSub();\r\n\r\n    public static void init() {\r\n        new Thread(new Runnable() {\r\n            public void run() {\r\n                jedis.getResource().subscribe(sub, \"__keyevent@0__:expired\");\r\n            }\r\n        }).start();\r\n    }\r\n\r\n    public static void main(String[] args) throws InterruptedException {\r\n        init();\r\n        for(int i =0;i&lt;10;i++){\r\n            String orderId = \"OID000000\"+i;\r\n            jedis.getResource().setex(orderId, 3, orderId);\r\n            System.out.println(System.currentTimeMillis()+\"ms:\"+orderId+\"订单生成\");\r\n        }\r\n    }\r\n    \r\n    static class RedisSub extends JedisPubSub {\r\n        &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n        public void onMessage(String channel, String message) {\r\n            System.out.println(System.currentTimeMillis()+\"ms:\"+message+\"订单取消\");\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787435824323015-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787435824323015-36\">36</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rjzheng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">delay5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Jedis</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">JedisPubSub</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-7\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ADDR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"127.0.0.1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ADDR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisSub </span><span class=\"crayon-v\">sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisSub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-12\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Runnable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">subscribe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__keyevent@0__:expired\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-20\"> </div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InterruptedException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"OID000000\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"ms:\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"订单生成\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-29\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisSub</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPubSub</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">onMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"ms:\"</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">\"订单取消\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03c8e787435824323015-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787435824323015-36\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0069 seconds] -->\r\n<p>输出如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03c8e787439365694653\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1525096202813ms:OID0000000订单生成\r\n1525096202818ms:OID0000001订单生成\r\n1525096202824ms:OID0000002订单生成\r\n1525096202826ms:OID0000003订单生成\r\n1525096202830ms:OID0000004订单生成\r\n1525096202834ms:OID0000005订单生成\r\n1525096202839ms:OID0000006订单生成\r\n1525096205819ms:OID0000000订单取消\r\n1525096205920ms:OID0000005订单取消\r\n1525096205920ms:OID0000004订单取消\r\n1525096205920ms:OID0000001订单取消\r\n1525096205920ms:OID0000003订单取消\r\n1525096205920ms:OID0000006订单取消\r\n1525096205920ms:OID0000002订单取消</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03c8e787439365694653-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03c8e787439365694653-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-1\"><span class=\"crayon-cn\">1525096202813ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000000</span>订单生成</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-2\"><span class=\"crayon-cn\">1525096202818ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000001</span>订单生成</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-3\"><span class=\"crayon-cn\">1525096202824ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000002</span>订单生成</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-4\"><span class=\"crayon-cn\">1525096202826ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000003</span>订单生成</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-5\"><span class=\"crayon-cn\">1525096202830ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000004</span>订单生成</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-6\"><span class=\"crayon-cn\">1525096202834ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000005</span>订单生成</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-7\"><span class=\"crayon-cn\">1525096202839ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000006</span>订单生成</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-8\"><span class=\"crayon-cn\">1525096205819ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000000</span>订单取消</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-9\"><span class=\"crayon-cn\">1525096205920ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000005</span>订单取消</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-10\"><span class=\"crayon-cn\">1525096205920ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000004</span>订单取消</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-11\"><span class=\"crayon-cn\">1525096205920ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000001</span>订单取消</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-12\"><span class=\"crayon-cn\">1525096205920ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000003</span>订单取消</div><div class=\"crayon-line\" id=\"crayon-5b03c8e787439365694653-13\"><span class=\"crayon-cn\">1525096205920ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000006</span>订单取消</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03c8e787439365694653-14\"><span class=\"crayon-cn\">1525096205920ms</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">OID0000002</span>订单取消</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>可以明显看到3秒过后，订单取消了<br>\nps:redis的<strong>pub/sub</strong>机制存在一个硬伤，官网内容如下<br>\n<strong>原</strong>:Because Redis Pub/Sub is fire and forget currently there is no way to use this feature if your application demands reliable notification of events, that is, if your Pub/Sub client disconnects, and reconnects later, all the events delivered during the time the client was disconnected are lost.<br>\n<strong>翻</strong>: Redis的发布/订阅目前是即发即弃(fire and forget)模式的，因此无法实现事件的可靠通知。也就是说，如果发布/订阅的客户端断链之后又重连，则在客户端断链期间的所有事件都丢失了。<br>\n因此，方案二不是太推荐。当然，如果你对可靠性要求不高，可以使用。</p>\n<h4 id=\"优缺点-3\">优缺点</h4>\n<p>优点:(1)由于使用Redis作为消息通道，消息都存储在Redis中。如果发送程序或者任务处理程序挂了，重启之后，还有重新处理数据的可能性。<br>\n(2)做集群扩展相当方便<br>\n(3)时间准确度高<br>\n缺点:(1)需要额外进行redis维护</p>\n<h3 id=\"使用消息队列\">(5)使用消息队列</h3>\n<p>我们可以采用rabbitMQ的延时队列。RabbitMQ具有以下两个特性，可以实现延迟队列</p>\n<ul>\n<li>RabbitMQ可以针对Queue和Message设置 x-message-tt，来控制消息的生存时间，如果超时，则消息变为dead letter</li>\n<li>lRabbitMQ的Queue可以配置x-dead-letter-exchange 和x-dead-letter-routing-key（可选）两个参数，用来控制队列内出现了deadletter，则按照这两个参数重新路由。<br>\n结合以上两个特性，就可以模拟出延迟消息的功能,具体的，我改天再写一篇文章，这里再讲下去，篇幅太长。</li>\n</ul>\n<h4 id=\"优缺点-4\">优缺点</h4>\n<p>优点: 高效,可以利用rabbitmq的分布式特性轻易的进行横向扩展,消息支持持久化增加了可靠性。<br>\n缺点：本身的易用度要依赖于rabbitMq的运维.因为要引用rabbitMq,所以复杂度和成本变高</p>\n<h2 id=\"总结\">总结</h2>\n<p>本文总结了目前互联网中，绝大部分的延时任务的实现方案。希望大家在工作中能够有所收获。<br>\n其实大家在工作中，百分九十的人还是以业务逻辑为主，很少有机会能够进行方案设计。所以博主不推荐在分布式这块，花太多时间，应该看看《<a href=\"http://www.cnblogs.com/rjzheng/category/1205773.html\">手把手系列的文章</a>》。不过，鉴于现在的面试造火箭，工作拧螺丝现象太过严重，所以博主开始写《<a href=\"http://www.cnblogs.com/rjzheng/category/1204667.html\">分布式系列</a>》，最后来个小漫画娱乐一下。<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/6078d20590382b70de9c85538e7c1831.png\" alt=\"image\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114009\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114009votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114009\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 1, "tags": "IT技术,分布式,数据库", "url_object_id": "9d318dfaa9e2e87c3a9c89f18682922d", "title": "分布式之延时任务方案解析", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "comment_nums": 1, "url": "http://blog.jobbole.com/114009/"},{"praise_nums": "2", "create_date": "2018-05-11", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/eniac12/p/5329396.html#s32\">SteveWang</a>   </div><p>我们通常所说的排序算法往往指的是<strong>内部排序算法</strong>，即数据记录在内存中进行排序。</p>\n<p>排序算法大体可分为两种：</p>\n<p>一种是<strong>比较排序</strong>，时间复杂度O(nlogn) ~ O(n^2)，主要有：<strong>冒泡排序</strong>，<strong>选择排序</strong>，<strong>插入排序</strong>，<strong>归并排序</strong>，<strong>堆排序</strong>，<strong>快速排序</strong>等。</p>\n<p>另一种是<strong>非比较排序</strong>，时间复杂度可以达到O(n)，主要有：<strong>计数排序</strong>，<strong>基数排序</strong>，<strong>桶排序</strong>等。</p>\n<p>这里我们来探讨一下常用的比较排序算法，非比较排序算法将在下一篇文章中介绍。下表给出了常见比较排序算法的性能：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/a6d92f7bf8a65e8a4a48479b9599d97e.jpg\" alt=\"\"></p>\n<p>有一点我们很容易忽略的是<strong>排序算法的稳定性</strong>(腾讯校招2016笔试题曾考过)。</p>\n<p>排序算法稳定性的简单形式化定义为：<strong>如果A<sub>i</sub> = A<sub>j</sub>，排序前A<sub>i</sub>在A<sub>j</sub>之前，排序后A<sub>i</sub>还在A<sub>j</sub>之前，则称这种排序算法是稳定的。</strong>通俗地讲就是保证排序前后两个相等的数的相对顺序不变。</p>\n<p>对于不稳定的排序算法，只要举出一个实例，即可说明它的不稳定性；而对于稳定的排序算法，必须对算法进行分析从而得到稳定的特性。需要注意的是，排序算法是否为稳定的是由具体算法决定的，不稳定的算法在某种条件下可以变为稳定的算法，而稳定的算法在某种条件下也可以变为不稳定的算法。</p>\n<p>例如，对于冒泡排序，原本是稳定的排序算法，如果将记录交换的条件改成A[i] &gt;= A[i + 1]，则两个相等的记录就会交换位置，从而变成不稳定的排序算法。</p>\n<p>其次，说一下排序算法稳定性的好处。<strong>排序算法如果是稳定的，那么从一个键上排序，然后再从另一个键上排序，前一个键排序的结果可以为后一个键排序所用。</strong>基数排序就是这样，先按低位排序，逐次按高位排序，低位排序后元素的顺序在高位也相同时是不会改变的。</p>\n<h2>冒泡排序(Bubble Sort)</h2>\n<p>冒泡排序是一种极其简单的排序算法，也是我所学的第一个排序算法。它重复地走访过要排序的元素，依次比较相邻两个元素，如果他们的顺序错误就把他们调换过来，直到没有元素再需要交换，排序完成。这个算法的名字由来是因为越小(或越大)的元素会经由交换慢慢“浮”到数列的顶端。</p>\n<p>冒泡排序算法的运作如下：</p>\n<ol>\n<li>比较相邻的元素，如果前一个比后一个大，就把它们两个调换位置。</li>\n<li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。</li>\n<li>针对所有的元素重复以上的步骤，除了最后一个。</li>\n<li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li>\n</ol>\n<p>由于它的简洁，冒泡排序通常被用来对于程序设计入门的学生介绍算法的概念。冒泡排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b8252963e137925622\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- O(n^2)\r\n// 最优时间复杂度 ---- 如果能在内部循环第一次运行时,使用一个旗标来表示有无需要交换的可能,可以把最优时间复杂度降低到O(n)\r\n// 平均时间复杂度 ---- O(n^2)\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 稳定\r\n\r\nvoid Swap(int A[], int i, int j)\r\n{\r\n    int temp = A[i];\r\n    A[i] = A[j];\r\n    A[j] = temp;\r\n}\r\n\r\nvoid BubbleSort(int A[], int n)\r\n{\r\n    for (int j = 0; j &lt; n - 1; j++)         // 每次最大元素就像气泡一样\"浮\"到数组的最后\r\n    {\r\n        for (int i = 0; i &lt; n - 1 - j; i++) // 依次比较相邻的两个元素,使较大的那个向后移\r\n        {\r\n            if (A[i] &gt; A[i + 1])            // 如果条件改成A[i] &gt;= A[i + 1],则变为不稳定的排序算法\r\n            {\r\n                Swap(A, i, i + 1);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 };    // 从小到大冒泡排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    BubbleSort(A, n);\r\n    printf(\"冒泡排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252963e137925622-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252963e137925622-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-3\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- 如果能在内部循环第一次运行时,使用一个旗标来表示有无需要交换的可能,可以把最优时间复杂度降低到O(n)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-9\"><span class=\"crayon-c\">// 稳定性 ------------ 稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-18\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-19\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// 每次最大元素就像气泡一样\"浮\"到数组的最后</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 依次比较相邻的两个元素,使较大的那个向后移</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果条件改成A[i] &gt;= A[i + 1],则变为不稳定的排序算法</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-30\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-32\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-33\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 从小到大冒泡排序</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BubbleSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"冒泡排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252963e137925622-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252963e137925622-44\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0065 seconds] -->\r\n<p>上述代码对序列{ 6, 5, 3, 1, 8, 7, 2, 4 }进行冒泡排序的实现过程如下</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773jilosg208c050787.gif\" width=\"300\" height=\"180\"></p>\n<p>使用冒泡排序为一列数字进行排序的过程如右图所示：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773kcg1fg207p0751h7.gif\" width=\"277\" height=\"257\"></p>\n<p>尽管冒泡排序是最容易了解和实现的排序算法之一，但它对于少数元素之外的数列排序是很没有效率的。</p>\n<p>冒泡排序的改进：<strong>鸡尾酒排序</strong></p>\n<p>鸡尾酒排序，也叫<strong>定向冒泡排序</strong>，是冒泡排序的一种改进。此算法与冒泡排序的不同处在于<strong>从低到高然后从高到低</strong>，而冒泡排序则仅从低到高去比较序列里的每个元素。他可以得到比冒泡排序稍微好一点的效能。</p>\n<p>鸡尾酒排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b82529649713662294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- O(n^2)\r\n// 最优时间复杂度 ---- 如果序列在一开始已经大部分排序过的话,会接近O(n)\r\n// 平均时间复杂度 ---- O(n^2)\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 稳定\r\n\r\nvoid Swap(int A[], int i, int j)\r\n{\r\n    int temp = A[i];\r\n    A[i] = A[j];\r\n    A[j] = temp;\r\n}\r\n\r\nvoid CocktailSort(int A[], int n)\r\n{\r\n    int left = 0;                            // 初始化边界\r\n    int right = n - 1;\r\n    while (left &lt; right)\r\n    {\r\n        for (int i = left; i &lt; right; i++)   // 前半轮,将最大元素放到后面\r\n        {\r\n            if (A[i] &gt; A[i + 1])\r\n            {\r\n                Swap(A, i, i + 1);\r\n            }\r\n        }\r\n        right--;\r\n        for (int i = right; i &gt; left; i--)   // 后半轮,将最小元素放到前面\r\n        {\r\n            if (A[i - 1] &gt; A[i])\r\n            {\r\n                Swap(A, i - 1, i);\r\n            }\r\n        }\r\n        left++;\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 };   // 从小到大定向冒泡排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    CocktailSort(A, n);\r\n    printf(\"鸡尾酒排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529649713662294-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529649713662294-55\">55</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-3\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- 如果序列在一开始已经大部分排序过的话,会接近O(n)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-9\"><span class=\"crayon-c\">// 稳定性 ------------ 稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-18\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CocktailSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-19\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                            </span><span class=\"crayon-c\">// 初始化边界</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 前半轮,将最大元素放到后面</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-28\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">right</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 后半轮,将最小元素放到前面</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-41\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-42\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-43\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-44\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 从小到大定向冒泡排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">CocktailSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"鸡尾酒排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529649713662294-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529649713662294-55\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0077 seconds] -->\r\n<p>使用鸡尾酒排序为一列数字进行排序的过程如右图所示：</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fr773kzmggg207p075tbu.gif\" width=\"277\" height=\"257\"></p>\n<p>以序列(2,3,4,5,1)为例，鸡尾酒排序只需要访问一次序列就可以完成排序，但如果使用冒泡排序则需要四次。但是在乱数序列的状态下，鸡尾酒排序与冒泡排序的效率都很差劲。</p>\n<p><strong>　　</strong></p>\n<h2>选择排序(Selection Sort)</h2>\n<p>选择排序也是一种简单直观的排序算法。它的工作原理很容易理解：初始时在序列中找到最小（大）元素，放到序列的起始位置作为已排序序列；然后，再从剩余未排序元素中继续寻找最小（大）元素，放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p>\n<p>注意选择排序与冒泡排序的区别：冒泡排序通过依次交换相邻两个顺序不合法的元素位置，从而将当前最小（大）元素放到合适的位置；而选择排序每遍历一次都记住了当前最小（大）元素的位置，最后仅需一次交换操作即可将其放到合适的位置。</p>\n<p>选择排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b8252964f429613581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- O(n^2)\r\n// 最优时间复杂度 ---- O(n^2)\r\n// 平均时间复杂度 ---- O(n^2)\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 不稳定\r\n\r\nvoid Swap(int A[], int i, int j)\r\n{\r\n    int temp = A[i];\r\n    A[i] = A[j];\r\n    A[j] = temp;\r\n}\r\n\r\nvoid SelectionSort(int A[], int n)\r\n{\r\n    for (int i = 0; i &lt; n - 1; i++)         // i为已排序序列的末尾\r\n    {\r\n        int min = i;\r\n        for (int j = i + 1; j &lt; n; j++)     // 未排序序列\r\n        {\r\n            if (A[j] &lt; A[min])              // 找出未排序序列中的最小值\r\n            {\r\n                min = j;\r\n            }\r\n        }\r\n        if (min != i)\r\n        {\r\n            Swap(A, min, i);    // 放到已排序序列的末尾，该操作很有可能把稳定性打乱，所以选择排序是不稳定的排序算法\r\n        }\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 8, 5, 2, 6, 9, 3, 1, 4, 0, 7 }; // 从小到大选择排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    SelectionSort(A, n);\r\n    printf(\"选择排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252964f429613581-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252964f429613581-49\">49</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-3\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-9\"><span class=\"crayon-c\">// 稳定性 ------------ 不稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-18\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SelectionSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-19\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// i为已排序序列的末尾</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 未排序序列</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\">// 找出未排序序列中的最小值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">min</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">min</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 放到已排序序列的末尾，该操作很有可能把稳定性打乱，所以选择排序是不稳定的排序算法</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-35\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-36\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-37\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-38\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 从小到大选择排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">SelectionSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"选择排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252964f429613581-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252964f429613581-49\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0068 seconds] -->\r\n<p>上述代码对序列{ 8, 5, 2, 6, 9, 3, 1, 4, 0, 7 }进行选择排序的实现过程如右图：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773lxfs0g202s0ab755.gif\" width=\"100\" height=\"371\"></p>\n<p>使用选择排序为一列数字进行排序的宏观过程：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fr773pu3lpg20800800st.gif\" width=\"288\" height=\"288\"></p>\n<p><strong>选择排序是不稳定的排序算法，不稳定发生在最小元素与A[i]交换的时刻。</strong></p>\n<p>比如序列：{ 5, 8, 5, 2, 9 }，一次选择的最小元素是2，然后把2和第一个5进行交换，从而改变了两个元素5的相对次序。</p>\n<h2>插入排序(Insertion Sort)</h2>\n<p>插入排序是一种简单直观的排序算法。它的工作原理非常类似于我们抓扑克牌</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/04/1b14765ef10c4c9e36d76896bee524b9.jpg\" alt=\"\"></p>\n<p>对于未排序数据(右手抓到的牌)，在已排序序列(左手已经排好序的手牌)中从后向前扫描，找到相应位置并插入。</p>\n<p>插入排序在实现上，通常采用in-place排序（即只需用到O(1)的额外空间的排序），因而在从后向前扫描过程中，需要反复把已排序元素逐步向后挪位，为最新元素提供插入空间。</p>\n<p>具体算法描述如下：</p>\n<ol>\n<li>从第一个元素开始，该元素可以认为已经被排序</li>\n<li>取出下一个元素，在已经排序的元素序列中从后向前扫描</li>\n<li>如果该元素（已排序）大于新元素，将该元素移到下一位置</li>\n<li>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置</li>\n<li>将新元素插入到该位置后</li>\n<li>重复步骤2~5</li>\n</ol>\n<p>插入排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b82529656270676792\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 ------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- 最坏情况为输入序列是降序排列的,此时时间复杂度O(n^2)\r\n// 最优时间复杂度 ---- 最好情况为输入序列是升序排列的,此时时间复杂度O(n)\r\n// 平均时间复杂度 ---- O(n^2)\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 稳定\r\n\r\nvoid InsertionSort(int A[], int n)\r\n{\r\n    for (int i = 1; i &lt; n; i++)         // 类似抓扑克牌排序\r\n    {\r\n        int get = A[i];                 // 右手抓到一张扑克牌\r\n        int j = i - 1;                  // 拿在左手上的牌总是排序好的\r\n        while (j &gt;= 0 &amp;&amp; A[j] &gt; get)    // 将抓到的牌与手牌从右向左进行比较\r\n        {\r\n            A[j + 1] = A[j];            // 如果该手牌比抓到的牌大，就将其右移\r\n            j--;\r\n        }\r\n        A[j + 1] = get; // 直到该手牌比抓到的牌小(或二者相等)，将抓到的牌插入到该手牌右边(相等元素的相对次序未变，所以插入排序是稳定的)\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 };// 从小到大插入排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    InsertionSort(A, n);\r\n    printf(\"插入排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529656270676792-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529656270676792-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-3\"><span class=\"crayon-c\">// 分类 ------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- 最坏情况为输入序列是降序排列的,此时时间复杂度O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- 最好情况为输入序列是升序排列的,此时时间复杂度O(n)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-9\"><span class=\"crayon-c\">// 稳定性 ------------ 稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InsertionSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// 类似抓扑克牌排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                 </span><span class=\"crayon-c\">// 右手抓到一张扑克牌</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                  </span><span class=\"crayon-c\">// 拿在左手上的牌总是排序好的</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 将抓到的牌与手牌从右向左进行比较</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果该手牌比抓到的牌大，就将其右移</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 直到该手牌比抓到的牌小(或二者相等)，将抓到的牌插入到该手牌右边(相等元素的相对次序未变，所以插入排序是稳定的)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-24\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-26\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-27\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">// 从小到大插入排序</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">InsertionSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"插入排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529656270676792-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529656270676792-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p>上述代码对序列{ 6, 5, 3, 1, 8, 7, 2, 4 }进行插入排序的实现过程如下</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fr773qfw86g208c050q55.gif\" width=\"300\" height=\"180\"></p>\n<p>使用插入排序为一列数字进行排序的宏观过程：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773r2k7ig207s06lq5y.gif\" width=\"280\" height=\"237\"></p>\n<p>插入排序不适合对于数据量比较大的排序应用。但是，如果需要排序的数据量很小，比如量级小于千，那么插入排序还是一个不错的选择。 插入排序在工业级库中也有着广泛的应用，在STL的sort算法和stdlib的qsort算法中，都将插入排序作为快速排序的补充，用于少量元素的排序（通常为8个或以下）。</p>\n<h2>插入排序的改进：二分插入排序</h2>\n<p>对于插入排序，如果比较操作的代价比交换操作大的话，可以采用<strong>二分查找法</strong>来减少比较操作的次数，我们称为<strong>二分插入排序</strong>，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b8252965b544838969\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- O(n^2)\r\n// 最优时间复杂度 ---- O(nlogn)\r\n// 平均时间复杂度 ---- O(n^2)\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 稳定\r\n\r\nvoid InsertionSortDichotomy(int A[], int n)\r\n{\r\n    for (int i = 1; i &lt; n; i++)\r\n    {\r\n        int get = A[i];                    // 右手抓到一张扑克牌\r\n        int left = 0;                    // 拿在左手上的牌总是排序好的，所以可以用二分法\r\n        int right = i - 1;                // 手牌左右边界进行初始化\r\n        while (left &lt;= right)            // 采用二分法定位新牌的位置\r\n        {\r\n            int mid = (left + right) / 2;\r\n            if (A[mid] &gt; get)\r\n                right = mid - 1;\r\n            else\r\n                left = mid + 1;\r\n        }\r\n        for (int j = i - 1; j &gt;= left; j--)    // 将欲插入新牌位置右边的牌整体向右移动一个单位\r\n        {\r\n            A[j + 1] = A[j];\r\n        }\r\n        A[left] = get;                    // 将抓到的牌插入手牌\r\n    }\r\n}\r\n\r\n\r\nint main()\r\n{\r\n    int A[] = { 5, 2, 9, 4, 7, 6, 1, 3, 8 };// 从小到大二分插入排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    InsertionSortDichotomy(A, n);\r\n    printf(\"二分插入排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252965b544838969-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252965b544838969-47\">47</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-3\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-9\"><span class=\"crayon-c\">// 稳定性 ------------ 稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">InsertionSortDichotomy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// 右手抓到一张扑克牌</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// 拿在左手上的牌总是排序好的，所以可以用二分法</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 手牌左右边界进行初始化</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 采用二分法定位新牌的位置</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-22\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-24\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 将欲插入新牌位置右边的牌整体向右移动一个单位</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// 将抓到的牌插入手牌</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-34\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-35\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-36\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">// 从小到大二分插入排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">InsertionSortDichotomy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"二分插入排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252965b544838969-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252965b544838969-47\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p>当n较大时，二分插入排序的比较次数比直接插入排序的最差情况好得多，但比直接插入排序的最好情况要差，所当以元素初始序列已经接近升序时，直接插入排序比二分插入排序比较次数少。二分插入排序元素移动次数与直接插入排序相同，依赖于元素初始序列。</p>\n<h2>插入排序的更高效改进：希尔排序(Shell Sort)</h2>\n<p>希尔排序，也叫<strong>递减增量排序</strong>，是插入排序的一种更高效的改进版本。希尔排序是<strong>不稳定</strong>的排序算法。</p>\n<p>希尔排序是基于插入排序的以下两点性质而提出改进方法的：</p>\n<ul>\n<li>插入排序在对几乎已经排好序的数据操作时，效率高，即可以达到线性排序的效率</li>\n<li>但插入排序一般来说是低效的，因为插入排序每次只能将数据移动一位</li>\n</ul>\n<p>希尔排序通过将比较的全部元素分为几个区域来提升插入排序的性能。这样可以让一个元素可以一次性地朝最终位置前进一大步。然后算法再取越来越小的步长进行排序，算法的最后一步就是普通的插入排序，但是到了这步，需排序的数据几乎是已排好的了（此时插入排序较快）。<br>\n假设有一个很小的数据在一个已按升序排好序的数组的末端。如果用复杂度为O(n^2)的排序（冒泡排序或直接插入排序），可能会进行n次的比较和交换才能将该数据移至正确位置。而希尔排序会用较大的步长移动数据，所以小数据只需进行少数比较和交换即可到正确位置。</p>\n<p>希尔排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b82529661613516972\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;  \r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- 根据步长序列的不同而不同。已知最好的为O(n(logn)^2)\r\n// 最优时间复杂度 ---- O(n)\r\n// 平均时间复杂度 ---- 根据步长序列的不同而不同。\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 不稳定\r\n\r\nvoid ShellSort(int A[], int n)\r\n{\r\n    int h = 0;\r\n    while (h &lt;= n)                          // 生成初始增量\r\n    {\r\n        h = 3 * h + 1;\r\n    }\r\n    while (h &gt;= 1)\r\n    {\r\n        for (int i = h; i &lt; n; i++)\r\n        {\r\n            int j = i - h;\r\n            int get = A[i];\r\n            while (j &gt;= 0 &amp;&amp; A[j] &gt; get)\r\n            {\r\n                A[j + h] = A[j];\r\n                j = j - h;\r\n            }\r\n            A[j + h] = get;\r\n        }\r\n        h = (h - 1) / 3;                    // 递减增量\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 5, 2, 9, 4, 7, 6, 1, 3, 8 };// 从小到大希尔排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    ShellSort(A, n);\r\n    printf(\"希尔排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529661613516972-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529661613516972-47\">47</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-3\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- 根据步长序列的不同而不同。已知最好的为O(n(logn)^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- O(n)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- 根据步长序列的不同而不同。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-9\"><span class=\"crayon-c\">// 稳定性 ------------ 不稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ShellSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">                          </span><span class=\"crayon-c\">// 生成初始增量</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// 递减增量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-33\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-34\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-35\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-36\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">// 从小到大希尔排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">ShellSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"希尔排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529661613516972-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529661613516972-47\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p>以23, 10, 4, 1的步长序列进行希尔排序：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773rpleeg207p09kgsu.gif\" width=\"277\" height=\"344\"></p>\n<p><strong>希尔排序是不稳定的排序算法，</strong>虽然一次插入排序是稳定的，不会改变相同元素的相对顺序，但在不同的插入排序过程中，相同的元素可能在各自的插入排序中移动，最后其稳定性就会被打乱。</p>\n<p>比如序列：{ 3, 5, 10, 8, 7, 2, 8, 1, 20, 6 }，h=2时分成两个子序列 { 3, 10, 7, 8, 20 } 和  { 5, 8, 2, 1, 6 } ，未排序之前第二个子序列中的8在前面，现在对两个子序列进行插入排序，得到 { 3, 7, 8, 10, 20 } 和 { 1, 2, 5, 6, 8 } ，即 { 3, 1, 7, 2, 8, 5, 10, 6, 20, 8 } ，两个8的相对次序发生了改变。</p>\n<h2>归并排序(Merge Sort)</h2>\n<p>归并排序是创建在归并操作上的一种有效的排序算法，效率为O(nlogn)，1945年由冯·诺伊曼首次提出。</p>\n<p>归并排序的实现分为<strong>递归实现</strong>与<strong>非递归(迭代)实现</strong>。递归实现的归并排序是算法设计中分治策略的典型应用，我们将一个大问题分割成小问题分别解决，然后用所有小问题的答案来解决整个大问题。非递归(迭代)实现的归并排序首先进行是两两归并，然后四四归并，然后是八八归并，一直下去直到归并了整个数组。</p>\n<p>归并排序算法主要依赖归并(Merge)操作。归并操作指的是将两个已经排序的序列合并成一个序列的操作，<strong>归并操作</strong>步骤如下：</p>\n<ol>\n<li><strong>申请空间</strong>，使其大小为两个已经排序序列之和，该空间用来存放合并后的序列</li>\n<li>设定两个指针，最初位置分别为两个已经排序序列的起始位置</li>\n<li>比较两个指针所指向的元素，选择相对小的元素放入到合并空间，并移动指针到下一位置</li>\n<li>重复步骤3直到某一指针到达序列尾</li>\n<li>将另一序列剩下的所有元素直接复制到合并序列尾</li>\n</ol>\n<p>归并排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b82529667392780507\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n#include &lt;limits.h&gt;\r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- O(nlogn)\r\n// 最优时间复杂度 ---- O(nlogn)\r\n// 平均时间复杂度 ---- O(nlogn)\r\n// 所需辅助空间 ------ O(n)\r\n// 稳定性 ------------ 稳定\r\n\r\n\r\nvoid Merge(int A[], int left, int mid, int right)// 合并两个已排好序的数组A[left...mid]和A[mid+1...right]\r\n{\r\n    int len = right - left + 1;\r\n    int *temp = new int[len];       // 辅助空间O(n)\r\n    int index = 0;\r\n    int i = left;                   // 前一数组的起始元素\r\n    int j = mid + 1;                // 后一数组的起始元素\r\n    while (i &lt;= mid &amp;&amp; j &lt;= right)\r\n    {\r\n        temp[index++] = A[i] &lt;= A[j] ? A[i++] : A[j++];  // 带等号保证归并排序的稳定性\r\n    }\r\n    while (i &lt;= mid)\r\n    {\r\n        temp[index++] = A[i++];\r\n    }\r\n    while (j &lt;= right)\r\n    {\r\n        temp[index++] = A[j++];\r\n    }\r\n    for (int k = 0; k &lt; len; k++)\r\n    {\r\n        A[left++] = temp[k];\r\n    }\r\n}\r\n\r\nvoid MergeSortRecursion(int A[], int left, int right)    // 递归实现的归并排序(自顶向下)\r\n{\r\n    if (left == right)    // 当待排序的序列长度为1时，递归开始回溯，进行merge操作\r\n        return;\r\n    int mid = (left + right) / 2;\r\n    MergeSortRecursion(A, left, mid);\r\n    MergeSortRecursion(A, mid + 1, right);\r\n    Merge(A, left, mid, right);\r\n}\r\n\r\nvoid MergeSortIteration(int A[], int len)    // 非递归(迭代)实现的归并排序(自底向上)\r\n{\r\n    int left, mid, right;// 子数组索引,前一个为A[left...mid]，后一个子数组为A[mid+1...right]\r\n    for (int i = 1; i &lt; len; i *= 2)        // 子数组的大小i初始为1，每轮翻倍\r\n    {\r\n        left = 0;\r\n        while (left + i &lt; len)              // 后一个子数组存在(需要归并)\r\n        {\r\n            mid = left + i - 1;\r\n            right = mid + i &lt; len ? mid + i : len - 1;// 后一个子数组大小可能不够\r\n            Merge(A, left, mid, right);\r\n            left = right + 1;               // 前一个子数组索引向后移动\r\n        }\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A1[] = { 6, 5, 3, 1, 8, 7, 2, 4 };      // 从小到大归并排序\r\n    int A2[] = { 6, 5, 3, 1, 8, 7, 2, 4 };\r\n    int n1 = sizeof(A1) / sizeof(int);\r\n    int n2 = sizeof(A2) / sizeof(int);\r\n    MergeSortRecursion(A1, 0, n1 - 1);          // 递归实现\r\n    MergeSortIteration(A2, n2);                 // 非递归实现\r\n    printf(\"递归实现的归并排序结果：\");\r\n    for (int i = 0; i &lt; n1; i++)\r\n    {\r\n        printf(\"%d \", A1[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    printf(\"非递归实现的归并排序结果：\");\r\n    for (int i = 0; i &lt; n2; i++)\r\n    {\r\n        printf(\"%d \", A2[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529667392780507-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529667392780507-85\">85</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-2\"><span class=\"crayon-p\">#include &lt;limits.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-4\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-5\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-6\"><span class=\"crayon-c\">// 最差时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-7\"><span class=\"crayon-c\">// 最优时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-8\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-9\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(n)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-10\"><span class=\"crayon-c\">// 稳定性 ------------ 稳定</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-12\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-13\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Merge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">// 合并两个已排好序的数组A[left...mid]和A[mid+1...right]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-14\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// 辅助空间O(n)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                   </span><span class=\"crayon-c\">// 前一数组的起始元素</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 后一数组的起始元素</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 带等号保证归并排序的稳定性</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">left</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-36\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-38\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MergeSortRecursion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 递归实现的归并排序(自顶向下)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-39\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 当待排序的序列长度为1时，递归开始回溯，进行merge操作</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">MergeSortRecursion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">MergeSortRecursion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Merge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-46\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-48\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MergeSortIteration</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 非递归(迭代)实现的归并排序(自底向上)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-49\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">// 子数组索引,前一个为A[left...mid]，后一个子数组为A[mid+1...right]</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">i *</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 子数组的大小i初始为1，每轮翻倍</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\">// 后一个子数组存在(需要归并)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">// 后一个子数组大小可能不够</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Merge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">               </span><span class=\"crayon-c\">// 前一个子数组索引向后移动</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-62\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-64\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-65\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A1</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// 从小到大归并排序</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A2</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">MergeSortRecursion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">          </span><span class=\"crayon-c\">// 递归实现</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">MergeSortIteration</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                 </span><span class=\"crayon-c\">// 非递归实现</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"递归实现的归并排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A1</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"非递归实现的归并排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A2</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529667392780507-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529667392780507-85\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0148 seconds] -->\r\n<p>上述代码对序列{ 6, 5, 3, 1, 8, 7, 2, 4 }进行归并排序的实例如下</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773s9549g208c05040s.gif\" width=\"300\" height=\"180\"></p>\n<p>使用归并排序为一列数字进行排序的宏观过程：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fr773taxtag2064056wl0.gif\" width=\"220\" height=\"186\"></p>\n<p>归并排序除了可以对数组进行排序，还可以高效的求出数组小和（即单调和）以及数组中的逆序对，详见这篇<a title=\"wang7010957\" href=\"http://www.jianshu.com/p/3ab5033074f1\" target=\"_blank\">博文</a>。</p>\n<h2>堆排序(Heap Sort)</h2>\n<p>堆排序是指利用堆这种数据结构所设计的一种选择排序算法。堆是一种近似完全二叉树的结构（通常堆是通过一维数组来实现的），并满足性质：以最大堆（也叫大根堆、大顶堆）为例，其中父结点的值总是大于它的孩子节点。</p>\n<p>我们可以很容易的定义堆排序的过程：</p>\n<ol>\n<li>由输入的无序数组构造一个最大堆，作为初始的无序区</li>\n<li>把堆顶元素（最大值）和堆尾元素互换</li>\n<li>把堆（无序区）的尺寸缩小1，并调用heapify(A, 0)从新的堆顶元素开始进行堆调整</li>\n<li>重复步骤2，直到堆的尺寸为1</li>\n</ol>\n<p>堆排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b8252966e406417072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 -------------- 内部比较排序\r\n// 数据结构 ---------- 数组\r\n// 最差时间复杂度 ---- O(nlogn)\r\n// 最优时间复杂度 ---- O(nlogn)\r\n// 平均时间复杂度 ---- O(nlogn)\r\n// 所需辅助空间 ------ O(1)\r\n// 稳定性 ------------ 不稳定\r\n\r\n\r\nvoid Swap(int A[], int i, int j)\r\n{\r\n    int temp = A[i];\r\n    A[i] = A[j];\r\n    A[j] = temp;\r\n}\r\n\r\nvoid Heapify(int A[], int i, int size)  // 从A[i]向下进行堆调整\r\n{\r\n    int left_child = 2 * i + 1;         // 左孩子索引\r\n    int right_child = 2 * i + 2;        // 右孩子索引\r\n    int max = i;                        // 选出当前结点与其左右孩子三者之中的最大值\r\n    if (left_child &lt; size &amp;&amp; A[left_child] &gt; A[max])\r\n        max = left_child;\r\n    if (right_child &lt; size &amp;&amp; A[right_child] &gt; A[max])\r\n        max = right_child;\r\n    if (max != i)\r\n    {\r\n        Swap(A, i, max);                // 把当前结点和它的最大(直接)子节点进行交换\r\n        Heapify(A, max, size);          // 递归调用，继续从当前结点向下进行堆调整\r\n    }\r\n}\r\n\r\nint BuildHeap(int A[], int n)           // 建堆，时间复杂度O(n)\r\n{\r\n    int heap_size = n;\r\n    for (int i = heap_size / 2 - 1; i &gt;= 0; i--) // 从每一个非叶结点开始向下进行堆调整\r\n        Heapify(A, i, heap_size);\r\n    return heap_size;\r\n}\r\n\r\nvoid HeapSort(int A[], int n)\r\n{\r\n    int heap_size = BuildHeap(A, n);    // 建立一个最大堆\r\n    while (heap_size &gt; 1)    　　　　　　 // 堆（无序区）元素个数大于1，未完成排序\r\n    {\r\n        // 将堆顶元素与堆的最后一个元素互换，并从堆中去掉最后一个元素\r\n        // 此处交换操作很有可能把后面元素的稳定性打乱，所以堆排序是不稳定的排序算法\r\n        Swap(A, 0, --heap_size);\r\n        Heapify(A, 0, heap_size);     // 从新的堆顶元素开始向下进行堆调整，时间复杂度O(logn)\r\n    }\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 5, 2, 9, 4, 7, 6, 1, 3, 8 };// 从小到大堆排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    HeapSort(A, n);\r\n    printf(\"堆排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b8252966e406417072-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5b03b8252966e406417072-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-3\"><span class=\"crayon-c\">// 分类 -------------- 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-4\"><span class=\"crayon-c\">// 数据结构 ---------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ O(1)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-9\"><span class=\"crayon-c\">// 稳定性 ------------ 不稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-12\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-13\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-18\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-19\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 从A[i]向下进行堆调整</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-20\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left_child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// 左孩子索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right_child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 右孩子索引</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                        </span><span class=\"crayon-c\">// 选出当前结点与其左右孩子三者之中的最大值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left_child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">left_child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left_child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">right_child</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">right_child</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right_child</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 把当前结点和它的最大(直接)子节点进行交换</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">          </span><span class=\"crayon-c\">// 递归调用，继续从当前结点向下进行堆调整</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-33\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-34\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-35\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BuildHeap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 建堆，时间复杂度O(n)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-36\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 从每一个非叶结点开始向下进行堆调整</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-41\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-42\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-43\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HeapSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-44\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BuildHeap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 建立一个最大堆</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span>　　　　　　<span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 堆（无序区）元素个数大于1，未完成排序</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 将堆顶元素与堆的最后一个元素互换，并从堆中去掉最后一个元素</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 此处交换操作很有可能把后面元素的稳定性打乱，所以堆排序是不稳定的排序算法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Heapify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">heap_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 从新的堆顶元素开始向下进行堆调整，时间复杂度O(logn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-53\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-54\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-55\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-56\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">// 从小到大堆排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HeapSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"堆排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b8252966e406417072-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b8252966e406417072-67\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0103 seconds] -->\r\n<p>堆排序算法的演示：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773tznndg207s05ydn6.gif\" width=\"280\" height=\"214\"></p>\n<p>动画中在排序过程之前简单的表现了创建堆的过程以及堆的逻辑结构。</p>\n<p><strong>堆排序是不稳定的排序算法，不稳定发生在堆顶元素与A[i]交换的时刻。</strong></p>\n<p>比如序列：{ 9, 5, 7, 5 }，堆顶元素是9，堆排序下一步将9和第二个5进行交换，得到序列 { 5, 5, 7, 9 }，再进行堆调整得到{ 7, 5, 5, 9 }，重复之前的操作最后得到{ 5, 5, 7, 9 }从而改变了两个5的相对次序。</p>\n<h2>快速排序(Quick Sort)</h2>\n<p>快速排序是由东尼·霍尔所发展的一种排序算法。在平均状况下，排序n个元素要O(nlogn)次比较。在最坏状况下则需要O(n^2)次比较，但这种状况并不常见。事实上，快速排序通常明显比其他O(nlogn)算法更快，因为它的内部循环可以在大部分的架构上很有效率地被实现出来。</p>\n<p>快速排序使用分治策略(Divide and Conquer)来把一个序列分为两个子序列。步骤为：</p>\n<ol>\n<li>从序列中挑出一个元素，作为”基准”(pivot).</li>\n<li>把所有比基准值小的元素放在基准前面，所有比基准值大的元素放在基准的后面（相同的数可以到任一边），这个称为分区(partition)操作。</li>\n<li>对每个分区递归地进行步骤1~2，递归的结束条件是序列的大小是0或1，这时整体已经被排好序了。</li>\n</ol>\n<p>快速排序的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03b82529675183451471\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio.h&gt;\r\n\r\n// 分类 ------------ 内部比较排序\r\n// 数据结构 --------- 数组\r\n// 最差时间复杂度 ---- 每次选取的基准都是最大（或最小）的元素，导致每次只划分出了一个分区，需要进行n-1次划分才能结束递归，时间复杂度为O(n^2)\r\n// 最优时间复杂度 ---- 每次选取的基准都是中位数，这样每次都均匀的划分出两个分区，只需要logn次划分就能结束递归，时间复杂度为O(nlogn)\r\n// 平均时间复杂度 ---- O(nlogn)\r\n// 所需辅助空间 ------ 主要是递归造成的栈空间的使用(用来保存left和right等局部变量)，取决于递归树的深度，一般为O(logn)，最差为O(n)       \r\n// 稳定性 ---------- 不稳定\r\n\r\nvoid Swap(int A[], int i, int j)\r\n{\r\n    int temp = A[i];\r\n    A[i] = A[j];\r\n    A[j] = temp;\r\n}\r\n\r\nint Partition(int A[], int left, int right)  // 划分函数\r\n{\r\n    int pivot = A[right];               // 这里每次都选择最后一个元素作为基准\r\n    int tail = left - 1;                // tail为小于基准的子数组最后一个元素的索引\r\n    for (int i = left; i &lt; right; i++)  // 遍历基准以外的其他元素\r\n    {\r\n        if (A[i] &lt;= pivot)              // 把小于等于基准的元素放到前一个子数组末尾\r\n        {\r\n            Swap(A, ++tail, i);\r\n        }\r\n    }\r\n    Swap(A, tail + 1, right);           // 最后把基准放到前一个子数组的后边，剩下的子数组既是大于基准的子数组\r\n                                        // 该操作很有可能把后面元素的稳定性打乱，所以快速排序是不稳定的排序算法\r\n    return tail + 1;                    // 返回基准的索引\r\n}\r\n\r\nvoid QuickSort(int A[], int left, int right)\r\n{\r\n    if (left &gt;= right)\r\n        return;\r\n    int pivot_index = Partition(A, left, right); // 基准的索引\r\n    QuickSort(A, left, pivot_index - 1);\r\n    QuickSort(A, pivot_index + 1, right);\r\n}\r\n\r\nint main()\r\n{\r\n    int A[] = { 5, 2, 9, 4, 7, 6, 1, 3, 8 }; // 从小到大快速排序\r\n    int n = sizeof(A) / sizeof(int);\r\n    QuickSort(A, 0, n - 1);\r\n    printf(\"快速排序结果：\");\r\n    for (int i = 0; i &lt; n; i++)\r\n    {\r\n        printf(\"%d \", A[i]);\r\n    }\r\n    printf(\"\\n\");\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03b82529675183451471-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b03b82529675183451471-55\">55</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-1\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-3\"><span class=\"crayon-c\">// 分类 ------------ 内部比较排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-4\"><span class=\"crayon-c\">// 数据结构 --------- 数组</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-5\"><span class=\"crayon-c\">// 最差时间复杂度 ---- 每次选取的基准都是最大（或最小）的元素，导致每次只划分出了一个分区，需要进行n-1次划分才能结束递归，时间复杂度为O(n^2)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-6\"><span class=\"crayon-c\">// 最优时间复杂度 ---- 每次选取的基准都是中位数，这样每次都均匀的划分出两个分区，只需要logn次划分就能结束递归，时间复杂度为O(nlogn)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-7\"><span class=\"crayon-c\">// 平均时间复杂度 ---- O(nlogn)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-8\"><span class=\"crayon-c\">// 所需辅助空间 ------ 主要是递归造成的栈空间的使用(用来保存left和right等局部变量)，取决于递归树的深度，一般为O(logn)，最差为O(n)       </span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-9\"><span class=\"crayon-c\">// 稳定性 ---------- 不稳定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-11\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-18\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Partition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 划分函数</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-19\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">               </span><span class=\"crayon-c\">// 这里每次都选择最后一个元素作为基准</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// tail为小于基准的子数组最后一个元素的索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// 遍历基准以外的其他元素</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">              </span><span class=\"crayon-c\">// 把小于等于基准的元素放到前一个子数组末尾</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">tail</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Swap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 最后把基准放到前一个子数组的后边，剩下的子数组既是大于基准的子数组</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-30\"><span class=\"crayon-h\">                                        </span><span class=\"crayon-c\">// 该操作很有可能把后面元素的稳定性打乱，所以快速排序是不稳定的排序算法</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                    </span><span class=\"crayon-c\">// 返回基准的索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-34\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-35\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">left</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Partition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 基准的索引</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">left</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">right</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-41\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-42\"> </div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-43\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-44\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 从小到大快速排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">QuickSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"快速排序结果：\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%d \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">A</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03b82529675183451471-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b03b82529675183451471-55\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0088 seconds] -->\r\n<p>使用快速排序法对一列数字进行排序的过程：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fr773uwbpqg207s05ytay.gif\" width=\"280\" height=\"214\"></p>\n<p><strong>快速排序是不稳定的排序算法，不稳定发生在基准元素与A[tail+1]交换的时刻。</strong></p>\n<p>比如序列：{ 1, 3, 4, 2, 8, 9, 8, 7, 5 }，基准元素是5，一次划分操作后5要和第一个8进行交换，从而改变了两个元素8的相对次序。</p>\n<blockquote><p>Java系统提供的Arrays.sort函数。对于基础类型，底层使用快速排序。对于非基础类型，底层使用归并排序。请问是为什么？</p></blockquote>\n<p>答：这是考虑到排序算法的稳定性。对于基础类型，相同值是无差别的，排序前后相同值的相对位置并不重要，所以选择更为高效的快速排序，尽管它是不稳定的排序算法；而对于非基础类型，排序前后相等实例的相对位置不宜改变，所以选择稳定的归并排序。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113863\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113863votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113863\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 3, "tags": "IT技术,排序算法,算法", "url_object_id": "10ced989709fd8ca75a2272ea7f16567", "title": "常用排序算法总结（1）", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/a1a4de99de0c75eab712542a7dac876f.png"], "comment_nums": 3, "url": "http://blog.jobbole.com/113863/"},{"praise_nums": "1", "create_date": "2018-05-07", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/pet-simple-command-line-snippet-manager/\">SK</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9600-1.html\">Linux中国/MjSeven</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/310d11635ef5716e4028f2035c080286.png\" alt=\"\"></p>\n<p>我们不可能记住所有的命令，对吧？是的。除了经常使用的命令之外，我们几乎不可能记住一些很少使用的长命令。这就是为什么需要一些外部工具来帮助我们在需要时找到命令。在过去，我们已经点评了两个有用的工具，名为 “Bashpast” 和 “Keep”。使用 Bashpast，我们可以轻松地为 Linux 命令添加书签，以便更轻松地重复调用。而 Keep 实用程序可以用来在终端中保留一些重要且冗长的命令，以便你可以随时使用它们。今天，我们将看到该系列中的另一个工具，以帮助你记住命令。现在让我们认识一下 “Pet”，这是一个用 Go 语言编写的简单的命令行代码管理器。</p>\n<p>使用 Pet，你可以：</p>\n<ul>\n<li>注册/添加你重要的、冗长和复杂的命令片段。</li>\n<li>以交互方式来搜索保存的命令片段。</li>\n<li>直接运行代码片段而无须一遍又一遍地输入。</li>\n<li>轻松编辑保存的代码片段。</li>\n<li>通过 Gist 同步片段。</li>\n<li>在片段中使用变量</li>\n<li>还有很多特性即将来临。</li>\n</ul>\n<h3 id=\"toc_1\">安装 Pet 命令行接口代码管理器</h3>\n<p>由于它是用 Go 语言编写的，所以确保你在系统中已经安装了 Go。</p>\n<p>安装 Go 后，从 <a href=\"https://github.com/knqyf263/pet/releases\"><strong>Pet 发布页面</strong></a> 获取最新的二进制文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa7e392793900\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://github.com/knqyf263/pet/releases/download/v0.2.4/pet_0.2.4_linux_amd64.zip\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa7e392793900-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa7e392793900-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa7e392793900-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/knqyf263/pet/releases/download/v0.2.4/pet_0.2.4_linux_amd64.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa7e392793900-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>对于 32 位计算机：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa88509935994\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://github.com/knqyf263/pet/releases/download/v0.2.4/pet_0.2.4_linux_386.zip\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa88509935994-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa88509935994-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa88509935994-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/knqyf263/pet/releases/download/v0.2.4/pet_0.2.4_linux_386.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa88509935994-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>解压下载的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa8d700075184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunzip pet_0.2.4_linux_amd64.zip\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa8d700075184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa8d700075184-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa8d700075184-1\"><span class=\"crayon-e\">unzip </span><span class=\"crayon-v\">pet_0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2.4_linux_amd64.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa8d700075184-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>对于 32 位：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa90148521682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunzip pet_0.2.4_linux_386.zip\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa90148521682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa90148521682-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa90148521682-1\"><span class=\"crayon-e\">unzip </span><span class=\"crayon-v\">pet_0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2.4_linux_386.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa90148521682-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>将 <code>pet</code> 二进制文件复制到 PATH（即 <code>/usr/local/bin</code> 之类的）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa93511281137\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo cp pet /usr/local/bin/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa93511281137-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa93511281137-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa93511281137-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">pet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa93511281137-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>最后，让它可以执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa96710327359\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo chmod +x /usr/local/bin/pet\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa96710327359-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa96710327359-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa96710327359-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">pet</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa96710327359-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>如果你使用的是基于 Arch 的系统，那么你可以使用任何 AUR 帮助工具从 AUR 安装它。</p>\n<p>使用 <a href=\"https://www.ostechnix.com/install-pacaur-arch-linux/\">Pacaur</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa99497570608\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacaur -S pet-git\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa99497570608-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa99497570608-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa99497570608-1\"><span class=\"crayon-v\">pacaur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pet</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa99497570608-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用 <a href=\"https://www.ostechnix.com/install-packer-arch-linux-2/\">Packer</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa9c152590537\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacker -S pet-git\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa9c152590537-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa9c152590537-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa9c152590537-1\"><span class=\"crayon-v\">packer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pet</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa9c152590537-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用 <a href=\"https://www.ostechnix.com/install-yaourt-arch-linux/\">Yaourt</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aa9f080412490\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nyaourt -S pet-git\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aa9f080412490-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aa9f080412490-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aa9f080412490-1\"><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pet</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aa9f080412490-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用 <a href=\"https://www.ostechnix.com/yay-found-yet-another-reliable-aur-helper/\">Yay</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaa3315259481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nyay -S pet-git\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa3315259481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa3315259481-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa3315259481-1\"><span class=\"crayon-v\">yay</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pet</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa3315259481-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>此外，你需要安装 <a href=\"https://github.com/junegunn/fzf\">fzf</a> 或 <a href=\"https://github.com/peco/peco\">peco</a> 工具以启用交互式搜索。请参阅官方 GitHub 链接了解如何安装这些工具。</p>\n<h3 id=\"toc_2\">用法</h3>\n<p>运行没有任何参数的 <code>pet</code> 来查看可用命令和常规选项的列表。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaa6113346817\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet\r\npet - Simple command-line snippet manager.\r\n\r\nUsage:\r\n pet [command]\r\n\r\nAvailable Commands:\r\n configure Edit config file\r\n edit Edit snippet file\r\n exec Run the selected commands\r\n help Help about any command\r\n list Show all snippets\r\n new Create a new snippet\r\n search Search snippets\r\n sync Sync snippets\r\n version Print the version number\r\n\r\nFlags:\r\n --config string config file (default is $HOME/.config/pet/config.toml)\r\n --debug debug mode\r\n -h, --help help for pet\r\n\r\nUse \"pet [command] --help\" for more information about a command.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa6113346817-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-2\"><span class=\"crayon-v\">pet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Simple </span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">line </span><span class=\"crayon-e\">snippet </span><span class=\"crayon-v\">manager</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-4\"><span class=\"crayon-v\">Usage</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-7\"><span class=\"crayon-e\">Available </span><span class=\"crayon-v\">Commands</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">configure </span><span class=\"crayon-e\">Edit </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">file</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-9\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">edit </span><span class=\"crayon-e\">Edit </span><span class=\"crayon-e\">snippet </span><span class=\"crayon-e\">file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-10\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">exec </span><span class=\"crayon-e\">Run </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">selected </span><span class=\"crayon-e\">commands</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-11\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">help </span><span class=\"crayon-e\">Help </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">any </span><span class=\"crayon-e\">command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-12\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">snippets</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-13\"><span class=\"crayon-e\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">snippet</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-14\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">search </span><span class=\"crayon-e\">Search </span><span class=\"crayon-e\">snippets</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-15\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">sync </span><span class=\"crayon-e\">Sync </span><span class=\"crayon-e\">snippets</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-16\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">version </span><span class=\"crayon-e\">Print </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">version </span><span class=\"crayon-e\">number</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-18\"><span class=\"crayon-v\">Flags</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-19\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">config </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">HOME</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pet</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">toml</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">debug </span><span class=\"crayon-e\">debug </span><span class=\"crayon-v\">mode</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">help </span><span class=\"crayon-e\">help </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-22\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa6113346817-23\"><span class=\"crayon-st\">Use</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"pet [command] --help\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">information </span><span class=\"crayon-i\">about</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa6113346817-24\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>要查看特定命令的帮助部分，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaa9484621885\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet [command] --help\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaa9484621885-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaa9484621885-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaa9484621885-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">help</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaa9484621885-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h4 id=\"toc_3\">配置 Pet</h4>\n<p>默认配置其实工作的挺好。但是，你可以更改保存片段的默认目录，选择要使用的选择器（fzf 或 peco），编辑片段的默认文本编辑器，添加 GIST id 详细信息等。</p>\n<p>要配置 Pet，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaad916113111\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet configure\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaad916113111-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaad916113111-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaad916113111-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-i\">configure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaad916113111-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>该命令将在默认的文本编辑器中打开默认配置（例如我是 vim），根据你的要求更改或编辑特定值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aab0279537325\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[General]\r\n snippetfile = \"/home/sk/.config/pet/snippet.toml\"\r\n editor = \"vim\"\r\n column = 40\r\n selectcmd = \"fzf\"\r\n\r\n[Gist]\r\n file_name = \"pet-snippet.toml\"\r\n access_token = \"\"\r\n gist_id = \"\"\r\n public = false\r\n~\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab0279537325-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab0279537325-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab0279537325-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab0279537325-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab0279537325-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab0279537325-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab0279537325-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">General</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab0279537325-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snippetfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home/sk/.config/pet/snippet.toml\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"vim\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab0279537325-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">column</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectcmd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"fzf\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab0279537325-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Gist</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab0279537325-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"pet-snippet.toml\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">access_token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab0279537325-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gist_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab0279537325-12\"><span class=\"crayon-o\">~</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab0279537325-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h4 id=\"toc_4\">创建片段</h4>\n<p>为了创建一个新的片段，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aab3795660732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet new\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab3795660732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab3795660732-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab3795660732-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-r\">new</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab3795660732-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>添加命令和描述，然后按下回车键保存它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aab8152100159\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCommand&gt; echo 'Hell1o, Welcome1 2to OSTechNix4' | tr -d '1-9'\r\nDescription&gt; Remove numbers from output.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab8152100159-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aab8152100159-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aab8152100159-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab8152100159-1\"><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hell1o, Welcome1 2to OSTechNix4'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1-9'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aab8152100159-2\"><span class=\"crayon-v\">Description</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">numbers </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aab8152100159-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1fa3f36d4576527b79f7052bfeac8ac1.png\" alt=\"\"></p>\n<p>这是一个简单的命令，用于从 <code>echo</code> 命令输出中删除所有数字。你可以很轻松地记住它。但是，如果你很少使用它，几天后你可能会完全忘记它。当然，我们可以使用 <code>CTRL+R</code> 搜索历史记录，但 Pet 会更容易。另外，Pet 可以帮助你添加任意数量的条目。</p>\n<p>另一个很酷的功能是我们可以轻松添加以前的命令。为此，在你的 <code>.bashrc</code> 或 <code>.zshrc</code> 文件中添加以下行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aabc028298006\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction prev() {\r\n PREV=$(fc -lrn | head -n 1)\r\n sh -c \"pet new `printf %q \"$PREV\"`\"\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aabc028298006-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aabc028298006-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aabc028298006-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aabc028298006-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aabc028298006-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aabc028298006-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">prev</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aabc028298006-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PREV</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lrn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aabc028298006-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"pet new `printf %q \"</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">PREV</span><span class=\"crayon-s\">\"`\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aabc028298006-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aabc028298006-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>执行以下命令来使保存的更改生效。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aabf962233106\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsource .bashrc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aabf962233106-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aabf962233106-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aabf962233106-1\"><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aabf962233106-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>或者：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aac2059975457\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsource .zshrc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aac2059975457-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aac2059975457-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aac2059975457-1\"><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">zshrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aac2059975457-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在，运行任何命令，例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aac5122143426\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat Documents/ostechnix.txt | tr '|' '\\n' | sort | tr '\\n' '|' | sed \"s/.$/\\\\n/g\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aac5122143426-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aac5122143426-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aac5122143426-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tr</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'|'</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tr</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'|'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"s/.$/\\\\n/g\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aac5122143426-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>要添加上述命令，你不必使用 <code>pet new</code> 命令。只需要：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aac8247919861\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ prev\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aac8247919861-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aac8247919861-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aac8247919861-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">prev</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aac8247919861-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>将说明添加到该命令代码片段中，然后按下回车键保存。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/7158fec67536c6b012992d5502083043.png\" alt=\"\"></p>\n<h4 id=\"toc_5\">片段列表</h4>\n<p>要查看保存的片段，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aacb509161513\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet list\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aacb509161513-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aacb509161513-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aacb509161513-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-i\">list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aacb509161513-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/22016dbcb67a4acd00cf651f0e35b9ec.png\" alt=\"\"></p>\n<h4 id=\"toc_6\">编辑片段</h4>\n<p>如果你想编辑代码片段的描述或命令，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aace594236041\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet edit\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aace594236041-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aace594236041-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aace594236041-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-i\">edit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aace594236041-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这将在你的默认文本编辑器中打开所有保存的代码片段，你可以根据需要编辑或更改片段。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aad1005796509\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[[snippets]]\r\n description = \"Remove numbers from output.\"\r\n command = \"echo 'Hell1o, Welcome1 2to OSTechNix4' | tr -d '1-9'\"\r\n output = \"\"\r\n\r\n[[snippets]]\r\n description = \"Alphabetically sort one line of text\"\r\n command = \"\\t prev\"\r\n output = \"\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad1005796509-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad1005796509-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad1005796509-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad1005796509-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad1005796509-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad1005796509-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad1005796509-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad1005796509-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad1005796509-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad1005796509-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad1005796509-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">snippets</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad1005796509-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">description</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Remove numbers from output.\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad1005796509-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"echo 'Hell1o, Welcome1 2to OSTechNix4' | tr -d '1-9'\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad1005796509-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad1005796509-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad1005796509-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">snippets</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad1005796509-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">description</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Alphabetically sort one line of text\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad1005796509-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\t prev\"</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad1005796509-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad1005796509-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h4 id=\"toc_7\">在片段中使用标签</h4>\n<p>要将标签用于判断，使用下面的 <code>-t</code> 标志。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aad5738489812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet new -t\r\nCommand&gt; echo 'Hell1o, Welcome1 2to OSTechNix4' | tr -d '1-9\r\nDescription&gt; Remove numbers from output.\r\nTag&gt; tr command examples\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad5738489812-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad5738489812-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad5738489812-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad5738489812-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad5738489812-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad5738489812-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad5738489812-2\"><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hell1o, Welcome1 2to OSTechNix4'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span>'<span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">9</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad5738489812-3\"><span class=\"crayon-v\">Description</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">numbers </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad5738489812-4\"><span class=\"crayon-v\">Tag</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tr </span><span class=\"crayon-e\">command </span><span class=\"crayon-i\">examples</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad5738489812-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h4 id=\"toc_8\">执行片段</h4>\n<p>要执行一个保存的片段，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aad8112594498\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet exec\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aad8112594498-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aad8112594498-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aad8112594498-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-i\">exec</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aad8112594498-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>从列表中选择你要运行的代码段，然后按回车键来运行它：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/cf214a0ef38d5b40bc4432a0aade3021.png\" alt=\"\"></p>\n<p>记住你需要安装 fzf 或 peco 才能使用此功能。</p>\n<h4 id=\"toc_9\">寻找片段</h4>\n<p>如果你有很多要保存的片段，你可以使用字符串或关键词如 below.qjz 轻松搜索它们。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aadc528562499\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet search\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aadc528562499-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aadc528562499-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aadc528562499-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-i\">search</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aadc528562499-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>输入搜索字词或关键字以缩小搜索结果范围。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/8d353e209372d40f943c717f666c5b28.png\" alt=\"\"></p>\n<h4 id=\"toc_10\">同步片段</h4>\n<p>首先，你需要获取访问令牌。转到此链接 <a href=\"https://github.com/settings/tokens/new\">https://github.com/settings/tokens/new</a> 并创建访问令牌（只需要 “gist” 范围）。</p>\n<p>使用以下命令来配置 Pet：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aae4850717796\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet configure\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aae4850717796-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aae4850717796-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aae4850717796-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-i\">configure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aae4850717796-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>将令牌设置到 <code>[Gist]</code> 字段中的 <code>access_token</code>。</p>\n<p>设置完成后，你可以像下面一样将片段上传到 Gist。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aae8635177342\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet sync -u\r\nGist ID: 2dfeeeg5f17e1170bf0c5612fb31a869\r\nUpload success\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aae8635177342-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aae8635177342-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aae8635177342-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aae8635177342-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aae8635177342-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-v\">sync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aae8635177342-2\"><span class=\"crayon-e\">Gist </span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2dfeeeg5f17e1170bf0c5612fb31a869</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aae8635177342-3\"><span class=\"crayon-e\">Upload </span><span class=\"crayon-i\">success</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aae8635177342-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你也可以在其他 PC 上下载片段。为此，编辑配置文件并在 <code>[Gist]</code> 中将 <code>gist_id</code> 设置为 GIST id。</p>\n<p>之后，使用以下命令下载片段：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaeb950107630\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pet sync\r\nDownload success\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaeb950107630-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaeb950107630-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaeb950107630-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaeb950107630-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pet </span><span class=\"crayon-e\">sync</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaeb950107630-2\"><span class=\"crayon-e\">Download </span><span class=\"crayon-i\">success</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaeb950107630-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>获取更多细节，参阅帮助选项：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaee690490436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npet -h\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaee690490436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaee690490436-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaee690490436-1\"><span class=\"crayon-v\">pet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaee690490436-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4fb7aaf2523572330\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npet [command] -h\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4fb7aaf2523572330-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4fb7aaf2523572330-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4fb7aaf2523572330-1\"><span class=\"crayon-i\">pet</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4fb7aaf2523572330-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这就是全部了。希望这可以帮助到你。正如你所看到的，Pet 使用相当简单易用！如果你很难记住冗长的命令，Pet 实用程序肯定会有用。</p>\n<p>干杯！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113949\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113949votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113949\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 0, "tags": "IT技术,Linux", "url_object_id": "d60ef196f154843a4e1ea191d377a33f", "title": "Pet：一个简单的命令行片段管理器", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/05/310d11635ef5716e4028f2035c080286.png"], "comment_nums": 0, "url": "http://blog.jobbole.com/113949/"},{"praise_nums": "1", "create_date": "2018-05-11", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/leefreeman/p/8286550.html\">李平</a>   </div><p>1、背景</p>\n<p>对于数据库系统来说在多用户并发条件下提高并发性的同时又要保证数据的一致性一直是数据库系统追求的目标，既要满足大量并发访问的需求又必须保证在此条件下数据的安全，为了满足这一目标大多数数据库通过锁和事务机制来实现，MySQL数据库也不例外。尽管如此我们仍然会在业务开发过程中遇到各种各样的疑难问题，本文将以案例的方式演示常见的并发问题并分析解决思路。</p>\n<p>2、表锁导致的慢查询的问题</p>\n<p>首先我们看一个简单案例，根据ID查询一条用户信息：</p>\n<p>mysql&gt; select * from user where id=6;</p>\n<p>这个表的记录总数为3条，但却执行了13秒。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1b3bc1912c404382512e2792c1aae040.jpg\" alt=\"\" width=\"517\" height=\"149\"></p>\n<p>出现这种问题我们首先想到的是看看当前MySQL进程状态：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/04c5328df90da59e81538e413a6214e9.jpg\" alt=\"\" width=\"612\" height=\"127\"></p>\n<p>从进程上可以看出select语句是在等待一个表锁，那么这个表锁又是什么查询产生的呢？这个结果中并没有显示直接的关联关系，但我们可以推测多半是那条update语句产生的（因为进程中没有其他可疑的SQL），为了印证我们的猜测，先检查一下user表结构：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/890dfd75e286048c8572d90a7e54d8ee.jpg\" alt=\"\" width=\"613\" height=\"385\"></p>\n<p>果然user表使用了MyISAM存储引擎，MyISAM在执行操作前会产生表锁，操作完成再自动解锁。如果操作是写操作，则表锁类型为写锁，如果操作是读操作则表锁类型为读锁。正如和你理解的一样写锁将阻塞其他操作(包括读和写)，这使得所有操作变为串行；而读锁情况下读-读操作可以并行，但读-写操作仍然是串行。以下示例演示了显式指定了表锁（读锁），读-读并行，读-写串行的情况。</p>\n<p>显式开启/关闭表锁，使用lock table user read/write; unlock tables;</p>\n<p>session1:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/0290d1fdfbfda4149bdbe0391d3e5710.jpg\" alt=\"\" width=\"607\" height=\"342\"></p>\n<p>session2：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/4b007a1f2f3e117f9a752641a3606159.jpg\" alt=\"\" width=\"574\" height=\"254\"></p>\n<p>可以看到会话1启用表锁（读锁）执行读操作，这时会话2可以并行执行读操作，但写操作被阻塞。接着看：</p>\n<p>session1:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/36145803941c5f88fa8631e1a3cf7904.jpg\" alt=\"\" width=\"455\" height=\"335\"></p>\n<p>session2:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/15fc394ec90d39dcae247b882f5eea96.jpg\" alt=\"\" width=\"441\" height=\"65\"></p>\n<p>当session1执行解锁后，seesion2则立刻开始执行写操作，即读-写串行。</p>\n<p>总结：</p>\n<p>到此我们把问题的原因基本分析清楚，总结一下——MyISAM存储引擎执行操作时会产生表锁，将影响其他用户对该表的操作，如果表锁是写锁，则会导致其他用户操作串行，如果是读锁则其他用户的读操作可以并行。所以有时我们遇到某个简单的查询花了很长时间，看看是不是这种情况。</p>\n<p>解决办法：</p>\n<p>1）、尽量不用MyISAM存储引擎，在MySQL8.0版本中已经去掉了所有的MyISAM存储引擎的表，推荐使用InnoDB存储引擎。</p>\n<p>2）、如果一定要用MyISAM存储引擎，减少写操作的时间；</p>\n<p>3、线上修改表结构有哪些风险？</p>\n<p>如果有一天业务系统需要增大一个字段长度，能否在线上直接修改呢？在回答这个问题前，我们先来看一个案例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/83407a7505b251e321242c1a206468e8.jpg\" alt=\"\" width=\"595\" height=\"39\"></p>\n<p>以上语句尝试修改user表的name字段长度，语句被阻塞。按照惯例，我们检查一下当前进程：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/2e87c7f9d99ba728ef0e052c8a9317b0.jpg\" alt=\"\" width=\"534\" height=\"204\"></p>\n<p>从进程可以看出alter语句在等待一个元数据锁，而这个元数据锁很可能是上面这条select语句引起的，事实正是如此。在执行DML（select、update、delete、insert）操作时，会对表增加一个元数据锁，这个元数据锁是为了保证在查询期间表结构不会被修改，因此上面的alter语句会被阻塞。那么如果执行顺序相反，先执行alter语句，再执行DML语句呢？DML语句会被阻塞吗？例如我正在线上环境修改表结构，线上的DML语句会被阻塞吗？答案是：不确定。</p>\n<p>在MySQL5.6开始提供了online ddl功能，允许一些DDL语句和DML语句并发，在当前5.7版本对online ddl又有了增强，这使得大部分DDL操作可以在线进行。详见：<a href=\"https://dev.mysql.com/doc/refman/5.7/en/innodb-create-index-overview.html\" rel=\"nofollow\">https://dev.mysql.com/doc/refman/5.7/en/innodb-create-index-overview.html</a></p>\n<p>所以对于特定场景执行DDL过程中，DML是否会被阻塞需要视场景而定。</p>\n<p>总结：通过这个例子我们对元数据锁和online ddl有了一个基本的认识，如果我们在业务开发过程中有在线修改表结构的需求，可以参考以下方案：</p>\n<p>1、尽量在业务量小的时间段进行；</p>\n<p>2、查看官方文档，确认要做的表修改可以和DML并发，不会阻塞线上业务；</p>\n<p>3、推荐使用percona公司的pt-online-schema-change工具，该工具被官方的online ddl更为强大，它的基本原理是：通过insert… select…语句进行一次全量拷贝，通过触发器记录表结构变更过程中产生的增量，从而达到表结构变更的目的。</p>\n<p>例如要对A表进行变更，主要步骤为：</p>\n<p><em>创建目的表结构的空表，A_new;</em><br>\n<em>在A表上创建触发器，包括增、删、改触发器;</em><br>\n<em>通过insert…select…limit N 语句分片拷贝数据到目的表</em><br>\n<em>Copy完成后，将A_new表rename到A表。</em></p>\n<p>4、一个死锁问题的分析</p>\n<p>在线上环境下死锁的问题偶有发生，死锁是因为两个或多个事务相互等待对方释放锁，导致事务永远无法终止的情况。为了分析问题，我们下面将模拟一个简单死锁的情况，然后从中总结出一些分析思路。</p>\n<p>演示环境：MySQL5.7.20 事务隔离级别：RR</p>\n<p>表user：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e7a4a894929664\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE `USER` (\r\n`ID` INT(11) NOT NULL AUTO_INCREMENT,\r\n`NAME` VARCHAR(300) DEFAULT NULL,\r\n`AGE` INT(11) DEFAULT NULL,\r\nPRIMARY KEY (`ID`)\r\n) ENGINE=INNODB AUTO_INCREMENT=5 DEFAULT CHARSET=UTF8</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a4a894929664-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a4a894929664-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a4a894929664-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a4a894929664-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a4a894929664-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a4a894929664-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a4a894929664-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">USER</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a4a894929664-2\"><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a4a894929664-3\"><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">NAME</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a4a894929664-4\"><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">AGE</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a4a894929664-5\"><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ID</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a4a894929664-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">INNODB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">UTF8</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<div></div>\n<p>下面演示事务1、事务2工作的情况：</p>\n<div>\n<table>\n<colgroup>\n<col>\n<col>\n<col>\n<col></colgroup>\n<thead>\n<tr>\n<th scope=\"col\"></th>\n<th scope=\"col\">\n<div>事务1</div>\n</th>\n<th scope=\"col\">\n<div>事务2</div>\n</th>\n<th colspan=\"1\" scope=\"col\">\n<div>事务监控</div>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>T1</td>\n<td>begin;\n<p>Query OK, 0 rows affected (0.00 sec)</p></td>\n<td>begin;\n<p>Query OK, 0 rows affected (0.00 sec)</p></td>\n<td colspan=\"1\"></td>\n</tr>\n<tr>\n<td>T2</td>\n<td>select * from user where id=3 for update;\n<p>+—-+——+——+<br>\n| id | name | age |<br>\n+—-+——+——+<br>\n| 3 | sun | 20 |<br>\n+—-+——+——+<br>\n1 row in set (0.00 sec)</p></td>\n<td>select * from user where id=4 for update;\n<p>+—-+——+——+<br>\n| id | name | age |<br>\n+—-+——+——+<br>\n| 4 | zhou | 21 |<br>\n+—-+——+——+<br>\n1 row in set (0.00 sec)</p></td>\n<td colspan=\"1\">select * from information_schema.INNODB_TRX；\n<p>通过查询元数据库innodb事务表，监控到当前运行事务数为2，即事务1、事务2。</p></td>\n</tr>\n<tr>\n<td>T3</td>\n<td>update user set name=’haha’ where id=4;\n<p>因为id=4的记录已被事务2加上行锁，该语句将阻塞</p></td>\n<td></td>\n<td colspan=\"1\">监控到当前运行事务数为2。</td>\n</tr>\n<tr>\n<td>T4</td>\n<td>阻塞状态</td>\n<td>update user set name=’hehe’ where id=3;\n<p>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</p>\n<p>id=3的记录已被事务1加上行锁，而本事务持有id=4的记录行锁，此时InnoDB存储引擎检查出死锁，本事务被回滚。</p></td>\n<td colspan=\"1\">事务2被回滚，事务1仍在运行中，监控当前运行事务数为1。</td>\n</tr>\n<tr>\n<td colspan=\"1\">T5</td>\n<td colspan=\"1\">Query OK, 1 row affected (20.91 sec)<br>\nRows matched: 1 Changed: 1 Warnings: 0由于事务2被回滚，原来阻塞的update语句被继续执行。</td>\n<td colspan=\"1\"></td>\n<td colspan=\"1\">监控当前运行事务数为1。</td>\n</tr>\n<tr>\n<td colspan=\"1\">T6</td>\n<td colspan=\"1\">commit；\n<p>Query OK, 0 rows affected (0.00 sec)</p></td>\n<td colspan=\"1\"></td>\n<td colspan=\"1\">事务1已提交、事务2已回滚，监控当前运行事务数为0。</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>这是一个简单的死锁场景，事务1、事务2彼此等待对方释放锁，InnoDB存储引擎检测到死锁发生，让事务2回滚，这使得事务1不再等待事务B的锁，从而能够继续执行。那么InnoDB存储引擎是如何检测到死锁的呢？为了弄明白这个问题，我们先检查此时InnoDB的状态：</p>\n<p>show engine innodb statusG</p>\n<p>————————<br>\n<strong>LATEST DETECTED DEADLOCK</strong><br>\n————————<br>\n2018-01-14 12:17:13 0x70000f1cc000<br>\n*** (1) TRANSACTION:<br>\nTRANSACTION 5120, ACTIVE 17 sec starting index read<br>\nmysql tables in use 1, locked 1<br>\nLOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)<br>\nMySQL thread id 10, OS thread handle 123145556967424, query id 2764 localhost root updating<br>\nupdate user set name=’haha’ where id=4<br>\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>\nRECORD LOCKS space id 94 page no 3 n bits 80 index PRIMARY of table <code>test</code>.<code>user</code> trx id 5120 lock_mode X locks rec but not gap waiting<br>\nRecord lock, heap no 5 PHYSICAL RECORD: n_fields 5; compact format; info bits 0<br>\n0: len 4; hex 80000004; asc ;;<br>\n1: len 6; hex 0000000013fa; asc ;;<br>\n2: len 7; hex 520000060129a6; asc R ) ;;<br>\n3: len 4; hex 68616861; asc haha;;<br>\n4: len 4; hex 80000015; asc ;;</p>\n<p>*** (2) TRANSACTION:<br>\nTRANSACTION 5121, ACTIVE 12 sec starting index read<br>\nmysql tables in use 1, locked 1<br>\n3 lock struct(s), heap size 1136, 2 row lock(s)<br>\nMySQL thread id 11, OS thread handle 123145555853312, query id 2765 localhost root updating<br>\nupdate user set name=’hehe’ where id=3<br>\n*** (2) HOLDS THE LOCK(S):<br>\nRECORD LOCKS space id 94 page no 3 n bits 80 index PRIMARY of table <code>test</code>.<code>user</code> trx id 5121 lock_mode X locks rec but not gap<br>\nRecord lock, heap no 5 PHYSICAL RECORD: n_fields 5; compact format; info bits 0<br>\n0: len 4; hex 80000004; asc ;;<br>\n1: len 6; hex 0000000013fa; asc ;;<br>\n2: len 7; hex 520000060129a6; asc R ) ;;<br>\n3: len 4; hex 68616861; asc haha;;<br>\n4: len 4; hex 80000015; asc ;;</p>\n<p>*** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>\nRECORD LOCKS space id 94 page no 3 n bits 80 index PRIMARY of table <code>test</code>.<code>user</code> trx id 5121 lock_mode X locks rec but not gap waiting<br>\nRecord lock, heap no 7 PHYSICAL RECORD: n_fields 5; compact format; info bits 0<br>\n0: len 4; hex 80000003; asc ;;<br>\n1: len 6; hex 0000000013fe; asc ;;<br>\n2: len 7; hex 5500000156012f; asc U V /;;<br>\n3: len 4; hex 68656865; asc hehe;;<br>\n4: len 4; hex 80000014; asc ;;</p>\n<p><strong>*** WE ROLL BACK TRANSACTION (2)</strong></p>\n<p>InnoDB状态有很多指标，这里我们截取死锁相关的信息，可以看出InnoDB可以输出最近出现的死锁信息，其实很多死锁监控工具也是基于此功能开发的。</p>\n<p>在死锁信息中，显示了两个事务等待锁的相关信息（蓝色代表事务1、绿色代表事务2），重点关注：WAITING FOR THIS LOCK TO BE GRANTED和HOLDS THE LOCK(S)。</p>\n<p>WAITING FOR THIS LOCK TO BE GRANTED表示当前事务正在等待的锁信息，从输出结果看出事务1正在等待heap no为5的行锁，事务2正在等待 heap no为7的行锁；</p>\n<p>HOLDS THE LOCK(S)：表示当前事务持有的锁信息，从输出结果看出事务2持有heap no为5行锁。</p>\n<p>从输出结果看出，最后InnoDB回滚了事务2。</p>\n<p>那么InnoDB是如何检查出死锁的呢？</p>\n<p>我们想到最简单方法是假如一个事务正在等待一个锁，如果等待时间超过了设定的阈值，那么该事务操作失败，这就避免了多个事务彼此长等待的情况。参数innodb_lock_wait_timeout正是用来设置这个锁等待时间的。</p>\n<p>如果按照这个方法，解决死锁是需要时间的（即等待超过innodb_lock_wait_timeout设定的阈值），这种方法稍显被动而且影响系统性能，InnoDB存储引擎提供一个更好的算法来解决死锁问题，wait-for graph算法。简单的说，当出现多个事务开始彼此等待时，启用wait-for graph算法，该算法判定为死锁后立即回滚其中一个事务，死锁被解除。该方法的好处是：检查更为主动，等待时间短。</p>\n<p>下面是wait-for graph算法的基本原理：</p>\n<p>为了便于理解，我们把死锁看做4辆车彼此阻塞的场景：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/f7a883112a5f506ea98df7e92ef9c2c2.png\" alt=\"\"></p>\n<div>\n<div id=\"drawio-macro-content-1304169245--1911697403456626598\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/2eb724512ffd6c6d5f27e6aabbfe5a02.jpg\" alt=\"\" width=\"316\" height=\"300\"></div>\n</div>\n<p>4辆车看做4个事务，彼此等待对方的锁，造成死锁。wait-for graph算法原理是把事务作为节点，事务之间的锁等待关系，用有向边表示，例如事务A等待事务B的锁，就从节点A画一条有向边到节点B，这样如果A、B、C、D构成的有向图，形成了环，则判断为死锁。这就是wait-for graph算法的基本原理。</p>\n<p>总结：</p>\n<p>1、如果我们业务开发中出现死锁如何检查出？刚才已经介绍了通过监控InnoDB状态可以得出，你可以做一个小工具把死锁的记录收集起来，便于事后查看。</p>\n<p>2、如果出现死锁，业务系统应该如何应对？从上文我们可以看到当InnoDB检查出死锁后，对客户端报出一个Deadlock found when trying to get lock; try restarting transaction信息，并且回滚该事务，应用端需要针对该信息，做事务重启的工作，并保存现场日志事后做进一步分析，避免下次死锁的产生。</p>\n<p>5、锁等待问题的分析</p>\n<p>在业务开发中死锁的出现概率较小，但锁等待出现的概率较大，锁等待是因为一个事务长时间占用锁资源，而其他事务一直等待前个事务释放锁。</p>\n<div>\n<table>\n<colgroup>\n<col>\n<col>\n<col>\n<col></colgroup>\n<thead>\n<tr>\n<th scope=\"col\"></th>\n<th scope=\"col\">\n<div>事务1</div>\n</th>\n<th scope=\"col\">\n<div>事务2</div>\n</th>\n<th scope=\"col\">\n<div>事务监控</div>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>T1</td>\n<td>begin;\n<p>Query OK, 0 rows affected (0.00 sec)</p></td>\n<td>begin;\n<p>Query OK, 0 rows affected (0.00 sec)</p></td>\n<td></td>\n</tr>\n<tr>\n<td>T2</td>\n<td>select * from user where id=3 for update;\n<p>+—-+——+——+<br>\n| id | name | age |<br>\n+—-+——+——+<br>\n| 3 | sun | 20 |<br>\n+—-+——+——+<br>\n1 row in set (0.00 sec)</p></td>\n<td>其他查询操作</td>\n<td>select * from information_schema.INNODB_TRX；\n<p>通过查询元数据库innodb事务表，监控到当前运行事务数为2，即事务1、事务2。</p></td>\n</tr>\n<tr>\n<td>T3</td>\n<td> 其他查询操作</td>\n<td> update user set name=’hehe’ where id=3;\n<p>因为id=3的记录被事务1加上行锁，所以该语句将阻塞（即锁等待）</p></td>\n<td> 监控到当前运行事务数为2。</td>\n</tr>\n<tr>\n<td colspan=\"1\">T4</td>\n<td colspan=\"1\">其他查询操作</td>\n<td colspan=\"1\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction\n<p>锁等待时间超过阈值，操作失败。注意：此时事务2并没有回滚。</p></td>\n<td colspan=\"1\">监控到当前运行事务数为2。</td>\n</tr>\n<tr>\n<td colspan=\"1\">T5</td>\n<td colspan=\"1\">commit;</td>\n<td colspan=\"1\"></td>\n<td colspan=\"1\">事务1已提交，事务2未提交，监控到当前运行事务数为1。</td>\n</tr>\n</tbody>\n</table>\n</div>\n<p>从上述可知事务1长时间持有id=3的行锁，事务2产生锁等待，等待时间超过innodb_lock_wait_timeout后操作中断，但事务并没有回滚。如果我们业务开发中遇到锁等待，不仅会影响性能，还会给你的业务流程提出挑战，因为你的业务端需要对锁等待的情况做适应的逻辑处理，是重试操作还是回滚事务。</p>\n<p>在MySQL元数据表中有对事务、锁等待的信息进行收集，例如information_schema数据库下的INNODB_LOCKS、INNODB_TRX、INNODB_LOCK_WAITS，你可以通过这些表观察你的业务系统锁等待的情况。你也可以用一下语句方便的查询事务和锁等待的关联关系：</p>\n<div></div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b03a4f9e7a5a739630086\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT     R.TRX_ID WAITING_TRX_ID,\r\n           R.TRX_MYSQL_THREAD_ID WAITING_THREAD,\r\n           R.TRX_QUERY WATING_QUERY,\r\n           B.TRX_ID BLOCKING_TRX_ID,\r\n           B.TRX_MYSQL_THREAD_ID BLOCKING_THREAD,\r\n           B.TRX_QUERY BLOCKING_QUERY\r\nFROM     INFORMATION_SCHEMA.INNODB_LOCK_WAITS W\r\nINNER JOIN     INFORMATION_SCHEMA.INNODB_TRX B ON B.TRX_ID = W.BLOCKING_TRX_ID\r\nINNER JOIN     INFORMATION_SCHEMA.INNODB_TRX R ON R.TRX_ID = W.REQUESTING_TRX_ID;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b03a4f9e7a5a739630086-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a5a739630086-1\"><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">R</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">TRX_ID </span><span class=\"crayon-v\">WAITING_TRX_ID</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a5a739630086-2\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">R</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">TRX_MYSQL_THREAD_ID </span><span class=\"crayon-v\">WAITING_THREAD</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a5a739630086-3\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">R</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">TRX_QUERY </span><span class=\"crayon-v\">WATING_QUERY</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a5a739630086-4\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">TRX_ID </span><span class=\"crayon-v\">BLOCKING_TRX_ID</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a5a739630086-5\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">TRX_MYSQL_THREAD_ID </span><span class=\"crayon-v\">BLOCKING_THREAD</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a5a739630086-6\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">TRX_QUERY </span><span class=\"crayon-e\">BLOCKING_QUERY</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a5a739630086-7\"><span class=\"crayon-i\">FROM</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFORMATION_SCHEMA</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">INNODB_LOCK</span><span class=\"crayon-sy\">_</span>WAITS<span class=\"crayon-h\"> </span><span class=\"crayon-i\">W</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b03a4f9e7a5a739630086-8\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-i\">JOIN</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFORMATION_SCHEMA</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">INNODB</span><span class=\"crayon-sy\">_</span>TRX<span class=\"crayon-h\"> </span><span class=\"crayon-i\">B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ON</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">B</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TRX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">BLOCKING_TRX_ID</span></div><div class=\"crayon-line\" id=\"crayon-5b03a4f9e7a5a739630086-9\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-i\">JOIN</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFORMATION_SCHEMA</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">INNODB</span><span class=\"crayon-sy\">_</span>TRX<span class=\"crayon-h\"> </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ON</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">R</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TRX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">REQUESTING_TRX_ID</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>结果：</p>\n<p>waiting_trx_id: 5132<br>\nwaiting_thread: 11<br>\nwating_query: update user set name=’hehe’ where id=3<br>\nblocking_trx_id: 5133<br>\nblocking_thread: 10<br>\nblocking_query: NULL</p>\n<p>总结：</p>\n<p>1、请对你的业务系统做锁等待的监控，这有助于你了解当前数据库锁情况，以及为你优化业务程序提供帮助；</p>\n<p>2、业务系统中应该对锁等待超时的情况做合适的逻辑判断。</p>\n<p>6、小结</p>\n<p>本文通过几个简单的示例介绍了我们常用的几种MySQL并发问题，并尝试得出针对这些问题我们排查的思路。文中涉及事务、表锁、元数据锁、行锁，但引起并发问题的远远不止这些，例如还有事务隔离级别、GAP锁等。真实的并发问题可能多而复杂，但排查思路和方法却是可以复用，在本文中我们使用了show processlist;show engine innodb status;以及查询元数据表的方法来排查发现问题，如果问题涉及到了复制，还需要借助master/slave监控来协助。</p>\n<p>参考资料：</p>\n<p>姜承尧《InnoDB存储引擎》</p>\n<p>李宏哲 杨挺 《MySQL排查指南》</p>\n<p>何登成 <a href=\"http://hedengcheng.com/\" rel=\"nofollow\">http://hedengcheng.com</a></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113968\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113968votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113968\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "fav_nums": 2, "tags": "IT技术,数据库", "url_object_id": "00300456460ea6d4134a02e6861bd127", "title": "MySQL 在并发场景下的问题及解决思路", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "comment_nums": 2, "url": "http://blog.jobbole.com/113968/"}